---
title: "Covid_4"
author: "Graham Noake"
date: "`r format(Sys.time(), '%d %b, %Y')`"
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'Covid_4.html'))})
output:
  html_document:
    toc: yes
    toc_float:
      smooth_scroll: no
    toc_depth: 3
    number_sections: yes
  word_document:
    toc: yes
    toc_depth: '3'
  pdf_document:
    toc: yes
    toc_depth: '3'
params:
  filename1: https://api.covidtracking.com/v1/states/daily.csv
  filename2: https://www2.census.gov/programs-surveys/popest/datasets/2010-2019/state/detail/SCPRC-EST2019-18+POP-RES.csv
  filename3: https://worldpopulationreview.com/static/states/name-abbr.csv
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.align = 'center', fig.dim = c(6, 4), echo = FALSE)
```
```{r data, message=FALSE}

library(data.table)
library(anytime)
library(dplyr)
library(ggplot2)
library(knitr)
library(kableExtra)
library(ggthemes)
library(xts)
library(tinytex)

```
<style>
#TOC {
  color = #708090;
  font-family = Calibri;
  font-size = 16px;
  border-color = #708090;
}
body {
  color = #708090;
  font-family = Calibri;
  background-color = #708090;
}
</style>
---

```{r Import}

#Import and prep base data as a data.table

Sys.setenv(TZ = "UTC")

covid_base_DT <- fread(params$filename1, select = c("date", "state", "positive", "totalTestResults", "death"))
covid_base_DT[is.na(covid_base_DT)]<- 0
covid_base_DT[, `:=` (date = anydate(date))][, psxdate := as.POSIXct(date, origin = "1970-01-01", tz = "UTC")][, `:=` (date = NULL)][, pos_day := positive - shift(positive, type = "lead", n = 1), by = state][, total_day := totalTestResults - shift(totalTestResults, type = "lead", n = 1), by = state][, death_day := death - shift(death, type = "lead", n = 1), by = state]
covid_base_DT[, `:=` (positive = NULL)][, `:=` (death = NULL)]
setcolorder(covid_base_DT, c("psxdate", "state", "pos_day", "total_day", "death_day")) #put into suitable column order for xts


pop_DT <- fread(params$filename2, select = c("NAME", "POPESTIMATE2019"))
setnames(pop_DT, old = c("NAME","POPESTIMATE2019"), new = c("State_Name", "Pop"))


state_abbr_DT <- read.csv(params$filename3, header = FALSE)
colnames(state_abbr_DT) <- c("State_Name", "State")

pop_abbr_DT <- pop_DT[state_abbr_DT, on = .(State_Name), nomatch = 0]
pop_abbr_DT[, `:=` (State_Name = NULL)]
setcolorder(pop_abbr_DT, c("State", "Pop" ))

terr_ab <- c("AS","DC", "GU", "MP", "PR", "VI")
terr_pop <- c(55641, 705749, 165718, 55194, 3193694, 104914)
terr_DT <- as.data.table(cbind(terr_ab, terr_pop))
setnames(terr_DT, c("terr_ab", "terr_pop"), c("State", "Pop"))
states <- rbind(pop_abbr_DT, terr_DT)
states[, Pop := (as.numeric(Pop))]


options(scipen = 999)  
```
```{r Long and Wide Engines}

pos_DT <- covid_base_DT[, .SD, .SDcols = c("psxdate", "state", "pos_day")]
pos_DT[is.na(pos_DT)] <- 0
posw_DT <- dcast(pos_DT, psxdate ~ state, value.var = c("pos_day"))
posw_DT[is.na(posw_DT)] <- 0
posw_xts <- as.xts(posw_DT)

total_DT <- covid_base_DT[, .SD, .SDcols = c("psxdate", "state", "total_day")]
total_DT[is.na(total_DT)] <- 0
totalw_DT <- dcast(total_DT, psxdate ~ state, value.var = c("total_day"))
totalw_DT[is.na(totalw_DT)] <- 0
totalw_xts <- as.xts(totalw_DT)

death_DT <- covid_base_DT[, .SD, .SDcols = c("psxdate", "state", "death_day")]
death_DT[is.na(death_DT)] <- 0
deathw_DT <- dcast(death_DT, psxdate ~ state, value.var = c("death_day"))
deathw_DT[is.na(deathw_DT)] <- 0
deathw_xts <- as.xts(deathw_DT)
```
```{r USA}
# USA Chunk

# By day charts

us_by_day_DT <- covid_base_DT[, lapply(.SD, sum), by = psxdate, .SDcols = c("total_day","pos_day","death_day")]
us_by_day_DT[is.na(us_by_day_DT)] <- 0
setnames(us_by_day_DT, c("total_day","pos_day","death_day"), c("Tests","Cases","Deaths"))


# Latest Day

pos_lst_DT <- head(pos_DT[, lapply(.SD, sum), by = psxdate, .SDcols = c("pos_day")], 1)
total_lst_DT <- head(total_DT[, lapply(.SD, sum), by = psxdate, .SDcols = c("total_day")], 1)
death_lst_DT <- head(death_DT[, lapply(.SD, sum), by = psxdate, .SDcols = c("death_day")], 1)
lst_DT <- merge(total_lst_DT, pos_lst_DT, by = "psxdate", nomatch = 0)
usa_lst_DT <- merge(lst_DT, death_lst_DT, by = "psxdate", nomatch = 0) 
setnames(usa_lst_DT, c("psxdate", "total_day", "pos_day", "death_day"), c("Latest_Day", "Tests", "Cases", "Deaths"))
usa_lst_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]

# Pandemic to date

today <- head(covid_base_DT[, .SD, .SDcols = c("psxdate")], 1)
covid_base_DT[is.na(covid_base_DT)] <- 0
us_ptd_DT <- covid_base_DT[, lapply(.SD, sum), .SDcols = c("total_day","pos_day","death_day")][, `:=` (Population = c(331875705))]
us_p_DT <- cbind(today, us_ptd_DT)
setnames(us_p_DT, c("psxdate","total_day","pos_day","death_day"), c("Latest_Day","Tests","Cases","Deaths"))
us_p_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
us_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


#Month State Engine  12 lines

usa_totalw_xts <- apply.monthly(totalw_xts[ ], sum)
usa_posw_xts <- apply.monthly(posw_xts[ ], sum)
usa_deathw_xts <- apply.monthly(deathw_xts[ ], sum)
days <- .indexmday(usa_totalw_xts)
usam_xts <- cbind(usa_totalw_xts, usa_posw_xts, usa_deathw_xts, days)
usam_DT <- as.data.table(usam_xts)
setnames(usam_DT, c("index","usa_totalw_xts","usa_posw_xts","usa_deathw_xts","days" ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days"))
usam_DT[, Month_Ended := strftime(Month_Ended, "%b %d %Y")]
usam_DT <- usam_DT[, `:=` (State = "USA")][, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(usam_DT, c("Month_Ended", "State", "Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day","Avg_Cases_Day" ))

#Quarter Engine  15 lines

usa_totalwq_xts <- apply.quarterly(totalw_xts[ ], sum)
usa_poswq_xts <- apply.quarterly(posw_xts[ ], sum)
usa_deathwq_xts <- apply.quarterly(deathw_xts[ ], sum)
usaq_xts <- cbind(usa_totalwq_xts, usa_poswq_xts, usa_deathwq_xts)
usaq_DT <- as.data.table(usaq_xts)
setnames(usaq_DT, c("index","usa_totalwq_xts","usa_poswq_xts","usa_deathwq_xts"), c("Quarter_Ended", "Tests", "Cases", "Deaths"))
usaq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d %Y")]
usaq_DT <- usaq_DT[, `:=` (State = "USA")][, `:=` (Pop = c(331875705))][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(usaq_DT, "Pop", "Population")
setcolorder(usaq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))
```

```{r Alabama}
# AL State Chunk 

#Latest Day

AL_totallast_DT <- as.data.table(last(totalw_xts[, "AL"]))
setnames(AL_totallast_DT, c("index", "AL"), c("Latest_Day", "Tests")) 
AL_poslast_DT <- as.data.table(last(posw_xts[, "AL"]))
setnames(AL_poslast_DT, c("index", "AL"), c("Latest_Day", "Cases")) 
AL_deathlast_DT <- as.data.table(last(deathw_xts[, "AL"]))
setnames(AL_deathlast_DT, c("index", "AL"), c("Latest_Day", "Deaths")) 
AL_L_Day_DT <- merge(AL_totallast_DT, AL_poslast_DT, by = "Latest_Day")
AL_Latest_Day_DT <- merge(AL_L_Day_DT, AL_deathlast_DT, by = "Latest_Day")
AL_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
AL_ptd_DT <- covid_base_DT[state == "AL", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
AL_pb_DT <- cbind(today, AL_ptd_DT)
setnames(AL_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
AL_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
AL_p_DT <- AL_pb_DT[states, on = .(State), nomatch = 0]
setnames(AL_p_DT, "Pop", "Population")
AL_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]

#Month

posAL_xts <- apply.monthly(posw_xts[, "AL"], sum) #month engine
totalAL_xts <- apply.monthly(totalw_xts[, "AL"], sum)
deathAL_xts <- apply.monthly(deathw_xts[, "AL"], sum)
days <- .indexmday(posAL_xts) #must use a month level table to get correct column length
ALmth <- cbind(totalAL_xts, posAL_xts, deathAL_xts, days)
ALmth_DT <- as.data.table(ALmth)
ALmth_DT <- ALmth_DT[, `:=` (State = "AL")]
setnames(ALmth_DT, c("index", "AL", "AL.1", "AL.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
ALmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
ALmth_DT<- ALmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(ALmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days",  "Avg_Deaths_Day", "Avg_Cases_Day"))  

#Quarter

posALq_xts <- apply.quarterly(posw_xts[, "AL"], sum) #quarter engine
totalALq_xts <- apply.quarterly(totalw_xts[, "AL"], sum)
deathALq_xts <- apply.quarterly(deathw_xts[, "AL"], sum)
ALq <- cbind(totalALq_xts, posALq_xts, deathALq_xts)
ALq_DT <- as.data.table(ALq)
ALq_DT <- ALq_DT[, `:=` (State = "AL")]
setnames(ALq_DT, c("index", "AL", "AL.1", "AL.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
ALq_DT <- ALq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(ALq_DT, "Pop", "Population")
setcolorder(ALq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths","Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Alaska}
# AK State Chunk 

#Lastest Day

AK_totallast_DT <- as.data.table(last(totalw_xts[, "AK"]))
setnames(AK_totallast_DT, c("index", "AK"), c("Latest_Day", "Tests")) 
AK_poslast_DT <- as.data.table(last(posw_xts[, "AK"]))
setnames(AK_poslast_DT, c("index", "AK"), c("Latest_Day", "Cases")) 
AK_deathlast_DT <- as.data.table(last(deathw_xts[, "AK"]))
setnames(AK_deathlast_DT, c("index", "AK"), c("Latest_Day", "Deaths")) 
AK_L_Day_DT <- merge(AK_totallast_DT, AK_poslast_DT, by = "Latest_Day")
AK_Latest_Day_DT <- merge(AK_L_Day_DT, AK_deathlast_DT, by = "Latest_Day")
AK_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
AK_ptd_DT <- covid_base_DT[state == "AK", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
AK_pb_DT <- cbind(today, AK_ptd_DT)
setnames(AK_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
AK_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
AK_p_DT <- AK_pb_DT[states, on = .(State), nomatch = 0]
setnames(AK_p_DT, "Pop", "Population")
AK_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


#Month

posAK_xts <- apply.monthly(posw_xts[, "AK"], sum) #month engine
totalAK_xts <- apply.monthly(totalw_xts[, "AK"], sum)
deathAK_xts <- apply.monthly(deathw_xts[, "AK"], sum)
days <- .indexmday(posAK_xts) #must use a month level table to get correct column length
AKmth <- cbind(totalAK_xts, posAK_xts, deathAK_xts, days)
AKmth_DT <- as.data.table(AKmth)
AKmth_DT <- AKmth_DT[, `:=` (State = "AK")]
setnames(AKmth_DT, c("index", "AK", "AK.1", "AK.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
AKmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
AKmth_DT<- AKmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(AKmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

#Quarter

posAKq_xts <- apply.quarterly(posw_xts[, "AK"], sum) #quarter engine
totalAKq_xts <- apply.quarterly(totalw_xts[, "AK"], sum)
deathAKq_xts <- apply.quarterly(deathw_xts[, "AK"], sum)
AKq <- cbind(totalAKq_xts, posAKq_xts, deathAKq_xts)
AKq_DT <- as.data.table(AKq)
AKq_DT <- AKq_DT[, `:=` (State = "AK")]
setnames(AKq_DT, c("index", "AK", "AK.1", "AK.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
AKq_DT <- AKq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(AKq_DT, "Pop", "Population")
setcolorder(AKq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r American Samoa}
# AS State Chunk 

#Latest Day
AS_totallast_DT <- as.data.table(last(totalw_xts[, "AS"]))
setnames(AS_totallast_DT, c("index", "AS"), c("Latest_Day", "Tests")) 
AS_poslast_DT <- as.data.table(last(posw_xts[, "AS"]))
setnames(AS_poslast_DT, c("index", "AS"), c("Latest_Day", "Cases")) 
AS_deathlast_DT <- as.data.table(last(deathw_xts[, "AS"]))
setnames(AS_deathlast_DT, c("index", "AS"), c("Latest_Day", "Deaths")) 
AS_L_Day_DT <- merge(AS_totallast_DT, AS_poslast_DT, by = "Latest_Day")
AS_Latest_Day_DT <- merge(AS_L_Day_DT, AS_deathlast_DT, by = "Latest_Day")
AS_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
AS_ptd_DT <- covid_base_DT[state == "AS", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
AS_pb_DT <- cbind(today, AS_ptd_DT)
setnames(AS_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
AS_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
AS_p_DT <- AS_pb_DT[states, on = .(State), nomatch = 0]
setnames(AS_p_DT, "Pop", "Population")
AS_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


#Month

posAS_xts <- apply.monthly(posw_xts[, "AS"], sum) #month engine
totalAS_xts <- apply.monthly(totalw_xts[, "AS"], sum)
deathAS_xts <- apply.monthly(deathw_xts[, "AS"], sum)
days <- .indexmday(posAS_xts) #must use a month level table to get correct column length
ASmth <- cbind(totalAS_xts, posAS_xts, deathAS_xts, days)
ASmth_DT <- as.data.table(ASmth)
ASmth_DT <- ASmth_DT[, `:=` (State = "AS")]
setnames(ASmth_DT, c("index", "AS", "AS.1", "AS.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
ASmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
ASmth_DT<- ASmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)]
setcolorder(ASmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days", "Avg_Cases_Day"))  

# Quarter

posASq_xts <- apply.quarterly(posw_xts[, "AS"], sum) #quarter engine
totalASq_xts <- apply.quarterly(totalw_xts[, "AS"], sum)
deathASq_xts <- apply.quarterly(deathw_xts[, "AS"], sum)
ASq <- cbind(totalASq_xts, posASq_xts, deathASq_xts)
ASq_DT <- as.data.table(ASq)
ASq_DT <- ASq_DT[, `:=` (State = "AS")]
setnames(ASq_DT, c("index", "AS", "AS.1", "AS.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
ASq_DT <- ASq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(ASq_DT, "Pop", "Population")
setcolorder(ASq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Arizona}
# AZ State Chunk 

#Latest_Day

AZ_totallast_DT <- as.data.table(last(totalw_xts[, "AZ"]))
setnames(AZ_totallast_DT, c("index", "AZ"), c("Latest_Day", "Tests")) 
AZ_poslast_DT <- as.data.table(last(posw_xts[, "AZ"]))
setnames(AZ_poslast_DT, c("index", "AZ"), c("Latest_Day", "Cases")) 
AZ_deathlast_DT <- as.data.table(last(deathw_xts[, "AZ"]))
setnames(AZ_deathlast_DT, c("index", "AZ"), c("Latest_Day", "Deaths")) 
AZ_L_Day_DT <- merge(AZ_totallast_DT, AZ_poslast_DT, by = "Latest_Day")
AZ_Latest_Day_DT <- merge(AZ_L_Day_DT, AZ_deathlast_DT, by = "Latest_Day")
AZ_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
AZ_ptd_DT <- covid_base_DT[state == "AZ", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
AZ_pb_DT <- cbind(today, AZ_ptd_DT)
setnames(AZ_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
AZ_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
AZ_p_DT <- AZ_pb_DT[states, on = .(State), nomatch = 0]
setnames(AZ_p_DT, "Pop", "Population")
AZ_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]

# Month

posAZ_xts <- apply.monthly(posw_xts[, "AZ"], sum) #month engine
totalAZ_xts <- apply.monthly(totalw_xts[, "AZ"], sum)
deathAZ_xts <- apply.monthly(deathw_xts[, "AZ"], sum)
days <- .indexmday(posAZ_xts) #must use a month level table to get correct column length
AZmth <- cbind(totalAZ_xts, posAZ_xts, deathAZ_xts, days)
AZmth_DT <- as.data.table(AZmth)
AZmth_DT <- AZmth_DT[, `:=` (State = "AZ")]
setnames(AZmth_DT, c("index", "AZ", "AZ.1", "AZ.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
AZmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
AZmth_DT<- AZmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(AZmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posAZq_xts <- apply.quarterly(posw_xts[, "AZ"], sum) #quarter engine
totalAZq_xts <- apply.quarterly(totalw_xts[, "AZ"], sum)
deathAZq_xts <- apply.quarterly(deathw_xts[, "AZ"], sum)
AZq <- cbind(totalAZq_xts, posAZq_xts, deathAZq_xts)
AZq_DT <- as.data.table(AZq)
AZq_DT <- AZq_DT[, `:=` (State = "AZ")]
setnames(AZq_DT, c("index", "AZ", "AZ.1", "AZ.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
AZq_DT <- AZq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(AZq_DT, "Pop", "Population")
setcolorder(AZq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Arkansas}
# AR State Chunk 

#Latest_Day 

AR_totallast_DT <- as.data.table(last(totalw_xts[, "AR"]))
setnames(AR_totallast_DT, c("index", "AR"), c("Latest_Day", "Tests")) 
AR_poslast_DT <- as.data.table(last(posw_xts[, "AR"]))
setnames(AR_poslast_DT, c("index", "AR"), c("Latest_Day", "Cases")) 
AR_deathlast_DT <- as.data.table(last(deathw_xts[, "AR"]))
setnames(AR_deathlast_DT, c("index", "AR"), c("Latest_Day", "Deaths")) 
AR_L_Day_DT <- merge(AR_totallast_DT, AR_poslast_DT, by = "Latest_Day")
AR_Latest_Day_DT <- merge(AR_L_Day_DT, AR_deathlast_DT, by = "Latest_Day")
AR_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
AR_ptd_DT <- covid_base_DT[state == "AR", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
AR_pb_DT <- cbind(today, AR_ptd_DT)
setnames(AR_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
AR_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
AR_p_DT <- AR_pb_DT[states, on = .(State), nomatch = 0]
setnames(AR_p_DT, "Pop", "Population")
AR_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


#Month

posAR_xts <- apply.monthly(posw_xts[, "AR"], sum) #month engine
totalAR_xts <- apply.monthly(totalw_xts[, "AR"], sum)
deathAR_xts <- apply.monthly(deathw_xts[, "AR"], sum)
days <- .indexmday(posAR_xts) #must use a month level table to get correct column length
ARmth <- cbind(totalAR_xts, posAR_xts, deathAR_xts, days)
ARmth_DT <- as.data.table(ARmth)
ARmth_DT <- ARmth_DT[, `:=` (State = "AR")]
setnames(ARmth_DT, c("index", "AR", "AR.1", "AR.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
ARmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
ARmth_DT<- ARmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(ARmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days", "Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posARq_xts <- apply.quarterly(posw_xts[, "AR"], sum) #quarter engine
totalARq_xts <- apply.quarterly(totalw_xts[, "AR"], sum)
deathARq_xts <- apply.quarterly(deathw_xts[, "AR"], sum)
ARq <- cbind(totalARq_xts, posARq_xts, deathARq_xts)
ARq_DT <- as.data.table(ARq)
ARq_DT <- ARq_DT[, `:=` (State = "AR")]
setnames(ARq_DT, c("index", "AR", "AR.1", "AR.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
ARq_DT <- ARq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(ARq_DT, "Pop", "Population")
setcolorder(ARq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r California}
# CA State Chunk 

#Latest_Day 

CA_totallast_DT <- as.data.table(last(totalw_xts[, "CA"]))
setnames(CA_totallast_DT, c("index", "CA"), c("Latest_Day", "Tests")) 
CA_poslast_DT <- as.data.table(last(posw_xts[, "CA"]))
setnames(CA_poslast_DT, c("index", "CA"), c("Latest_Day", "Cases")) 
CA_deathlast_DT <- as.data.table(last(deathw_xts[, "CA"]))
setnames(CA_deathlast_DT, c("index", "CA"), c("Latest_Day", "Deaths")) 
CA_L_Day_DT <- merge(CA_totallast_DT, CA_poslast_DT, by = "Latest_Day")
CA_Latest_Day_DT <- merge(CA_L_Day_DT, CA_deathlast_DT, by = "Latest_Day")
CA_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
CA_ptd_DT <- covid_base_DT[state == "CA", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
CA_pb_DT <- cbind(today, CA_ptd_DT)
setnames(CA_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
CA_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
CA_p_DT <- CA_pb_DT[states, on = .(State), nomatch = 0]
setnames(CA_p_DT, "Pop", "Population")
CA_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posCA_xts <- apply.monthly(posw_xts[, "CA"], sum) #month engine
totalCA_xts <- apply.monthly(totalw_xts[, "CA"], sum)
deathCA_xts <- apply.monthly(deathw_xts[, "CA"], sum)
days <- .indexmday(posCA_xts) #must use a month level table to get correct column length
CAmth <- cbind(totalCA_xts, posCA_xts, deathCA_xts, days)
CAmth_DT <- as.data.table(CAmth)
CAmth_DT <- CAmth_DT[, `:=` (State = "CA")]
setnames(CAmth_DT, c("index", "CA", "CA.1", "CA.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
CAmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
CAmth_DT<- CAmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(CAmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posCAq_xts <- apply.quarterly(posw_xts[, "CA"], sum) #quarter engine
totalCAq_xts <- apply.quarterly(totalw_xts[, "CA"], sum)
deathCAq_xts <- apply.quarterly(deathw_xts[, "CA"], sum)
CAq <- cbind(totalCAq_xts, posCAq_xts, deathCAq_xts)
CAq_DT <- as.data.table(CAq)
CAq_DT <- CAq_DT[, `:=` (State = "CA")]
setnames(CAq_DT, c("index", "CA", "CA.1", "CA.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
CAq_DT <- CAq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(CAq_DT, "Pop", "Population")
setcolorder(CAq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Colorado}
# CO State Chunk 

#Latest_Day 

CO_totallast_DT <- as.data.table(last(totalw_xts[, "CO"]))
setnames(CO_totallast_DT, c("index", "CO"), c("Latest_Day", "Tests")) 
CO_poslast_DT <- as.data.table(last(posw_xts[, "CO"]))
setnames(CO_poslast_DT, c("index", "CO"), c("Latest_Day", "Cases")) 
CO_deathlast_DT <- as.data.table(last(deathw_xts[, "CO"]))
setnames(CO_deathlast_DT, c("index", "CO"), c("Latest_Day", "Deaths")) 
CO_L_Day_DT <- merge(CO_totallast_DT, CO_poslast_DT, by = "Latest_Day")
CO_Latest_Day_DT <- merge(CO_L_Day_DT, CO_deathlast_DT, by = "Latest_Day")
CO_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
CO_ptd_DT <- covid_base_DT[state == "CO", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
CO_pb_DT <- cbind(today, CO_ptd_DT)
setnames(CO_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
CO_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
CO_p_DT <- CO_pb_DT[states, on = .(State), nomatch = 0]
setnames(CO_p_DT, "Pop", "Population")
CO_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]

#Month 

posCO_xts <- apply.monthly(posw_xts[, "CO"], sum) #month engine
totalCO_xts <- apply.monthly(totalw_xts[, "CO"], sum)
deathCO_xts <- apply.monthly(deathw_xts[, "CO"], sum)
days <- .indexmday(posCO_xts) #must use a month level table to get correct column length
COmth <- cbind(totalCO_xts, posCO_xts, deathCO_xts, days)
COmth_DT <- as.data.table(COmth)
COmth_DT <- COmth_DT[, `:=` (State = "CO")]
setnames(COmth_DT, c("index", "CO", "CO.1", "CO.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
COmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
COmth_DT<- COmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(COmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posCOq_xts <- apply.quarterly(posw_xts[, "CO"], sum) #quarter engine
totalCOq_xts <- apply.quarterly(totalw_xts[, "CO"], sum)
deathCOq_xts <- apply.quarterly(deathw_xts[, "CO"], sum)
COq <- cbind(totalCOq_xts, posCOq_xts, deathCOq_xts)
COq_DT <- as.data.table(COq)
COq_DT <- COq_DT[, `:=` (State = "CO")]
setnames(COq_DT, c("index", "CO", "CO.1", "CO.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
COq_DT <- COq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(COq_DT, "Pop", "Population")
setcolorder(COq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Connecticut}
# CT State Chunk 

#Latest_Day

CT_totallast_DT <- as.data.table(last(totalw_xts[, "CT"]))
setnames(CT_totallast_DT, c("index", "CT"), c("Latest_Day", "Tests")) 
CT_poslast_DT <- as.data.table(last(posw_xts[, "CT"]))
setnames(CT_poslast_DT, c("index", "CT"), c("Latest_Day", "Cases")) 
CT_deathlast_DT <- as.data.table(last(deathw_xts[, "CT"]))
setnames(CT_deathlast_DT, c("index", "CT"), c("Latest_Day", "Deaths")) 
CT_L_Day_DT <- merge(CT_totallast_DT, CT_poslast_DT, by = "Latest_Day")
CT_Latest_Day_DT <- merge(CT_L_Day_DT, CT_deathlast_DT, by = "Latest_Day")
CT_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
CT_ptd_DT <- covid_base_DT[state == "CT", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
CT_pb_DT <- cbind(today, CT_ptd_DT)
setnames(CT_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
CT_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
CT_p_DT <- CT_pb_DT[states, on = .(State), nomatch = 0]
setnames(CT_p_DT, "Pop", "Population")
CT_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posCT_xts <- apply.monthly(posw_xts[, "CT"], sum) #month engine
totalCT_xts <- apply.monthly(totalw_xts[, "CT"], sum)
deathCT_xts <- apply.monthly(deathw_xts[, "CT"], sum)
days <- .indexmday(posCT_xts) #must use a month level table to get correct column length
CTmth <- cbind(totalCT_xts, posCT_xts, deathCT_xts, days)
CTmth_DT <- as.data.table(CTmth)
CTmth_DT <- CTmth_DT[, `:=` (State = "CT")]
setnames(CTmth_DT, c("index", "CT", "CT.1", "CT.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
CTmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
CTmth_DT<- CTmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(CTmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posCTq_xts <- apply.quarterly(posw_xts[, "CT"], sum) #quarter engine
totalCTq_xts <- apply.quarterly(totalw_xts[, "CT"], sum)
deathCTq_xts <- apply.quarterly(deathw_xts[, "CT"], sum)
CTq <- cbind(totalCTq_xts, posCTq_xts, deathCTq_xts)
CTq_DT <- as.data.table(CTq)
CTq_DT <- CTq_DT[, `:=` (State = "CT")]
setnames(CTq_DT, c("index", "CT", "CT.1", "CT.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
CTq_DT <- CTq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(CTq_DT, "Pop", "Population")
setcolorder(CTq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r DC}
# DC State Chunk 

#Latest_Day

DC_totallast_DT <- as.data.table(last(totalw_xts[, "DC"]))
setnames(DC_totallast_DT, c("index", "DC"), c("Latest_Day", "Tests")) 
DC_poslast_DT <- as.data.table(last(posw_xts[, "DC"]))
setnames(DC_poslast_DT, c("index", "DC"), c("Latest_Day", "Cases")) 
DC_deathlast_DT <- as.data.table(last(deathw_xts[, "DC"]))
setnames(DC_deathlast_DT, c("index", "DC"), c("Latest_Day", "Deaths")) 
DC_L_Day_DT <- merge(DC_totallast_DT, DC_poslast_DT, by = "Latest_Day")
DC_Latest_Day_DT <- merge(DC_L_Day_DT, DC_deathlast_DT, by = "Latest_Day")
DC_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
DC_ptd_DT <- covid_base_DT[state == "DC", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
DC_pb_DT <- cbind(today, DC_ptd_DT)
setnames(DC_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
DC_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
DC_p_DT <- DC_pb_DT[states, on = .(State), nomatch = 0]
setnames(DC_p_DT, "Pop", "Population")
DC_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posDC_xts <- apply.monthly(posw_xts[, "DC"], sum) #month engine
totalDC_xts <- apply.monthly(totalw_xts[, "DC"], sum)
deathDC_xts <- apply.monthly(deathw_xts[, "DC"], sum)
days <- .indexmday(posDC_xts) #must use a month level table to get correct column length
DCmth <- cbind(totalDC_xts, posDC_xts, deathDC_xts, days)
DCmth_DT <- as.data.table(DCmth)
DCmth_DT <- DCmth_DT[, `:=` (State = "DC")]
setnames(DCmth_DT, c("index", "DC", "DC.1", "DC.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
DCmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
DCmth_DT<- DCmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(DCmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posDCq_xts <- apply.quarterly(posw_xts[, "DC"], sum) #quarter engine
totalDCq_xts <- apply.quarterly(totalw_xts[, "DC"], sum)
deathDCq_xts <- apply.quarterly(deathw_xts[, "DC"], sum)
DCq <- cbind(totalDCq_xts, posDCq_xts, deathDCq_xts)
DCq_DT <- as.data.table(DCq)
DCq_DT <- DCq_DT[, `:=` (State = "DC")]
setnames(DCq_DT, c("index", "DC", "DC.1", "DC.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
DCq_DT <- DCq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(DCq_DT, "Pop", "Population")
setcolorder(DCq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Delaware}
# DE State Chunk

#Latest_Day 

DE_totallast_DT <- as.data.table(last(totalw_xts[, "DE"]))
setnames(DE_totallast_DT, c("index", "DE"), c("Latest_Day", "Tests")) 
DE_poslast_DT <- as.data.table(last(posw_xts[, "DE"]))
setnames(DE_poslast_DT, c("index", "DE"), c("Latest_Day", "Cases")) 
DE_deathlast_DT <- as.data.table(last(deathw_xts[, "DE"]))
setnames(DE_deathlast_DT, c("index", "DE"), c("Latest_Day", "Deaths")) 
DE_L_Day_DT <- merge(DE_totallast_DT, DE_poslast_DT, by = "Latest_Day")
DE_Latest_Day_DT <- merge(DE_L_Day_DT, DE_deathlast_DT, by = "Latest_Day")
DE_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
DE_ptd_DT <- covid_base_DT[state == "DE", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
DE_pb_DT <- cbind(today, DE_ptd_DT)
setnames(DE_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
DE_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
DE_p_DT <- DE_pb_DT[states, on = .(State), nomatch = 0]
setnames(DE_p_DT, "Pop", "Population")
DE_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]

# Month

posDE_xts <- apply.monthly(posw_xts[, "DE"], sum) #month engine
totalDE_xts <- apply.monthly(totalw_xts[, "DE"], sum)
deathDE_xts <- apply.monthly(deathw_xts[, "DE"], sum)
days <- .indexmday(posDE_xts) #must use a month level table to get correct column length
DEmth <- cbind(totalDE_xts, posDE_xts, deathDE_xts, days)
DEmth_DT <- as.data.table(DEmth)
DEmth_DT <- DEmth_DT[, `:=` (State = "DE")]
setnames(DEmth_DT, c("index", "DE", "DE.1", "DE.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
DEmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
DEmth_DT<- DEmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(DEmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posDEq_xts <- apply.quarterly(posw_xts[, "DE"], sum) #quarter engine
totalDEq_xts <- apply.quarterly(totalw_xts[, "DE"], sum)
deathDEq_xts <- apply.quarterly(deathw_xts[, "DE"], sum)
DEq <- cbind(totalDEq_xts, posDEq_xts, deathDEq_xts)
DEq_DT <- as.data.table(DEq)
DEq_DT <- DEq_DT[, `:=` (State = "DE")]
setnames(DEq_DT, c("index", "DE", "DE.1", "DE.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
DEq_DT <- DEq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(DEq_DT, "Pop", "Population")
setcolorder(DEq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Florida}
# FL State Chunk 

#Latest_Day 

FL_totallast_DT <- as.data.table(last(totalw_xts[, "FL"]))
setnames(FL_totallast_DT, c("index", "FL"), c("Latest_Day", "Tests")) 
FL_poslast_DT <- as.data.table(last(posw_xts[, "FL"]))
setnames(FL_poslast_DT, c("index", "FL"), c("Latest_Day", "Cases")) 
FL_deathlast_DT <- as.data.table(last(deathw_xts[, "FL"]))
setnames(FL_deathlast_DT, c("index", "FL"), c("Latest_Day", "Deaths")) 
FL_L_Day_DT <- merge(FL_totallast_DT, FL_poslast_DT, by = "Latest_Day")
FL_Latest_Day_DT <- merge(FL_L_Day_DT, FL_deathlast_DT, by = "Latest_Day")
FL_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
FL_ptd_DT <- covid_base_DT[state == "FL", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
FL_pb_DT <- cbind(today, FL_ptd_DT)
setnames(FL_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
FL_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
FL_p_DT <- FL_pb_DT[states, on = .(State), nomatch = 0]
setnames(FL_p_DT, "Pop", "Population")
FL_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posFL_xts <- apply.monthly(posw_xts[, "FL"], sum) #month engine
totalFL_xts <- apply.monthly(totalw_xts[, "FL"], sum)
deathFL_xts <- apply.monthly(deathw_xts[, "FL"], sum)
days <- .indexmday(posFL_xts) #must use a month level table to get correct column length
FLmth <- cbind(totalFL_xts, posFL_xts, deathFL_xts, days)
FLmth_DT <- as.data.table(FLmth)
FLmth_DT <- FLmth_DT[, `:=` (State = "FL")]
setnames(FLmth_DT, c("index", "FL", "FL.1", "FL.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
FLmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
FLmth_DT<- FLmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(FLmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posFLq_xts <- apply.quarterly(posw_xts[, "FL"], sum) #quarter engine
totalFLq_xts <- apply.quarterly(totalw_xts[, "FL"], sum)
deathFLq_xts <- apply.quarterly(deathw_xts[, "FL"], sum)
FLq <- cbind(totalFLq_xts, posFLq_xts, deathFLq_xts)
FLq_DT <- as.data.table(FLq)
FLq_DT <- FLq_DT[, `:=` (State = "FL")]
setnames(FLq_DT, c("index", "FL", "FL.1", "FL.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
FLq_DT <- FLq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(FLq_DT, "Pop", "Population")
setcolorder(FLq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Georgia}
# GA State Chunk 

#Latest_Day 

GA_totallast_DT <- as.data.table(last(totalw_xts[, "GA"]))
setnames(GA_totallast_DT, c("index", "GA"), c("Latest_Day", "Tests")) 
GA_poslast_DT <- as.data.table(last(posw_xts[, "GA"]))
setnames(GA_poslast_DT, c("index", "GA"), c("Latest_Day", "Cases")) 
GA_deathlast_DT <- as.data.table(last(deathw_xts[, "GA"]))
setnames(GA_deathlast_DT, c("index", "GA"), c("Latest_Day", "Deaths")) 
GA_L_Day_DT <- merge(GA_totallast_DT, GA_poslast_DT, by = "Latest_Day")
GA_Latest_Day_DT <- merge(GA_L_Day_DT, GA_deathlast_DT, by = "Latest_Day")
GA_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
GA_ptd_DT <- covid_base_DT[state == "GA", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
GA_pb_DT <- cbind(today, GA_ptd_DT)
setnames(GA_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
GA_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
GA_p_DT <- GA_pb_DT[states, on = .(State), nomatch = 0]
setnames(GA_p_DT, "Pop", "Population")
GA_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


#Month

posGA_xts <- apply.monthly(posw_xts[, "GA"], sum) #month engine
totalGA_xts <- apply.monthly(totalw_xts[, "GA"], sum)
deathGA_xts <- apply.monthly(deathw_xts[, "GA"], sum)
days <- .indexmday(posGA_xts) #must use a month level table to get correct column length
GAmth <- cbind(totalGA_xts, posGA_xts, deathGA_xts, days)
GAmth_DT <- as.data.table(GAmth)
GAmth_DT <- GAmth_DT[, `:=` (State = "GA")]
setnames(GAmth_DT, c("index", "GA", "GA.1", "GA.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
GAmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
GAmth_DT<- GAmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(GAmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posGAq_xts <- apply.quarterly(posw_xts[, "GA"], sum) #quarter engine
totalGAq_xts <- apply.quarterly(totalw_xts[, "GA"], sum)
deathGAq_xts <- apply.quarterly(deathw_xts[, "GA"], sum)
GAq <- cbind(totalGAq_xts, posGAq_xts, deathGAq_xts)
GAq_DT <- as.data.table(GAq)
GAq_DT <- GAq_DT[, `:=` (State = "GA")]
setnames(GAq_DT, c("index", "GA", "GA.1", "GA.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
GAq_DT <- GAq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(GAq_DT, "Pop", "Population")
setcolorder(GAq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Guam}
# GU State Chunk 

#Latest_Day 

GU_totallast_DT <- as.data.table(last(totalw_xts[, "GU"]))
setnames(GU_totallast_DT, c("index", "GU"), c("Latest_Day", "Tests")) 
GU_poslast_DT <- as.data.table(last(posw_xts[, "GU"]))
setnames(GU_poslast_DT, c("index", "GU"), c("Latest_Day", "Cases")) 
GU_deathlast_DT <- as.data.table(last(deathw_xts[, "GU"]))
setnames(GU_deathlast_DT, c("index", "GU"), c("Latest_Day", "Deaths")) 
GU_L_Day_DT <- merge(GU_totallast_DT, GU_poslast_DT, by = "Latest_Day")
GU_Latest_Day_DT <- merge(GU_L_Day_DT, GU_deathlast_DT, by = "Latest_Day")
GU_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
GU_ptd_DT <- covid_base_DT[state == "GU", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
GU_pb_DT <- cbind(today, GU_ptd_DT)
setnames(GU_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
GU_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
GU_p_DT <- GU_pb_DT[states, on = .(State), nomatch = 0]
setnames(GU_p_DT, "Pop", "Population")
GU_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


#  Month

posGU_xts <- apply.monthly(posw_xts[, "GU"], sum) #month engine
totalGU_xts <- apply.monthly(totalw_xts[, "GU"], sum)
deathGU_xts <- apply.monthly(deathw_xts[, "GU"], sum)
days <- .indexmday(posGU_xts) #must use a month level table to get correct column length
GUmth <- cbind(totalGU_xts, posGU_xts, deathGU_xts, days)
GUmth_DT <- as.data.table(GUmth)
GUmth_DT <- GUmth_DT[, `:=` (State = "GU")]
setnames(GUmth_DT, c("index", "GU", "GU.1", "GU.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
GUmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
GUmth_DT<- GUmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(GUmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posGUq_xts <- apply.quarterly(posw_xts[, "GU"], sum) #quarter engine
totalGUq_xts <- apply.quarterly(totalw_xts[, "GU"], sum)
deathGUq_xts <- apply.quarterly(deathw_xts[, "GU"], sum)
GUq <- cbind(totalGUq_xts, posGUq_xts, deathGUq_xts)
GUq_DT <- as.data.table(GUq)
GUq_DT <- GUq_DT[, `:=` (State = "GU")]
setnames(GUq_DT, c("index", "GU", "GU.1", "GU.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
GUq_DT <- GUq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(GUq_DT, "Pop", "Population")
setcolorder(GUq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Hawaii}
# HI State Chunk

#Latest_Day 

HI_totallast_DT <- as.data.table(last(totalw_xts[, "HI"]))
setnames(HI_totallast_DT, c("index", "HI"), c("Latest_Day", "Tests")) 
HI_poslast_DT <- as.data.table(last(posw_xts[, "HI"]))
setnames(HI_poslast_DT, c("index", "HI"), c("Latest_Day", "Cases")) 
HI_deathlast_DT <- as.data.table(last(deathw_xts[, "HI"]))
setnames(HI_deathlast_DT, c("index", "HI"), c("Latest_Day", "Deaths")) 
HI_L_Day_DT <- merge(HI_totallast_DT, HI_poslast_DT, by = "Latest_Day")
HI_Latest_Day_DT <- merge(HI_L_Day_DT, HI_deathlast_DT, by = "Latest_Day")
HI_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
HI_ptd_DT <- covid_base_DT[state == "HI", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
HI_pb_DT <- cbind(today, HI_ptd_DT)
setnames(HI_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
HI_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
HI_p_DT <- HI_pb_DT[states, on = .(State), nomatch = 0]
setnames(HI_p_DT, "Pop", "Population")
HI_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posHI_xts <- apply.monthly(posw_xts[, "HI"], sum) #month engine
totalHI_xts <- apply.monthly(totalw_xts[, "HI"], sum)
deathHI_xts <- apply.monthly(deathw_xts[, "HI"], sum)
days <- .indexmday(posHI_xts) #must use a month level table to get correct column length
HImth <- cbind(totalHI_xts, posHI_xts, deathHI_xts, days)
HImth_DT <- as.data.table(HImth)
HImth_DT <- HImth_DT[, `:=` (State = "HI")]
setnames(HImth_DT, c("index", "HI", "HI.1", "HI.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
HImth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
HImth_DT<- HImth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(HImth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posHIq_xts <- apply.quarterly(posw_xts[, "HI"], sum) #quarter engine
totalHIq_xts <- apply.quarterly(totalw_xts[, "HI"], sum)
deathHIq_xts <- apply.quarterly(deathw_xts[, "HI"], sum)
HIq <- cbind(totalHIq_xts, posHIq_xts, deathHIq_xts)
HIq_DT <- as.data.table(HIq)
HIq_DT <- HIq_DT[, `:=` (State = "HI")]
setnames(HIq_DT, c("index", "HI", "HI.1", "HI.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
HIq_DT <- HIq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(HIq_DT, "Pop", "Population")
setcolorder(HIq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Idaho}
# ID State Chunk 

#Latest_Day 

ID_totallast_DT <- as.data.table(last(totalw_xts[, "ID"]))
setnames(ID_totallast_DT, c("index", "ID"), c("Latest_Day", "Tests")) 
ID_poslast_DT <- as.data.table(last(posw_xts[, "ID"]))
setnames(ID_poslast_DT, c("index", "ID"), c("Latest_Day", "Cases")) 
ID_deathlast_DT <- as.data.table(last(deathw_xts[, "ID"]))
setnames(ID_deathlast_DT, c("index", "ID"), c("Latest_Day", "Deaths")) 
ID_L_Day_DT <- merge(ID_totallast_DT, ID_poslast_DT, by = "Latest_Day")
ID_Latest_Day_DT <- merge(ID_L_Day_DT, ID_deathlast_DT, by = "Latest_Day")
ID_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
ID_ptd_DT <- covid_base_DT[state == "ID", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
ID_pb_DT <- cbind(today, ID_ptd_DT)
setnames(ID_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
ID_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
ID_p_DT <- ID_pb_DT[states, on = .(State), nomatch = 0]
setnames(ID_p_DT, "Pop", "Population")
ID_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posID_xts <- apply.monthly(posw_xts[, "ID"], sum) #month engine
totalID_xts <- apply.monthly(totalw_xts[, "ID"], sum)
deathID_xts <- apply.monthly(deathw_xts[, "ID"], sum)
days <- .indexmday(posID_xts) #must use a month level table to get correct column length
IDmth <- cbind(totalID_xts, posID_xts, deathID_xts, days)
IDmth_DT <- as.data.table(IDmth)
IDmth_DT <- IDmth_DT[, `:=` (State = "ID")]
setnames(IDmth_DT, c("index", "ID", "ID.1", "ID.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
IDmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
IDmth_DT<- IDmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(IDmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posIDq_xts <- apply.quarterly(posw_xts[, "ID"], sum) #quarter engine
totalIDq_xts <- apply.quarterly(totalw_xts[, "ID"], sum)
deathIDq_xts <- apply.quarterly(deathw_xts[, "ID"], sum)
IDq <- cbind(totalIDq_xts, posIDq_xts, deathIDq_xts)
IDq_DT <- as.data.table(IDq)
IDq_DT <- IDq_DT[, `:=` (State = "ID")]
setnames(IDq_DT, c("index", "ID", "ID.1", "ID.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
IDq_DT <- IDq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(IDq_DT, "Pop", "Population")
setcolorder(IDq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Illinois}
# IL State Chunk 

#Latest_Day 

IL_totallast_DT <- as.data.table(last(totalw_xts[, "IL"]))
setnames(IL_totallast_DT, c("index", "IL"), c("Latest_Day", "Tests")) 
IL_poslast_DT <- as.data.table(last(posw_xts[, "IL"]))
setnames(IL_poslast_DT, c("index", "IL"), c("Latest_Day", "Cases")) 
IL_deathlast_DT <- as.data.table(last(deathw_xts[, "IL"]))
setnames(IL_deathlast_DT, c("index", "IL"), c("Latest_Day", "Deaths")) 
IL_L_Day_DT <- merge(IL_totallast_DT, IL_poslast_DT, by = "Latest_Day")
IL_Latest_Day_DT <- merge(IL_L_Day_DT, IL_deathlast_DT, by = "Latest_Day")
IL_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
IL_ptd_DT <- covid_base_DT[state == "IL", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
IL_pb_DT <- cbind(today, IL_ptd_DT)
setnames(IL_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
IL_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
IL_p_DT <- IL_pb_DT[states, on = .(State), nomatch = 0]
setnames(IL_p_DT, "Pop", "Population")
IL_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posIL_xts <- apply.monthly(posw_xts[, "IL"], sum) #month engine
totalIL_xts <- apply.monthly(totalw_xts[, "IL"], sum)
deathIL_xts <- apply.monthly(deathw_xts[, "IL"], sum)
days <- .indexmday(posIL_xts) #must use a month level table to get correct column length
ILmth <- cbind(totalIL_xts, posIL_xts, deathIL_xts, days)
ILmth_DT <- as.data.table(ILmth)
ILmth_DT <- ILmth_DT[, `:=` (State = "IL")]
setnames(ILmth_DT, c("index", "IL", "IL.1", "IL.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
ILmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
ILmth_DT<- ILmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(ILmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posILq_xts <- apply.quarterly(posw_xts[, "IL"], sum) #quarter engine
totalILq_xts <- apply.quarterly(totalw_xts[, "IL"], sum)
deathILq_xts <- apply.quarterly(deathw_xts[, "IL"], sum)
ILq <- cbind(totalILq_xts, posILq_xts, deathILq_xts)
ILq_DT <- as.data.table(ILq)
ILq_DT <- ILq_DT[, `:=` (State = "IL")]
setnames(ILq_DT, c("index", "IL", "IL.1", "IL.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
ILq_DT <- ILq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(ILq_DT, "Pop", "Population")
setcolorder(ILq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Indiana}
# IN State Chunk 

#Latest_Day 

IN_totallast_DT <- as.data.table(last(totalw_xts[, "IN"]))
setnames(IN_totallast_DT, c("index", "IN"), c("Latest_Day", "Tests")) 
IN_poslast_DT <- as.data.table(last(posw_xts[, "IN"]))
setnames(IN_poslast_DT, c("index", "IN"), c("Latest_Day", "Cases")) 
IN_deathlast_DT <- as.data.table(last(deathw_xts[, "IN"]))
setnames(IN_deathlast_DT, c("index", "IN"), c("Latest_Day", "Deaths")) 
IN_L_Day_DT <- merge(IN_totallast_DT, IN_poslast_DT, by = "Latest_Day")
IN_Latest_Day_DT <- merge(IN_L_Day_DT, IN_deathlast_DT, by = "Latest_Day")
IN_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
IN_ptd_DT <- covid_base_DT[state == "IN", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
IN_pb_DT <- cbind(today, IN_ptd_DT)
setnames(IN_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
IN_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
IN_p_DT <- IN_pb_DT[states, on = .(State), nomatch = 0]
setnames(IN_p_DT, "Pop", "Population")
IN_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posIN_xts <- apply.monthly(posw_xts[, "IN"], sum) #month engine
totalIN_xts <- apply.monthly(totalw_xts[, "IN"], sum)
deathIN_xts <- apply.monthly(deathw_xts[, "IN"], sum)
days <- .indexmday(posIN_xts) #must use a month level table to get correct column length
INmth <- cbind(totalIN_xts, posIN_xts, deathIN_xts, days)
INmth_DT <- as.data.table(INmth)
INmth_DT <- INmth_DT[, `:=` (State = "IN")]
setnames(INmth_DT, c("index", "IN", "IN.1", "IN.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
INmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
INmth_DT<- INmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(INmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posINq_xts <- apply.quarterly(posw_xts[, "IN"], sum) #quarter engine
totalINq_xts <- apply.quarterly(totalw_xts[, "IN"], sum)
deathINq_xts <- apply.quarterly(deathw_xts[, "IN"], sum)
INq <- cbind(totalINq_xts, posINq_xts, deathINq_xts)
INq_DT <- as.data.table(INq)
INq_DT <- INq_DT[, `:=` (State = "IN")]
setnames(INq_DT, c("index", "IN", "IN.1", "IN.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
INq_DT <- INq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(INq_DT, "Pop", "Population")
setcolorder(INq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Iowa}
# IA State Chunk 

#Latest_Day 

IA_totallast_DT <- as.data.table(last(totalw_xts[, "IA"]))
setnames(IA_totallast_DT, c("index", "IA"), c("Latest_Day", "Tests")) 
IA_poslast_DT <- as.data.table(last(posw_xts[, "IA"]))
setnames(IA_poslast_DT, c("index", "IA"), c("Latest_Day", "Cases")) 
IA_deathlast_DT <- as.data.table(last(deathw_xts[, "IA"]))
setnames(IA_deathlast_DT, c("index", "IA"), c("Latest_Day", "Deaths")) 
IA_L_Day_DT <- merge(IA_totallast_DT, IA_poslast_DT, by = "Latest_Day")
IA_Latest_Day_DT <- merge(IA_L_Day_DT, IA_deathlast_DT, by = "Latest_Day")
IA_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
IA_ptd_DT <- covid_base_DT[state == "IA", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
IA_pb_DT <- cbind(today, IA_ptd_DT)
setnames(IA_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
IA_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
IA_p_DT <- IA_pb_DT[states, on = .(State), nomatch = 0]
setnames(IA_p_DT, "Pop", "Population")
IA_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posIA_xts <- apply.monthly(posw_xts[, "IA"], sum) #month engine
totalIA_xts <- apply.monthly(totalw_xts[, "IA"], sum)
deathIA_xts <- apply.monthly(deathw_xts[, "IA"], sum)
days <- .indexmday(posIA_xts) #must use a month level table to get correct column length
IAmth <- cbind(totalIA_xts, posIA_xts, deathIA_xts, days)
IAmth_DT <- as.data.table(IAmth)
IAmth_DT <- IAmth_DT[, `:=` (State = "IA")]
setnames(IAmth_DT, c("index", "IA", "IA.1", "IA.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
IAmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
IAmth_DT<- IAmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(IAmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days", "Avg_Deaths_Day","Avg_Cases_Day"))  

# Quarter

posIAq_xts <- apply.quarterly(posw_xts[, "IA"], sum) #quarter engine
totalIAq_xts <- apply.quarterly(totalw_xts[, "IA"], sum)
deathIAq_xts <- apply.quarterly(deathw_xts[, "IA"], sum)
IAq <- cbind(totalIAq_xts, posIAq_xts, deathIAq_xts)
IAq_DT <- as.data.table(IAq)
IAq_DT <- IAq_DT[, `:=` (State = "IA")]
setnames(IAq_DT, c("index", "IA", "IA.1", "IA.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
IAq_DT <- IAq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(IAq_DT, "Pop", "Population")
setcolorder(IAq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Kansas}
# KS State Chunk 

#Latest_Day 

KS_totallast_DT <- as.data.table(last(totalw_xts[, "KS"]))
setnames(KS_totallast_DT, c("index", "KS"), c("Latest_Day", "Tests")) 
KS_poslast_DT <- as.data.table(last(posw_xts[, "KS"]))
setnames(KS_poslast_DT, c("index", "KS"), c("Latest_Day", "Cases")) 
KS_deathlast_DT <- as.data.table(last(deathw_xts[, "KS"]))
setnames(KS_deathlast_DT, c("index", "KS"), c("Latest_Day", "Deaths")) 
KS_L_Day_DT <- merge(KS_totallast_DT, KS_poslast_DT, by = "Latest_Day")
KS_Latest_Day_DT <- merge(KS_L_Day_DT, KS_deathlast_DT, by = "Latest_Day")
KS_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
KS_ptd_DT <- covid_base_DT[state == "KS", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
KS_pb_DT <- cbind(today, KS_ptd_DT)
setnames(KS_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
KS_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
KS_p_DT <- KS_pb_DT[states, on = .(State), nomatch = 0]
setnames(KS_p_DT, "Pop", "Population")
KS_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posKS_xts <- apply.monthly(posw_xts[, "KS"], sum) #month engine
totalKS_xts <- apply.monthly(totalw_xts[, "KS"], sum)
deathKS_xts <- apply.monthly(deathw_xts[, "KS"], sum)
days <- .indexmday(posKS_xts) #must use a month level table to get correct column length
KSmth <- cbind(totalKS_xts, posKS_xts, deathKS_xts, days)
KSmth_DT <- as.data.table(KSmth)
KSmth_DT <- KSmth_DT[, `:=` (State = "KS")]
setnames(KSmth_DT, c("index", "KS", "KS.1", "KS.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
KSmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
KSmth_DT<- KSmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(KSmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posKSq_xts <- apply.quarterly(posw_xts[, "KS"], sum) #quarter engine
totalKSq_xts <- apply.quarterly(totalw_xts[, "KS"], sum)
deathKSq_xts <- apply.quarterly(deathw_xts[, "KS"], sum)
KSq <- cbind(totalKSq_xts, posKSq_xts, deathKSq_xts)
KSq_DT <- as.data.table(KSq)
KSq_DT <- KSq_DT[, `:=` (State = "KS")]
setnames(KSq_DT, c("index", "KS", "KS.1", "KS.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
KSq_DT <- KSq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(KSq_DT, "Pop", "Population")
setcolorder(KSq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Kentucky}
# KY State Chunk 

#Latest_Day 

KY_totallast_DT <- as.data.table(last(totalw_xts[, "KY"]))
setnames(KY_totallast_DT, c("index", "KY"), c("Latest_Day", "Tests")) 
KY_poslast_DT <- as.data.table(last(posw_xts[, "KY"]))
setnames(KY_poslast_DT, c("index", "KY"), c("Latest_Day", "Cases")) 
KY_deathlast_DT <- as.data.table(last(deathw_xts[, "KY"]))
setnames(KY_deathlast_DT, c("index", "KY"), c("Latest_Day", "Deaths")) 
KY_L_Day_DT <- merge(KY_totallast_DT, KY_poslast_DT, by = "Latest_Day")
KY_Latest_Day_DT <- merge(KY_L_Day_DT, KY_deathlast_DT, by = "Latest_Day")
KY_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
KY_ptd_DT <- covid_base_DT[state == "KY", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
KY_pb_DT <- cbind(today, KY_ptd_DT)
setnames(KY_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
KY_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
KY_p_DT <- KY_pb_DT[states, on = .(State), nomatch = 0]
setnames(KY_p_DT, "Pop", "Population")
KY_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posKY_xts <- apply.monthly(posw_xts[, "KY"], sum) #month engine
totalKY_xts <- apply.monthly(totalw_xts[, "KY"], sum)
deathKY_xts <- apply.monthly(deathw_xts[, "KY"], sum)
days <- .indexmday(posKY_xts) #must use a month level table to get correct column length
KYmth <- cbind(totalKY_xts, posKY_xts, deathKY_xts, days)
KYmth_DT <- as.data.table(KYmth)
KYmth_DT <- KYmth_DT[, `:=` (State = "KY")]
setnames(KYmth_DT, c("index", "KY", "KY.1", "KY.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
KYmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
KYmth_DT<- KYmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(KYmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posKYq_xts <- apply.quarterly(posw_xts[, "KY"], sum) #quarter engine
totalKYq_xts <- apply.quarterly(totalw_xts[, "KY"], sum)
deathKYq_xts <- apply.quarterly(deathw_xts[, "KY"], sum)
KYq <- cbind(totalKYq_xts, posKYq_xts, deathKYq_xts)
KYq_DT <- as.data.table(KYq)
KYq_DT <- KYq_DT[, `:=` (State = "KY")]
setnames(KYq_DT, c("index", "KY", "KY.1", "KY.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
KYq_DT <- KYq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(KYq_DT, "Pop", "Population")
setcolorder(KYq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Louisiana}
# LA State Chunk 

#Latest_Day 

LA_totallast_DT <- as.data.table(last(totalw_xts[, "LA"]))
setnames(LA_totallast_DT, c("index", "LA"), c("Latest_Day", "Tests")) 
LA_poslast_DT <- as.data.table(last(posw_xts[, "LA"]))
setnames(LA_poslast_DT, c("index", "LA"), c("Latest_Day", "Cases")) 
LA_deathlast_DT <- as.data.table(last(deathw_xts[, "LA"]))
setnames(LA_deathlast_DT, c("index", "LA"), c("Latest_Day", "Deaths")) 
LA_L_Day_DT <- merge(LA_totallast_DT, LA_poslast_DT, by = "Latest_Day")
LA_Latest_Day_DT <- merge(LA_L_Day_DT, LA_deathlast_DT, by = "Latest_Day")
LA_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
LA_ptd_DT <- covid_base_DT[state == "LA", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
LA_pb_DT <- cbind(today, LA_ptd_DT)
setnames(LA_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
LA_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
LA_p_DT <- LA_pb_DT[states, on = .(State), nomatch = 0]
setnames(LA_p_DT, "Pop", "Population")
LA_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posLA_xts <- apply.monthly(posw_xts[, "LA"], sum) #month engine
totalLA_xts <- apply.monthly(totalw_xts[, "LA"], sum)
deathLA_xts <- apply.monthly(deathw_xts[, "LA"], sum)
days <- .indexmday(posLA_xts) #must use a month level table to get correct column length
LAmth <- cbind(totalLA_xts, posLA_xts, deathLA_xts, days)
LAmth_DT <- as.data.table(LAmth)
LAmth_DT <- LAmth_DT[, `:=` (State = "LA")]
setnames(LAmth_DT, c("index", "LA", "LA.1", "LA.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
LAmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
LAmth_DT<- LAmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(LAmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posLAq_xts <- apply.quarterly(posw_xts[, "LA"], sum) #quarter engine
totalLAq_xts <- apply.quarterly(totalw_xts[, "LA"], sum)
deathLAq_xts <- apply.quarterly(deathw_xts[, "LA"], sum)
LAq <- cbind(totalLAq_xts, posLAq_xts, deathLAq_xts)
LAq_DT <- as.data.table(LAq)
LAq_DT <- LAq_DT[, `:=` (State = "LA")]
setnames(LAq_DT, c("index", "LA", "LA.1", "LA.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
LAq_DT <- LAq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(LAq_DT, "Pop", "Population")
setcolorder(LAq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Maine}
# ME State Chunk 

#Latest_Day 

ME_totallast_DT <- as.data.table(last(totalw_xts[, "ME"]))
setnames(ME_totallast_DT, c("index", "ME"), c("Latest_Day", "Tests")) 
ME_poslast_DT <- as.data.table(last(posw_xts[, "ME"]))
setnames(ME_poslast_DT, c("index", "ME"), c("Latest_Day", "Cases")) 
ME_deathlast_DT <- as.data.table(last(deathw_xts[, "ME"]))
setnames(ME_deathlast_DT, c("index", "ME"), c("Latest_Day", "Deaths")) 
ME_L_Day_DT <- merge(ME_totallast_DT, ME_poslast_DT, by = "Latest_Day")
ME_Latest_Day_DT <- merge(ME_L_Day_DT, ME_deathlast_DT, by = "Latest_Day")
ME_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
ME_ptd_DT <- covid_base_DT[state == "ME", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
ME_pb_DT <- cbind(today, ME_ptd_DT)
setnames(ME_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
ME_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
ME_p_DT <- ME_pb_DT[states, on = .(State), nomatch = 0]
setnames(ME_p_DT, "Pop", "Population")
ME_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posME_xts <- apply.monthly(posw_xts[, "ME"], sum) #month engine
totalME_xts <- apply.monthly(totalw_xts[, "ME"], sum)
deathME_xts <- apply.monthly(deathw_xts[, "ME"], sum)
days <- .indexmday(posME_xts) #must use a month level table to get correct column length
MEmth <- cbind(totalME_xts, posME_xts, deathME_xts, days)
MEmth_DT <- as.data.table(MEmth)
MEmth_DT <- MEmth_DT[, `:=` (State = "ME")]
setnames(MEmth_DT, c("index", "ME", "ME.1", "ME.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
MEmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
MEmth_DT<- MEmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(MEmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posMEq_xts <- apply.quarterly(posw_xts[, "ME"], sum) #quarter engine
totalMEq_xts <- apply.quarterly(totalw_xts[, "ME"], sum)
deathMEq_xts <- apply.quarterly(deathw_xts[, "ME"], sum)
MEq <- cbind(totalMEq_xts, posMEq_xts, deathMEq_xts)
MEq_DT <- as.data.table(MEq)
MEq_DT <- MEq_DT[, `:=` (State = "ME")]
setnames(MEq_DT, c("index", "ME", "ME.1", "ME.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
MEq_DT <- MEq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(MEq_DT, "Pop", "Population")
setcolorder(MEq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Maryland}
# MD State Chunk 

#Latest_Day 

MD_totallast_DT <- as.data.table(last(totalw_xts[, "MD"]))
setnames(MD_totallast_DT, c("index", "MD"), c("Latest_Day", "Tests")) 
MD_poslast_DT <- as.data.table(last(posw_xts[, "MD"]))
setnames(MD_poslast_DT, c("index", "MD"), c("Latest_Day", "Cases")) 
MD_deathlast_DT <- as.data.table(last(deathw_xts[, "MD"]))
setnames(MD_deathlast_DT, c("index", "MD"), c("Latest_Day", "Deaths")) 
MD_L_Day_DT <- merge(MD_totallast_DT, MD_poslast_DT, by = "Latest_Day")
MD_Latest_Day_DT <- merge(MD_L_Day_DT, MD_deathlast_DT, by = "Latest_Day")
MD_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
MD_ptd_DT <- covid_base_DT[state == "MD", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
MD_pb_DT <- cbind(today, MD_ptd_DT)
setnames(MD_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
MD_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
MD_p_DT <- MD_pb_DT[states, on = .(State), nomatch = 0]
setnames(MD_p_DT, "Pop", "Population")
MD_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posMD_xts <- apply.monthly(posw_xts[, "MD"], sum) #month engine
totalMD_xts <- apply.monthly(totalw_xts[, "MD"], sum)
deathMD_xts <- apply.monthly(deathw_xts[, "MD"], sum)
days <- .indexmday(posMD_xts) #must use a month level table to get correct column length
MDmth <- cbind(totalMD_xts, posMD_xts, deathMD_xts, days)
MDmth_DT <- as.data.table(MDmth)
MDmth_DT <- MDmth_DT[, `:=` (State = "MD")]
setnames(MDmth_DT, c("index", "MD", "MD.1", "MD.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
MDmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
MDmth_DT<- MDmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(MDmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posMDq_xts <- apply.quarterly(posw_xts[, "MD"], sum) #quarter engine
totalMDq_xts <- apply.quarterly(totalw_xts[, "MD"], sum)
deathMDq_xts <- apply.quarterly(deathw_xts[, "MD"], sum)
MDq <- cbind(totalMDq_xts, posMDq_xts, deathMDq_xts)
MDq_DT <- as.data.table(MDq)
MDq_DT <- MDq_DT[, `:=` (State = "MD")]
setnames(MDq_DT, c("index", "MD", "MD.1", "MD.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
MDq_DT <- MDq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(MDq_DT, "Pop", "Population")
setcolorder(MDq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r North Mariana Islands}
# MP State Chunk 

#Latest_Day 

MP_totallast_DT <- as.data.table(last(totalw_xts[, "MP"]))
setnames(MP_totallast_DT, c("index", "MP"), c("Latest_Day", "Tests")) 
MP_poslast_DT <- as.data.table(last(posw_xts[, "MP"]))
setnames(MP_poslast_DT, c("index", "MP"), c("Latest_Day", "Cases")) 
MP_deathlast_DT <- as.data.table(last(deathw_xts[, "MP"]))
setnames(MP_deathlast_DT, c("index", "MP"), c("Latest_Day", "Deaths")) 
MP_L_Day_DT <- merge(MP_totallast_DT, MP_poslast_DT, by = "Latest_Day")
MP_Latest_Day_DT <- merge(MP_L_Day_DT, MP_deathlast_DT, by = "Latest_Day")
MP_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
MP_ptd_DT <- covid_base_DT[state == "MP", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
MP_pb_DT <- cbind(today, MP_ptd_DT)
setnames(MP_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
MP_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
MP_p_DT <- MP_pb_DT[states, on = .(State), nomatch = 0]
setnames(MP_p_DT, "Pop", "Population")
MP_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posMP_xts <- apply.monthly(posw_xts[, "MP"], sum) #month engine
totalMP_xts <- apply.monthly(totalw_xts[, "MP"], sum)
deathMP_xts <- apply.monthly(deathw_xts[, "MP"], sum)
days <- .indexmday(posMP_xts) #must use a month level table to get correct column length
MPmth <- cbind(totalMP_xts, posMP_xts, deathMP_xts, days)
MPmth_DT <- as.data.table(MPmth)
MPmth_DT <- MPmth_DT[, `:=` (State = "MP")]
setnames(MPmth_DT, c("index", "MP", "MP.1", "MP.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
MPmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
MPmth_DT<- MPmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)]
setcolorder(MPmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days", "Avg_Cases_Day"))  

# Quarter

posMPq_xts <- apply.quarterly(posw_xts[, "MP"], sum) #quarter engine
totalMPq_xts <- apply.quarterly(totalw_xts[, "MP"], sum)
deathMPq_xts <- apply.quarterly(deathw_xts[, "MP"], sum)
MPq <- cbind(totalMPq_xts, posMPq_xts, deathMPq_xts)
MPq_DT <- as.data.table(MPq)
MPq_DT <- MPq_DT[, `:=` (State = "MP")]
setnames(MPq_DT, c("index", "MP", "MP.1", "MP.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
MPq_DT <- MPq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(MPq_DT, "Pop", "Population")
setcolorder(MPq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Massachussetts}
# MA State Chunk 

#Latest_Day 

MA_totallast_DT <- as.data.table(last(totalw_xts[, "MA"]))
setnames(MA_totallast_DT, c("index", "MA"), c("Latest_Day", "Tests")) 
MA_poslast_DT <- as.data.table(last(posw_xts[, "MA"]))
setnames(MA_poslast_DT, c("index", "MA"), c("Latest_Day", "Cases")) 
MA_deathlast_DT <- as.data.table(last(deathw_xts[, "MA"]))
setnames(MA_deathlast_DT, c("index", "MA"), c("Latest_Day", "Deaths")) 
MA_L_Day_DT <- merge(MA_totallast_DT, MA_poslast_DT, by = "Latest_Day")
MA_Latest_Day_DT <- merge(MA_L_Day_DT, MA_deathlast_DT, by = "Latest_Day")
MA_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
MA_ptd_DT <- covid_base_DT[state == "MA", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
MA_pb_DT <- cbind(today, MA_ptd_DT)
setnames(MA_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
MA_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
MA_p_DT <- MA_pb_DT[states, on = .(State), nomatch = 0]
setnames(MA_p_DT, "Pop", "Population")
MA_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posMA_xts <- apply.monthly(posw_xts[, "MA"], sum) #month engine
totalMA_xts <- apply.monthly(totalw_xts[, "MA"], sum)
deathMA_xts <- apply.monthly(deathw_xts[, "MA"], sum)
days <- .indexmday(posMA_xts) #must use a month level table to get correct column length
MAmth <- cbind(totalMA_xts, posMA_xts, deathMA_xts, days)
MAmth_DT <- as.data.table(MAmth)
MAmth_DT <- MAmth_DT[, `:=` (State = "MA")]
setnames(MAmth_DT, c("index", "MA", "MA.1", "MA.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
MAmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
MAmth_DT<- MAmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(MAmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posMAq_xts <- apply.quarterly(posw_xts[, "MA"], sum) #quarter engine
totalMAq_xts <- apply.quarterly(totalw_xts[, "MA"], sum)
deathMAq_xts <- apply.quarterly(deathw_xts[, "MA"], sum)
MAq <- cbind(totalMAq_xts, posMAq_xts, deathMAq_xts)
MAq_DT <- as.data.table(MAq)
MAq_DT <- MAq_DT[, `:=` (State = "MA")]
setnames(MAq_DT, c("index", "MA", "MA.1", "MA.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
MAq_DT <- MAq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(MAq_DT, "Pop", "Population")
setcolorder(MAq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Michigan}
# MI State Chunk 

#Latest_Day 

MI_totallast_DT <- as.data.table(last(totalw_xts[, "MI"]))
setnames(MI_totallast_DT, c("index", "MI"), c("Latest_Day", "Tests")) 
MI_poslast_DT <- as.data.table(last(posw_xts[, "MI"]))
setnames(MI_poslast_DT, c("index", "MI"), c("Latest_Day", "Cases")) 
MI_deathlast_DT <- as.data.table(last(deathw_xts[, "MI"]))
setnames(MI_deathlast_DT, c("index", "MI"), c("Latest_Day", "Deaths")) 
MI_L_Day_DT <- merge(MI_totallast_DT, MI_poslast_DT, by = "Latest_Day")
MI_Latest_Day_DT <- merge(MI_L_Day_DT, MI_deathlast_DT, by = "Latest_Day")
MI_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
MI_ptd_DT <- covid_base_DT[state == "MI", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
MI_pb_DT <- cbind(today, MI_ptd_DT)
setnames(MI_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
MI_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
MI_p_DT <- MI_pb_DT[states, on = .(State), nomatch = 0]
setnames(MI_p_DT, "Pop", "Population")
MI_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posMI_xts <- apply.monthly(posw_xts[, "MI"], sum) #month engine
totalMI_xts <- apply.monthly(totalw_xts[, "MI"], sum)
deathMI_xts <- apply.monthly(deathw_xts[, "MI"], sum)
days <- .indexmday(posMI_xts) #must use a month level table to get correct column length
MImth <- cbind(totalMI_xts, posMI_xts, deathMI_xts, days)
MImth_DT <- as.data.table(MImth)
MImth_DT <- MImth_DT[, `:=` (State = "MI")]
setnames(MImth_DT, c("index", "MI", "MI.1", "MI.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
MImth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
MImth_DT<- MImth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(MImth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posMIq_xts <- apply.quarterly(posw_xts[, "MI"], sum) #quarter engine
totalMIq_xts <- apply.quarterly(totalw_xts[, "MI"], sum)
deathMIq_xts <- apply.quarterly(deathw_xts[, "MI"], sum)
MIq <- cbind(totalMIq_xts, posMIq_xts, deathMIq_xts)
MIq_DT <- as.data.table(MIq)
MIq_DT <- MIq_DT[, `:=` (State = "MI")]
setnames(MIq_DT, c("index", "MI", "MI.1", "MI.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
MIq_DT <- MIq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(MIq_DT, "Pop", "Population")
setcolorder(MIq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Minnesota}
# MN State Chunk 

#Latest_Day 

MN_totallast_DT <- as.data.table(last(totalw_xts[, "MN"]))
setnames(MN_totallast_DT, c("index", "MN"), c("Latest_Day", "Tests")) 
MN_poslast_DT <- as.data.table(last(posw_xts[, "MN"]))
setnames(MN_poslast_DT, c("index", "MN"), c("Latest_Day", "Cases")) 
MN_deathlast_DT <- as.data.table(last(deathw_xts[, "MN"]))
setnames(MN_deathlast_DT, c("index", "MN"), c("Latest_Day", "Deaths")) 
MN_L_Day_DT <- merge(MN_totallast_DT, MN_poslast_DT, by = "Latest_Day")
MN_Latest_Day_DT <- merge(MN_L_Day_DT, MN_deathlast_DT, by = "Latest_Day")
MN_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
MN_ptd_DT <- covid_base_DT[state == "MN", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
MN_pb_DT <- cbind(today, MN_ptd_DT)
setnames(MN_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
MN_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
MN_p_DT <- MN_pb_DT[states, on = .(State), nomatch = 0]
setnames(MN_p_DT, "Pop", "Population")
MN_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posMN_xts <- apply.monthly(posw_xts[, "MN"], sum) #month engine
totalMN_xts <- apply.monthly(totalw_xts[, "MN"], sum)
deathMN_xts <- apply.monthly(deathw_xts[, "MN"], sum)
days <- .indexmday(posMN_xts) #must use a month level table to get correct column length
MNmth <- cbind(totalMN_xts, posMN_xts, deathMN_xts, days)
MNmth_DT <- as.data.table(MNmth)
MNmth_DT <- MNmth_DT[, `:=` (State = "MN")]
setnames(MNmth_DT, c("index", "MN", "MN.1", "MN.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
MNmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
MNmth_DT<- MNmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(MNmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posMNq_xts <- apply.quarterly(posw_xts[, "MN"], sum) #quarter engine
totalMNq_xts <- apply.quarterly(totalw_xts[, "MN"], sum)
deathMNq_xts <- apply.quarterly(deathw_xts[, "MN"], sum)
MNq <- cbind(totalMNq_xts, posMNq_xts, deathMNq_xts)
MNq_DT <- as.data.table(MNq)
MNq_DT <- MNq_DT[, `:=` (State = "MN")]
setnames(MNq_DT, c("index", "MN", "MN.1", "MN.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
MNq_DT <- MNq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(MNq_DT, "Pop", "Population")
setcolorder(MNq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Mississippi}
# MS State Chunk 

#Latest_Day

MS_totallast_DT <- as.data.table(last(totalw_xts[, "MS"]))
setnames(MS_totallast_DT, c("index", "MS"), c("Latest_Day", "Tests")) 
MS_poslast_DT <- as.data.table(last(posw_xts[, "MS"]))
setnames(MS_poslast_DT, c("index", "MS"), c("Latest_Day", "Cases")) 
MS_deathlast_DT <- as.data.table(last(deathw_xts[, "MS"]))
setnames(MS_deathlast_DT, c("index", "MS"), c("Latest_Day", "Deaths")) 
MS_L_Day_DT <- merge(MS_totallast_DT, MS_poslast_DT, by = "Latest_Day")
MS_Latest_Day_DT <- merge(MS_L_Day_DT, MS_deathlast_DT, by = "Latest_Day")
MS_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
MS_ptd_DT <- covid_base_DT[state == "MS", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
MS_pb_DT <- cbind(today, MS_ptd_DT)
setnames(MS_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
MS_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
MS_p_DT <- MS_pb_DT[states, on = .(State), nomatch = 0]
setnames(MS_p_DT, "Pop", "Population")
MS_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posMS_xts <- apply.monthly(posw_xts[, "MS"], sum) #month engine
totalMS_xts <- apply.monthly(totalw_xts[, "MS"], sum)
deathMS_xts <- apply.monthly(deathw_xts[, "MS"], sum)
days <- .indexmday(posMS_xts) #must use a month level table to get correct column length
MSmth <- cbind(totalMS_xts, posMS_xts, deathMS_xts, days)
MSmth_DT <- as.data.table(MSmth)
MSmth_DT <- MSmth_DT[, `:=` (State = "MS")]
setnames(MSmth_DT, c("index", "MS", "MS.1", "MS.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
MSmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
MSmth_DT<- MSmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(MSmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posMSq_xts <- apply.quarterly(posw_xts[, "MS"], sum) #quarter engine
totalMSq_xts <- apply.quarterly(totalw_xts[, "MS"], sum)
deathMSq_xts <- apply.quarterly(deathw_xts[, "MS"], sum)
MSq <- cbind(totalMSq_xts, posMSq_xts, deathMSq_xts)
MSq_DT <- as.data.table(MSq)
MSq_DT <- MSq_DT[, `:=` (State = "MS")]
setnames(MSq_DT, c("index", "MS", "MS.1", "MS.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
MSq_DT <- MSq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(MSq_DT, "Pop", "Population")
setcolorder(MSq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Missouri}
# MO State Chunk 

#Latest_Day 

MO_totallast_DT <- as.data.table(last(totalw_xts[, "MO"]))
setnames(MO_totallast_DT, c("index", "MO"), c("Latest_Day", "Tests")) 
MO_poslast_DT <- as.data.table(last(posw_xts[, "MO"]))
setnames(MO_poslast_DT, c("index", "MO"), c("Latest_Day", "Cases")) 
MO_deathlast_DT <- as.data.table(last(deathw_xts[, "MO"]))
setnames(MO_deathlast_DT, c("index", "MO"), c("Latest_Day", "Deaths")) 
MO_L_Day_DT <- merge(MO_totallast_DT, MO_poslast_DT, by = "Latest_Day")
MO_Latest_Day_DT <- merge(MO_L_Day_DT, MO_deathlast_DT, by = "Latest_Day")
MO_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
MO_ptd_DT <- covid_base_DT[state == "MO", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
MO_pb_DT <- cbind(today, MO_ptd_DT)
setnames(MO_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
MO_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
MO_p_DT <- MO_pb_DT[states, on = .(State), nomatch = 0]
setnames(MO_p_DT, "Pop", "Population")
MO_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posMO_xts <- apply.monthly(posw_xts[, "MO"], sum) #month engine
totalMO_xts <- apply.monthly(totalw_xts[, "MO"], sum)
deathMO_xts <- apply.monthly(deathw_xts[, "MO"], sum)
days <- .indexmday(posMO_xts) #must use a month level table to get correct column length
MOmth <- cbind(totalMO_xts, posMO_xts, deathMO_xts, days)
MOmth_DT <- as.data.table(MOmth)
MOmth_DT <- MOmth_DT[, `:=` (State = "MO")]
setnames(MOmth_DT, c("index", "MO", "MO.1", "MO.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
MOmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
MOmth_DT<- MOmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(MOmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posMOq_xts <- apply.quarterly(posw_xts[, "MO"], sum) #quarter engine
totalMOq_xts <- apply.quarterly(totalw_xts[, "MO"], sum)
deathMOq_xts <- apply.quarterly(deathw_xts[, "MO"], sum)
MOq <- cbind(totalMOq_xts, posMOq_xts, deathMOq_xts)
MOq_DT <- as.data.table(MOq)
MOq_DT <- MOq_DT[, `:=` (State = "MO")]
setnames(MOq_DT, c("index", "MO", "MO.1", "MO.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
MOq_DT <- MOq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(MOq_DT, "Pop", "Population")
setcolorder(MOq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Montana}
# MT State Chunk 

#Latest_Day 

MT_totallast_DT <- as.data.table(last(totalw_xts[, "MT"]))
setnames(MT_totallast_DT, c("index", "MT"), c("Latest_Day", "Tests")) 
MT_poslast_DT <- as.data.table(last(posw_xts[, "MT"]))
setnames(MT_poslast_DT, c("index", "MT"), c("Latest_Day", "Cases")) 
MT_deathlast_DT <- as.data.table(last(deathw_xts[, "MT"]))
setnames(MT_deathlast_DT, c("index", "MT"), c("Latest_Day", "Deaths")) 
MT_L_Day_DT <- merge(MT_totallast_DT, MT_poslast_DT, by = "Latest_Day")
MT_Latest_Day_DT <- merge(MT_L_Day_DT, MT_deathlast_DT, by = "Latest_Day")
MT_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
MT_ptd_DT <- covid_base_DT[state == "MT", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
MT_pb_DT <- cbind(today, MT_ptd_DT)
setnames(MT_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
MT_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
MT_p_DT <- MT_pb_DT[states, on = .(State), nomatch = 0]
setnames(MT_p_DT, "Pop", "Population")
MT_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posMT_xts <- apply.monthly(posw_xts[, "MT"], sum) #month engine
totalMT_xts <- apply.monthly(totalw_xts[, "MT"], sum)
deathMT_xts <- apply.monthly(deathw_xts[, "MT"], sum)
days <- .indexmday(posMT_xts) #must use a month level table to get correct column length
MTmth <- cbind(totalMT_xts, posMT_xts, deathMT_xts, days)
MTmth_DT <- as.data.table(MTmth)
MTmth_DT <- MTmth_DT[, `:=` (State = "MT")]
setnames(MTmth_DT, c("index", "MT", "MT.1", "MT.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
MTmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
MTmth_DT<- MTmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(MTmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posMTq_xts <- apply.quarterly(posw_xts[, "MT"], sum) #quarter engine
totalMTq_xts <- apply.quarterly(totalw_xts[, "MT"], sum)
deathMTq_xts <- apply.quarterly(deathw_xts[, "MT"], sum)
MTq <- cbind(totalMTq_xts, posMTq_xts, deathMTq_xts)
MTq_DT <- as.data.table(MTq)
MTq_DT <- MTq_DT[, `:=` (State = "MT")]
setnames(MTq_DT, c("index", "MT", "MT.1", "MT.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
MTq_DT <- MTq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(MTq_DT, "Pop", "Population")
setcolorder(MTq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Nebraska}
# NE State Chunk 

#Latest_Day 

NE_totallast_DT <- as.data.table(last(totalw_xts[, "NE"]))
setnames(NE_totallast_DT, c("index", "NE"), c("Latest_Day", "Tests")) 
NE_poslast_DT <- as.data.table(last(posw_xts[, "NE"]))
setnames(NE_poslast_DT, c("index", "NE"), c("Latest_Day", "Cases")) 
NE_deathlast_DT <- as.data.table(last(deathw_xts[, "NE"]))
setnames(NE_deathlast_DT, c("index", "NE"), c("Latest_Day", "Deaths")) 
NE_L_Day_DT <- merge(NE_totallast_DT, NE_poslast_DT, by = "Latest_Day")
NE_Latest_Day_DT <- merge(NE_L_Day_DT, NE_deathlast_DT, by = "Latest_Day")
NE_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
NE_ptd_DT <- covid_base_DT[state == "NE", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
NE_pb_DT <- cbind(today, NE_ptd_DT)
setnames(NE_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
NE_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
NE_p_DT <- NE_pb_DT[states, on = .(State), nomatch = 0]
setnames(NE_p_DT, "Pop", "Population")
NE_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posNE_xts <- apply.monthly(posw_xts[, "NE"], sum) #month engine
totalNE_xts <- apply.monthly(totalw_xts[, "NE"], sum)
deathNE_xts <- apply.monthly(deathw_xts[, "NE"], sum)
days <- .indexmday(posNE_xts) #must use a month level table to get correct column length
NEmth <- cbind(totalNE_xts, posNE_xts, deathNE_xts, days)
NEmth_DT <- as.data.table(NEmth)
NEmth_DT <- NEmth_DT[, `:=` (State = "NE")]
setnames(NEmth_DT, c("index", "NE", "NE.1", "NE.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
NEmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
NEmth_DT<- NEmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(NEmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posNEq_xts <- apply.quarterly(posw_xts[, "NE"], sum) #quarter engine
totalNEq_xts <- apply.quarterly(totalw_xts[, "NE"], sum)
deathNEq_xts <- apply.quarterly(deathw_xts[, "NE"], sum)
NEq <- cbind(totalNEq_xts, posNEq_xts, deathNEq_xts)
NEq_DT <- as.data.table(NEq)
NEq_DT <- NEq_DT[, `:=` (State = "NE")]
setnames(NEq_DT, c("index", "NE", "NE.1", "NE.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
NEq_DT <- NEq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(NEq_DT, "Pop", "Population")
setcolorder(NEq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Nevada}
# NV State Chunk

#Latest_Day 

NV_totallast_DT <- as.data.table(last(totalw_xts[, "NV"]))
setnames(NV_totallast_DT, c("index", "NV"), c("Latest_Day", "Tests")) 
NV_poslast_DT <- as.data.table(last(posw_xts[, "NV"]))
setnames(NV_poslast_DT, c("index", "NV"), c("Latest_Day", "Cases")) 
NV_deathlast_DT <- as.data.table(last(deathw_xts[, "NV"]))
setnames(NV_deathlast_DT, c("index", "NV"), c("Latest_Day", "Deaths")) 
NV_L_Day_DT <- merge(NV_totallast_DT, NV_poslast_DT, by = "Latest_Day")
NV_Latest_Day_DT <- merge(NV_L_Day_DT, NV_deathlast_DT, by = "Latest_Day")
NV_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
NV_ptd_DT <- covid_base_DT[state == "NV", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
NV_pb_DT <- cbind(today, NV_ptd_DT)
setnames(NV_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
NV_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
NV_p_DT <- NV_pb_DT[states, on = .(State), nomatch = 0]
setnames(NV_p_DT, "Pop", "Population")
NV_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posNV_xts <- apply.monthly(posw_xts[, "NV"], sum) #month engine
totalNV_xts <- apply.monthly(totalw_xts[, "NV"], sum)
deathNV_xts <- apply.monthly(deathw_xts[, "NV"], sum)
days <- .indexmday(posNV_xts) #must use a month level table to get correct column length
NVmth <- cbind(totalNV_xts, posNV_xts, deathNV_xts, days)
NVmth_DT <- as.data.table(NVmth)
NVmth_DT <- NVmth_DT[, `:=` (State = "NV")]
setnames(NVmth_DT, c("index", "NV", "NV.1", "NV.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
NVmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
NVmth_DT<- NVmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(NVmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posNVq_xts <- apply.quarterly(posw_xts[, "NV"], sum) #quarter engine
totalNVq_xts <- apply.quarterly(totalw_xts[, "NV"], sum)
deathNVq_xts <- apply.quarterly(deathw_xts[, "NV"], sum)
NVq <- cbind(totalNVq_xts, posNVq_xts, deathNVq_xts)
NVq_DT <- as.data.table(NVq)
NVq_DT <- NVq_DT[, `:=` (State = "NV")]
setnames(NVq_DT, c("index", "NV", "NV.1", "NV.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
NVq_DT <- NVq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(NVq_DT, "Pop", "Population")
setcolorder(NVq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r New Hampshire}
# NH State Chunk

#Latest_Day 

NH_totallast_DT <- as.data.table(last(totalw_xts[, "NH"]))
setnames(NH_totallast_DT, c("index", "NH"), c("Latest_Day", "Tests")) 
NH_poslast_DT <- as.data.table(last(posw_xts[, "NH"]))
setnames(NH_poslast_DT, c("index", "NH"), c("Latest_Day", "Cases")) 
NH_deathlast_DT <- as.data.table(last(deathw_xts[, "NH"]))
setnames(NH_deathlast_DT, c("index", "NH"), c("Latest_Day", "Deaths")) 
NH_L_Day_DT <- merge(NH_totallast_DT, NH_poslast_DT, by = "Latest_Day")
NH_Latest_Day_DT <- merge(NH_L_Day_DT, NH_deathlast_DT, by = "Latest_Day")
NH_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
NH_ptd_DT <- covid_base_DT[state == "NH", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
NH_pb_DT <- cbind(today, NH_ptd_DT)
setnames(NH_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
NH_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
NH_p_DT <- NH_pb_DT[states, on = .(State), nomatch = 0]
setnames(NH_p_DT, "Pop", "Population")
NH_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posNH_xts <- apply.monthly(posw_xts[, "NH"], sum) #month engine
totalNH_xts <- apply.monthly(totalw_xts[, "NH"], sum)
deathNH_xts <- apply.monthly(deathw_xts[, "NH"], sum)
days <- .indexmday(posNH_xts) #must use a month level table to get correct column length
NHmth <- cbind(totalNH_xts, posNH_xts, deathNH_xts, days)
NHmth_DT <- as.data.table(NHmth)
NHmth_DT <- NHmth_DT[, `:=` (State = "NH")]
setnames(NHmth_DT, c("index", "NH", "NH.1", "NH.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
NHmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
NHmth_DT<- NHmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(NHmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posNHq_xts <- apply.quarterly(posw_xts[, "NH"], sum) #quarter engine
totalNHq_xts <- apply.quarterly(totalw_xts[, "NH"], sum)
deathNHq_xts <- apply.quarterly(deathw_xts[, "NH"], sum)
NHq <- cbind(totalNHq_xts, posNHq_xts, deathNHq_xts)
NHq_DT <- as.data.table(NHq)
NHq_DT <- NHq_DT[, `:=` (State = "NH")]
setnames(NHq_DT, c("index", "NH", "NH.1", "NH.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
NHq_DT <- NHq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(NHq_DT, "Pop", "Population")
setcolorder(NHq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r New Jersey}
# NJ State Chunk 

#Latest_Day 

NJ_totallast_DT <- as.data.table(last(totalw_xts[, "NJ"]))
setnames(NJ_totallast_DT, c("index", "NJ"), c("Latest_Day", "Tests")) 
NJ_poslast_DT <- as.data.table(last(posw_xts[, "NJ"]))
setnames(NJ_poslast_DT, c("index", "NJ"), c("Latest_Day", "Cases")) 
NJ_deathlast_DT <- as.data.table(last(deathw_xts[, "NJ"]))
setnames(NJ_deathlast_DT, c("index", "NJ"), c("Latest_Day", "Deaths")) 
NJ_L_Day_DT <- merge(NJ_totallast_DT, NJ_poslast_DT, by = "Latest_Day")
NJ_Latest_Day_DT <- merge(NJ_L_Day_DT, NJ_deathlast_DT, by = "Latest_Day")
NJ_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
NJ_ptd_DT <- covid_base_DT[state == "NJ", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
NJ_pb_DT <- cbind(today, NJ_ptd_DT)
setnames(NJ_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
NJ_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
NJ_p_DT <- NJ_pb_DT[states, on = .(State), nomatch = 0]
setnames(NJ_p_DT, "Pop", "Population")
NJ_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posNJ_xts <- apply.monthly(posw_xts[, "NJ"], sum) #month engine
totalNJ_xts <- apply.monthly(totalw_xts[, "NJ"], sum)
deathNJ_xts <- apply.monthly(deathw_xts[, "NJ"], sum)
days <- .indexmday(posNJ_xts) #must use a month level table to get correct column length
NJmth <- cbind(totalNJ_xts, posNJ_xts, deathNJ_xts, days)
NJmth_DT <- as.data.table(NJmth)
NJmth_DT <- NJmth_DT[, `:=` (State = "NJ")]
setnames(NJmth_DT, c("index", "NJ", "NJ.1", "NJ.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
NJmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
NJmth_DT<- NJmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(NJmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posNJq_xts <- apply.quarterly(posw_xts[, "NJ"], sum) #quarter engine
totalNJq_xts <- apply.quarterly(totalw_xts[, "NJ"], sum)
deathNJq_xts <- apply.quarterly(deathw_xts[, "NJ"], sum)
NJq <- cbind(totalNJq_xts, posNJq_xts, deathNJq_xts)
NJq_DT <- as.data.table(NJq)
NJq_DT <- NJq_DT[, `:=` (State = "NJ")]
setnames(NJq_DT, c("index", "NJ", "NJ.1", "NJ.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
NJq_DT <- NJq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(NJq_DT, "Pop", "Population")
setcolorder(NJq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r New Mexico}
# NM State Chunk 

#Latest_Day 

NM_totallast_DT <- as.data.table(last(totalw_xts[, "NM"]))
setnames(NM_totallast_DT, c("index", "NM"), c("Latest_Day", "Tests")) 
NM_poslast_DT <- as.data.table(last(posw_xts[, "NM"]))
setnames(NM_poslast_DT, c("index", "NM"), c("Latest_Day", "Cases")) 
NM_deathlast_DT <- as.data.table(last(deathw_xts[, "NM"]))
setnames(NM_deathlast_DT, c("index", "NM"), c("Latest_Day", "Deaths")) 
NM_L_Day_DT <- merge(NM_totallast_DT, NM_poslast_DT, by = "Latest_Day")
NM_Latest_Day_DT <- merge(NM_L_Day_DT, NM_deathlast_DT, by = "Latest_Day")
NM_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
NM_ptd_DT <- covid_base_DT[state == "NM", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
NM_pb_DT <- cbind(today, NM_ptd_DT)
setnames(NM_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
NM_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
NM_p_DT <- NM_pb_DT[states, on = .(State), nomatch = 0]
setnames(NM_p_DT, "Pop", "Population")
NM_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posNM_xts <- apply.monthly(posw_xts[, "NM"], sum) #month engine
totalNM_xts <- apply.monthly(totalw_xts[, "NM"], sum)
deathNM_xts <- apply.monthly(deathw_xts[, "NM"], sum)
days <- .indexmday(posNM_xts) #must use a month level table to get correct column length
NMmth <- cbind(totalNM_xts, posNM_xts, deathNM_xts, days)
NMmth_DT <- as.data.table(NMmth)
NMmth_DT <- NMmth_DT[, `:=` (State = "NM")]
setnames(NMmth_DT, c("index", "NM", "NM.1", "NM.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
NMmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")][, Avg_Deaths_Day := round((Deaths / Days), 0)]
NMmth_DT<- NMmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)]
setcolorder(NMmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posNMq_xts <- apply.quarterly(posw_xts[, "NM"], sum) #quarter engine
totalNMq_xts <- apply.quarterly(totalw_xts[, "NM"], sum)
deathNMq_xts <- apply.quarterly(deathw_xts[, "NM"], sum)
NMq <- cbind(totalNMq_xts, posNMq_xts, deathNMq_xts)
NMq_DT <- as.data.table(NMq)
NMq_DT <- NMq_DT[, `:=` (State = "NM")]
setnames(NMq_DT, c("index", "NM", "NM.1", "NM.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
NMq_DT <- NMq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(NMq_DT, "Pop", "Population")
setcolorder(NMq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r New York}
# NY State Chunk 

#Latest_Day 

NY_totallast_DT <- as.data.table(last(totalw_xts[, "NY"]))
setnames(NY_totallast_DT, c("index", "NY"), c("Latest_Day", "Tests")) 
NY_poslast_DT <- as.data.table(last(posw_xts[, "NY"]))
setnames(NY_poslast_DT, c("index", "NY"), c("Latest_Day", "Cases")) 
NY_deathlast_DT <- as.data.table(last(deathw_xts[, "NY"]))
setnames(NY_deathlast_DT, c("index", "NY"), c("Latest_Day", "Deaths")) 
NY_L_Day_DT <- merge(NY_totallast_DT, NY_poslast_DT, by = "Latest_Day")
NY_Latest_Day_DT <- merge(NY_L_Day_DT, NY_deathlast_DT, by = "Latest_Day")
NY_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
NY_ptd_DT <- covid_base_DT[state == "NY", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
NY_pb_DT <- cbind(today, NY_ptd_DT)
setnames(NY_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
NY_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
NY_p_DT <- NY_pb_DT[states, on = .(State), nomatch = 0]
setnames(NY_p_DT, "Pop", "Population")
NY_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posNY_xts <- apply.monthly(posw_xts[, "NY"], sum) #month engine
totalNY_xts <- apply.monthly(totalw_xts[, "NY"], sum)
deathNY_xts <- apply.monthly(deathw_xts[, "NY"], sum)
days <- .indexmday(posNY_xts) #must use a month level table to get correct column length
NYmth <- cbind(totalNY_xts, posNY_xts, deathNY_xts, days)
NYmth_DT <- as.data.table(NYmth)
NYmth_DT <- NYmth_DT[, `:=` (State = "NY")]
setnames(NYmth_DT, c("index", "NY", "NY.1", "NY.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
NYmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
NYmth_DT<- NYmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(NYmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posNYq_xts <- apply.quarterly(posw_xts[, "NY"], sum) #quarter engine
totalNYq_xts <- apply.quarterly(totalw_xts[, "NY"], sum)
deathNYq_xts <- apply.quarterly(deathw_xts[, "NY"], sum)
NYq <- cbind(totalNYq_xts, posNYq_xts, deathNYq_xts)
NYq_DT <- as.data.table(NYq)
NYq_DT <- NYq_DT[, `:=` (State = "NY")]
setnames(NYq_DT, c("index", "NY", "NY.1", "NY.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
NYq_DT <- NYq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(NYq_DT, "Pop", "Population")
setcolorder(NYq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r North Carolina}
# NC State Chunk 

#Latest_Day 

NC_totallast_DT <- as.data.table(last(totalw_xts[, "NC"]))
setnames(NC_totallast_DT, c("index", "NC"), c("Latest_Day", "Tests")) 
NC_poslast_DT <- as.data.table(last(posw_xts[, "NC"]))
setnames(NC_poslast_DT, c("index", "NC"), c("Latest_Day", "Cases")) 
NC_deathlast_DT <- as.data.table(last(deathw_xts[, "NC"]))
setnames(NC_deathlast_DT, c("index", "NC"), c("Latest_Day", "Deaths")) 
NC_L_Day_DT <- merge(NC_totallast_DT, NC_poslast_DT, by = "Latest_Day")
NC_Latest_Day_DT <- merge(NC_L_Day_DT, NC_deathlast_DT, by = "Latest_Day")
NC_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
NC_ptd_DT <- covid_base_DT[state == "NC", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
NC_pb_DT <- cbind(today, NC_ptd_DT)
setnames(NC_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
NC_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
NC_p_DT <- NC_pb_DT[states, on = .(State), nomatch = 0]
setnames(NC_p_DT, "Pop", "Population")
NC_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posNC_xts <- apply.monthly(posw_xts[, "NC"], sum) #month engine
totalNC_xts <- apply.monthly(totalw_xts[, "NC"], sum)
deathNC_xts <- apply.monthly(deathw_xts[, "NC"], sum)
days <- .indexmday(posNC_xts) #must use a month level table to get correct column length
NCmth <- cbind(totalNC_xts, posNC_xts, deathNC_xts, days)
NCmth_DT <- as.data.table(NCmth)
NCmth_DT <- NCmth_DT[, `:=` (State = "NC")]
setnames(NCmth_DT, c("index", "NC", "NC.1", "NC.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
NCmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
NCmth_DT<- NCmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(NCmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posNCq_xts <- apply.quarterly(posw_xts[, "NC"], sum) #quarter engine
totalNCq_xts <- apply.quarterly(totalw_xts[, "NC"], sum)
deathNCq_xts <- apply.quarterly(deathw_xts[, "NC"], sum)
NCq <- cbind(totalNCq_xts, posNCq_xts, deathNCq_xts)
NCq_DT <- as.data.table(NCq)
NCq_DT <- NCq_DT[, `:=` (State = "NC")]
setnames(NCq_DT, c("index", "NC", "NC.1", "NC.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
NCq_DT <- NCq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(NCq_DT, "Pop", "Population")
setcolorder(NCq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r North Dakota}
# ND State Chunk

#Latest_Day 

ND_totallast_DT <- as.data.table(last(totalw_xts[, "ND"]))
setnames(ND_totallast_DT, c("index", "ND"), c("Latest_Day", "Tests")) 
ND_poslast_DT <- as.data.table(last(posw_xts[, "ND"]))
setnames(ND_poslast_DT, c("index", "ND"), c("Latest_Day", "Cases")) 
ND_deathlast_DT <- as.data.table(last(deathw_xts[, "ND"]))
setnames(ND_deathlast_DT, c("index", "ND"), c("Latest_Day", "Deaths")) 
ND_L_Day_DT <- merge(ND_totallast_DT, ND_poslast_DT, by = "Latest_Day")
ND_Latest_Day_DT <- merge(ND_L_Day_DT, ND_deathlast_DT, by = "Latest_Day")
ND_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
ND_ptd_DT <- covid_base_DT[state == "ND", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
ND_pb_DT <- cbind(today, ND_ptd_DT)
setnames(ND_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
ND_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
ND_p_DT <- ND_pb_DT[states, on = .(State), nomatch = 0]
setnames(ND_p_DT, "Pop", "Population")
ND_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posND_xts <- apply.monthly(posw_xts[, "ND"], sum) #month engine
totalND_xts <- apply.monthly(totalw_xts[, "ND"], sum)
deathND_xts <- apply.monthly(deathw_xts[, "ND"], sum)
days <- .indexmday(posND_xts) #must use a month level table to get correct column length
NDmth <- cbind(totalND_xts, posND_xts, deathND_xts, days)
NDmth_DT <- as.data.table(NDmth)
NDmth_DT <- NDmth_DT[, `:=` (State = "ND")]
setnames(NDmth_DT, c("index", "ND", "ND.1", "ND.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
NDmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
NDmth_DT<- NDmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(NDmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posNDq_xts <- apply.quarterly(posw_xts[, "ND"], sum) #quarter engine
totalNDq_xts <- apply.quarterly(totalw_xts[, "ND"], sum)
deathNDq_xts <- apply.quarterly(deathw_xts[, "ND"], sum)
NDq <- cbind(totalNDq_xts, posNDq_xts, deathNDq_xts)
NDq_DT <- as.data.table(NDq)
NDq_DT <- NDq_DT[, `:=` (State = "ND")]
setnames(NDq_DT, c("index", "ND", "ND.1", "ND.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
NDq_DT <- NDq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(NDq_DT, "Pop", "Population")
setcolorder(NDq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))
```
```{r Ohio}
# OH State Chunk 

#Latest_Day

OH_totallast_DT <- as.data.table(last(totalw_xts[, "OH"]))
setnames(OH_totallast_DT, c("index", "OH"), c("Latest_Day", "Tests")) 
OH_poslast_DT <- as.data.table(last(posw_xts[, "OH"]))
setnames(OH_poslast_DT, c("index", "OH"), c("Latest_Day", "Cases")) 
OH_deathlast_DT <- as.data.table(last(deathw_xts[, "OH"]))
setnames(OH_deathlast_DT, c("index", "OH"), c("Latest_Day", "Deaths")) 
OH_L_Day_DT <- merge(OH_totallast_DT, OH_poslast_DT, by = "Latest_Day")
OH_Latest_Day_DT <- merge(OH_L_Day_DT, OH_deathlast_DT, by = "Latest_Day")
OH_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
OH_ptd_DT <- covid_base_DT[state == "OH", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
OH_pb_DT <- cbind(today, OH_ptd_DT)
setnames(OH_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
OH_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
OH_p_DT <- OH_pb_DT[states, on = .(State), nomatch = 0]
setnames(OH_p_DT, "Pop", "Population")
OH_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posOH_xts <- apply.monthly(posw_xts[, "OH"], sum) #month engine
totalOH_xts <- apply.monthly(totalw_xts[, "OH"], sum)
deathOH_xts <- apply.monthly(deathw_xts[, "OH"], sum)
days <- .indexmday(posOH_xts) #must use a month level table to get correct column length
OHmth <- cbind(totalOH_xts, posOH_xts, deathOH_xts, days)
OHmth_DT <- as.data.table(OHmth)
OHmth_DT <- OHmth_DT[, `:=` (State = "OH")]
setnames(OHmth_DT, c("index", "OH", "OH.1", "OH.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
OHmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
OHmth_DT<- OHmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(OHmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posOHq_xts <- apply.quarterly(posw_xts[, "OH"], sum) #quarter engine
totalOHq_xts <- apply.quarterly(totalw_xts[, "OH"], sum)
deathOHq_xts <- apply.quarterly(deathw_xts[, "OH"], sum)
OHq <- cbind(totalOHq_xts, posOHq_xts, deathOHq_xts)
OHq_DT <- as.data.table(OHq)
OHq_DT <- OHq_DT[, `:=` (State = "OH")]
setnames(OHq_DT, c("index", "OH", "OH.1", "OH.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
OHq_DT <- OHq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(OHq_DT, "Pop", "Population")
setcolorder(OHq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Oklahoma}
# OK State Chunk 

#Latest_Day 

OK_totallast_DT <- as.data.table(last(totalw_xts[, "OK"]))
setnames(OK_totallast_DT, c("index", "OK"), c("Latest_Day", "Tests")) 
OK_poslast_DT <- as.data.table(last(posw_xts[, "OK"]))
setnames(OK_poslast_DT, c("index", "OK"), c("Latest_Day", "Cases")) 
OK_deathlast_DT <- as.data.table(last(deathw_xts[, "OK"]))
setnames(OK_deathlast_DT, c("index", "OK"), c("Latest_Day", "Deaths")) 
OK_L_Day_DT <- merge(OK_totallast_DT, OK_poslast_DT, by = "Latest_Day")
OK_Latest_Day_DT <- merge(OK_L_Day_DT, OK_deathlast_DT, by = "Latest_Day")
OK_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
OK_ptd_DT <- covid_base_DT[state == "OK", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
OK_pb_DT <- cbind(today, OK_ptd_DT)
setnames(OK_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
OK_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
OK_p_DT <- OK_pb_DT[states, on = .(State), nomatch = 0]
setnames(OK_p_DT, "Pop", "Population")
OK_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posOK_xts <- apply.monthly(posw_xts[, "OK"], sum) #month engine
totalOK_xts <- apply.monthly(totalw_xts[, "OK"], sum)
deathOK_xts <- apply.monthly(deathw_xts[, "OK"], sum)
days <- .indexmday(posOK_xts) #must use a month level table to get correct column length
OKmth <- cbind(totalOK_xts, posOK_xts, deathOK_xts, days)
OKmth_DT <- as.data.table(OKmth)
OKmth_DT <- OKmth_DT[, `:=` (State = "OK")]
setnames(OKmth_DT, c("index", "OK", "OK.1", "OK.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
OKmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
OKmth_DT<- OKmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(OKmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posOKq_xts <- apply.quarterly(posw_xts[, "OK"], sum) #quarter engine
totalOKq_xts <- apply.quarterly(totalw_xts[, "OK"], sum)
deathOKq_xts <- apply.quarterly(deathw_xts[, "OK"], sum)
OKq <- cbind(totalOKq_xts, posOKq_xts, deathOKq_xts)
OKq_DT <- as.data.table(OKq)
OKq_DT <- OKq_DT[, `:=` (State = "OK")]
setnames(OKq_DT, c("index", "OK", "OK.1", "OK.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
OKq_DT <- OKq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(OKq_DT, "Pop", "Population")
setcolorder(OKq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Oregon}
# OR State Chunk 

#Latest_Day 

OR_totallast_DT <- as.data.table(last(totalw_xts[, "OR"]))
setnames(OR_totallast_DT, c("index", "OR"), c("Latest_Day", "Tests")) 
OR_poslast_DT <- as.data.table(last(posw_xts[, "OR"]))
setnames(OR_poslast_DT, c("index", "OR"), c("Latest_Day", "Cases")) 
OR_deathlast_DT <- as.data.table(last(deathw_xts[, "OR"]))
setnames(OR_deathlast_DT, c("index", "OR"), c("Latest_Day", "Deaths")) 
OR_L_Day_DT <- merge(OR_totallast_DT, OR_poslast_DT, by = "Latest_Day")
OR_Latest_Day_DT <- merge(OR_L_Day_DT, OR_deathlast_DT, by = "Latest_Day")
OR_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
OR_ptd_DT <- covid_base_DT[state == "OR", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
OR_pb_DT <- cbind(today, OR_ptd_DT)
setnames(OR_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
OR_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
OR_p_DT <- OR_pb_DT[states, on = .(State), nomatch = 0]
setnames(OR_p_DT, "Pop", "Population")
OR_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posOR_xts <- apply.monthly(posw_xts[, "OR"], sum) #month engine
totalOR_xts <- apply.monthly(totalw_xts[, "OR"], sum)
deathOR_xts <- apply.monthly(deathw_xts[, "OR"], sum)
days <- .indexmday(posOR_xts) #must use a month level table to get correct column length
ORmth <- cbind(totalOR_xts, posOR_xts, deathOR_xts, days)
ORmth_DT <- as.data.table(ORmth)
ORmth_DT <- ORmth_DT[, `:=` (State = "OR")]
setnames(ORmth_DT, c("index", "OR", "OR.1", "OR.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
ORmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
ORmth_DT<- ORmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(ORmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posORq_xts <- apply.quarterly(posw_xts[, "OR"], sum) #quarter engine
totalORq_xts <- apply.quarterly(totalw_xts[, "OR"], sum)
deathORq_xts <- apply.quarterly(deathw_xts[, "OR"], sum)
ORq <- cbind(totalORq_xts, posORq_xts, deathORq_xts)
ORq_DT <- as.data.table(ORq)
ORq_DT <- ORq_DT[, `:=` (State = "OR")]
setnames(ORq_DT, c("index", "OR", "OR.1", "OR.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
ORq_DT <- ORq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(ORq_DT, "Pop", "Population")
setcolorder(ORq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Pennsylvania}
# PA State Chunk 

#Latest_Day 

PA_totallast_DT <- as.data.table(last(totalw_xts[, "PA"]))
setnames(PA_totallast_DT, c("index", "PA"), c("Latest_Day", "Tests")) 
PA_poslast_DT <- as.data.table(last(posw_xts[, "PA"]))
setnames(PA_poslast_DT, c("index", "PA"), c("Latest_Day", "Cases")) 
PA_deathlast_DT <- as.data.table(last(deathw_xts[, "PA"]))
setnames(PA_deathlast_DT, c("index", "PA"), c("Latest_Day", "Deaths")) 
PA_L_Day_DT <- merge(PA_totallast_DT, PA_poslast_DT, by = "Latest_Day")
PA_Latest_Day_DT <- merge(PA_L_Day_DT, PA_deathlast_DT, by = "Latest_Day")
PA_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
PA_ptd_DT <- covid_base_DT[state == "PA", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
PA_pb_DT <- cbind(today, PA_ptd_DT)
setnames(PA_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
PA_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
PA_p_DT <- PA_pb_DT[states, on = .(State), nomatch = 0]
setnames(PA_p_DT, "Pop", "Population")
PA_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posPA_xts <- apply.monthly(posw_xts[, "PA"], sum) #month engine
totalPA_xts <- apply.monthly(totalw_xts[, "PA"], sum)
deathPA_xts <- apply.monthly(deathw_xts[, "PA"], sum)
days <- .indexmday(posPA_xts) #must use a month level table to get correct column length
PAmth <- cbind(totalPA_xts, posPA_xts, deathPA_xts, days)
PAmth_DT <- as.data.table(PAmth)
PAmth_DT <- PAmth_DT[, `:=` (State = "PA")]
setnames(PAmth_DT, c("index", "PA", "PA.1", "PA.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
PAmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
PAmth_DT<- PAmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(PAmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posPAq_xts <- apply.quarterly(posw_xts[, "PA"], sum) #quarter engine
totalPAq_xts <- apply.quarterly(totalw_xts[, "PA"], sum)
deathPAq_xts <- apply.quarterly(deathw_xts[, "PA"], sum)
PAq <- cbind(totalPAq_xts, posPAq_xts, deathPAq_xts)
PAq_DT <- as.data.table(PAq)
PAq_DT <- PAq_DT[, `:=` (State = "PA")]
setnames(PAq_DT, c("index", "PA", "PA.1", "PA.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
PAq_DT <- PAq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(PAq_DT, "Pop", "Population")
setcolorder(PAq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Puerto Rico}
# PR State Chunk 

#Latest_Day 

PR_totallast_DT <- as.data.table(last(totalw_xts[, "PR"]))
setnames(PR_totallast_DT, c("index", "PR"), c("Latest_Day", "Tests")) 
PR_poslast_DT <- as.data.table(last(posw_xts[, "PR"]))
setnames(PR_poslast_DT, c("index", "PR"), c("Latest_Day", "Cases")) 
PR_deathlast_DT <- as.data.table(last(deathw_xts[, "PR"]))
setnames(PR_deathlast_DT, c("index", "PR"), c("Latest_Day", "Deaths")) 
PR_L_Day_DT <- merge(PR_totallast_DT, PR_poslast_DT, by = "Latest_Day")
PR_Latest_Day_DT <- merge(PR_L_Day_DT, PR_deathlast_DT, by = "Latest_Day")
PR_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
PR_ptd_DT <- covid_base_DT[state == "PR", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
PR_pb_DT <- cbind(today, PR_ptd_DT)
setnames(PR_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
PR_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
PR_p_DT <- PR_pb_DT[states, on = .(State), nomatch = 0]
setnames(PR_p_DT, "Pop", "Population")
PR_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posPR_xts <- apply.monthly(posw_xts[, "PR"], sum) #month engine
totalPR_xts <- apply.monthly(totalw_xts[, "PR"], sum)
deathPR_xts <- apply.monthly(deathw_xts[, "PR"], sum)
days <- .indexmday(posPR_xts) #must use a month level table to get correct column length
PRmth <- cbind(totalPR_xts, posPR_xts, deathPR_xts, days)
PRmth_DT <- as.data.table(PRmth)
PRmth_DT <- PRmth_DT[, `:=` (State = "PR")]
setnames(PRmth_DT, c("index", "PR", "PR.1", "PR.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
PRmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
PRmth_DT<- PRmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(PRmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posPRq_xts <- apply.quarterly(posw_xts[, "PR"], sum) #quarter engine
totalPRq_xts <- apply.quarterly(totalw_xts[, "PR"], sum)
deathPRq_xts <- apply.quarterly(deathw_xts[, "PR"], sum)
PRq <- cbind(totalPRq_xts, posPRq_xts, deathPRq_xts)
PRq_DT <- as.data.table(PRq)
PRq_DT <- PRq_DT[, `:=` (State = "PR")]
setnames(PRq_DT, c("index", "PR", "PR.1", "PR.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
PRq_DT <- PRq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(PRq_DT, "Pop", "Population")
setcolorder(PRq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Rhode Island}
# RI State Chunk 

#Latest_Day 

RI_totallast_DT <- as.data.table(last(totalw_xts[, "RI"]))
setnames(RI_totallast_DT, c("index", "RI"), c("Latest_Day", "Tests")) 
RI_poslast_DT <- as.data.table(last(posw_xts[, "RI"]))
setnames(RI_poslast_DT, c("index", "RI"), c("Latest_Day", "Cases")) 
RI_deathlast_DT <- as.data.table(last(deathw_xts[, "RI"]))
setnames(RI_deathlast_DT, c("index", "RI"), c("Latest_Day", "Deaths")) 
RI_L_Day_DT <- merge(RI_totallast_DT, RI_poslast_DT, by = "Latest_Day")
RI_Latest_Day_DT <- merge(RI_L_Day_DT, RI_deathlast_DT, by = "Latest_Day")
RI_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
RI_ptd_DT <- covid_base_DT[state == "RI", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
RI_pb_DT <- cbind(today, RI_ptd_DT)
setnames(RI_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
RI_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
RI_p_DT <- RI_pb_DT[states, on = .(State), nomatch = 0]
setnames(RI_p_DT, "Pop", "Population")
RI_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posRI_xts <- apply.monthly(posw_xts[, "RI"], sum) #month engine
totalRI_xts <- apply.monthly(totalw_xts[, "RI"], sum)
deathRI_xts <- apply.monthly(deathw_xts[, "RI"], sum)
days <- .indexmday(posRI_xts) #must use a month level table to get correct column length
RImth <- cbind(totalRI_xts, posRI_xts, deathRI_xts, days)
RImth_DT <- as.data.table(RImth)
RImth_DT <- RImth_DT[, `:=` (State = "RI")]
setnames(RImth_DT, c("index", "RI", "RI.1", "RI.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
RImth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
RImth_DT<- RImth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(RImth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posRIq_xts <- apply.quarterly(posw_xts[, "RI"], sum) #quarter engine
totalRIq_xts <- apply.quarterly(totalw_xts[, "RI"], sum)
deathRIq_xts <- apply.quarterly(deathw_xts[, "RI"], sum)
RIq <- cbind(totalRIq_xts, posRIq_xts, deathRIq_xts)
RIq_DT <- as.data.table(RIq)
RIq_DT <- RIq_DT[, `:=` (State = "RI")]
setnames(RIq_DT, c("index", "RI", "RI.1", "RI.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
RIq_DT <- RIq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(RIq_DT, "Pop", "Population")
setcolorder(RIq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r South Carolina}
# SC State Chunk 

#Latest_Day 

SC_totallast_DT <- as.data.table(last(totalw_xts[, "SC"]))
setnames(SC_totallast_DT, c("index", "SC"), c("Latest_Day", "Tests")) 
SC_poslast_DT <- as.data.table(last(posw_xts[, "SC"]))
setnames(SC_poslast_DT, c("index", "SC"), c("Latest_Day", "Cases")) 
SC_deathlast_DT <- as.data.table(last(deathw_xts[, "SC"]))
setnames(SC_deathlast_DT, c("index", "SC"), c("Latest_Day", "Deaths")) 
SC_L_Day_DT <- merge(SC_totallast_DT, SC_poslast_DT, by = "Latest_Day")
SC_Latest_Day_DT <- merge(SC_L_Day_DT, SC_deathlast_DT, by = "Latest_Day")
SC_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
SC_ptd_DT <- covid_base_DT[state == "SC", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
SC_pb_DT <- cbind(today, SC_ptd_DT)
setnames(SC_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
SC_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
SC_p_DT <- SC_pb_DT[states, on = .(State), nomatch = 0]
setnames(SC_p_DT, "Pop", "Population")
SC_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posSC_xts <- apply.monthly(posw_xts[, "SC"], sum) #month engine
totalSC_xts <- apply.monthly(totalw_xts[, "SC"], sum)
deathSC_xts <- apply.monthly(deathw_xts[, "SC"], sum)
days <- .indexmday(posSC_xts) #must use a month level table to get correct column length
SCmth <- cbind(totalSC_xts, posSC_xts, deathSC_xts, days)
SCmth_DT <- as.data.table(SCmth)
SCmth_DT <- SCmth_DT[, `:=` (State = "SC")]
setnames(SCmth_DT, c("index", "SC", "SC.1", "SC.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
SCmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
SCmth_DT<- SCmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(SCmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posSCq_xts <- apply.quarterly(posw_xts[, "SC"], sum) #quarter engine
totalSCq_xts <- apply.quarterly(totalw_xts[, "SC"], sum)
deathSCq_xts <- apply.quarterly(deathw_xts[, "SC"], sum)
SCq <- cbind(totalSCq_xts, posSCq_xts, deathSCq_xts)
SCq_DT <- as.data.table(SCq)
SCq_DT <- SCq_DT[, `:=` (State = "SC")]
setnames(SCq_DT, c("index", "SC", "SC.1", "SC.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
SCq_DT <- SCq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(SCq_DT, "Pop", "Population")
setcolorder(SCq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r South Dakota}
# SD State Chunk 

#Latest_Day  

SD_totallast_DT <- as.data.table(last(totalw_xts[, "SD"]))
setnames(SD_totallast_DT, c("index", "SD"), c("Latest_Day", "Tests")) 
SD_poslast_DT <- as.data.table(last(posw_xts[, "SD"]))
setnames(SD_poslast_DT, c("index", "SD"), c("Latest_Day", "Cases")) 
SD_deathlast_DT <- as.data.table(last(deathw_xts[, "SD"]))
setnames(SD_deathlast_DT, c("index", "SD"), c("Latest_Day", "Deaths")) 
SD_L_Day_DT <- merge(SD_totallast_DT, SD_poslast_DT, by = "Latest_Day")
SD_Latest_Day_DT <- merge(SD_L_Day_DT, SD_deathlast_DT, by = "Latest_Day")
SD_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
SD_ptd_DT <- covid_base_DT[state == "SD", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
SD_pb_DT <- cbind(today, SD_ptd_DT)
setnames(SD_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
SD_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
SD_p_DT <- SD_pb_DT[states, on = .(State), nomatch = 0]
setnames(SD_p_DT, "Pop", "Population")
SD_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posSD_xts <- apply.monthly(posw_xts[, "SD"], sum) #month engine
totalSD_xts <- apply.monthly(totalw_xts[, "SD"], sum)
deathSD_xts <- apply.monthly(deathw_xts[, "SD"], sum)
days <- .indexmday(posSD_xts) #must use a month level table to get correct column length
SDmth <- cbind(totalSD_xts, posSD_xts, deathSD_xts, days)
SDmth_DT <- as.data.table(SDmth)
SDmth_DT <- SDmth_DT[, `:=` (State = "SD")]
setnames(SDmth_DT, c("index", "SD", "SD.1", "SD.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
SDmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
SDmth_DT<- SDmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(SDmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posSDq_xts <- apply.quarterly(posw_xts[, "SD"], sum) #quarter engine
totalSDq_xts <- apply.quarterly(totalw_xts[, "SD"], sum)
deathSDq_xts <- apply.quarterly(deathw_xts[, "SD"], sum)
SDq <- cbind(totalSDq_xts, posSDq_xts, deathSDq_xts)
SDq_DT <- as.data.table(SDq)
SDq_DT <- SDq_DT[, `:=` (State = "SD")]
setnames(SDq_DT, c("index", "SD", "SD.1", "SD.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
SDq_DT <- SDq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(SDq_DT, "Pop", "Population")
setcolorder(SDq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Tennessee}
# TN State Chunk 

#Latest_Day 

TN_totallast_DT <- as.data.table(last(totalw_xts[, "TN"]))
setnames(TN_totallast_DT, c("index", "TN"), c("Latest_Day", "Tests")) 
TN_poslast_DT <- as.data.table(last(posw_xts[, "TN"]))
setnames(TN_poslast_DT, c("index", "TN"), c("Latest_Day", "Cases")) 
TN_deathlast_DT <- as.data.table(last(deathw_xts[, "TN"]))
setnames(TN_deathlast_DT, c("index", "TN"), c("Latest_Day", "Deaths")) 
TN_L_Day_DT <- merge(TN_totallast_DT, TN_poslast_DT, by = "Latest_Day")
TN_Latest_Day_DT <- merge(TN_L_Day_DT, TN_deathlast_DT, by = "Latest_Day")
TN_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
TN_ptd_DT <- covid_base_DT[state == "TN", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
TN_pb_DT <- cbind(today, TN_ptd_DT)
setnames(TN_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
TN_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
TN_p_DT <- TN_pb_DT[states, on = .(State), nomatch = 0]
setnames(TN_p_DT, "Pop", "Population")
TN_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posTN_xts <- apply.monthly(posw_xts[, "TN"], sum) #month engine
totalTN_xts <- apply.monthly(totalw_xts[, "TN"], sum)
deathTN_xts <- apply.monthly(deathw_xts[, "TN"], sum)
days <- .indexmday(posTN_xts) #must use a month level table to get correct column length
TNmth <- cbind(totalTN_xts, posTN_xts, deathTN_xts, days)
TNmth_DT <- as.data.table(TNmth)
TNmth_DT <- TNmth_DT[, `:=` (State = "TN")]
setnames(TNmth_DT, c("index", "TN", "TN.1", "TN.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
TNmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
TNmth_DT<- TNmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(TNmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posTNq_xts <- apply.quarterly(posw_xts[, "TN"], sum) #quarter engine
totalTNq_xts <- apply.quarterly(totalw_xts[, "TN"], sum)
deathTNq_xts <- apply.quarterly(deathw_xts[, "TN"], sum)
TNq <- cbind(totalTNq_xts, posTNq_xts, deathTNq_xts)
TNq_DT <- as.data.table(TNq)
TNq_DT <- TNq_DT[, `:=` (State = "TN")]
setnames(TNq_DT, c("index", "TN", "TN.1", "TN.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
TNq_DT <- TNq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(TNq_DT, "Pop", "Population")
setcolorder(TNq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Texas}
# TX State Chunk 

#Latest_Day 

TX_totallast_DT <- as.data.table(last(totalw_xts[, "TX"]))
setnames(TX_totallast_DT, c("index", "TX"), c("Latest_Day", "Tests")) 
TX_poslast_DT <- as.data.table(last(posw_xts[, "TX"]))
setnames(TX_poslast_DT, c("index", "TX"), c("Latest_Day", "Cases")) 
TX_deathlast_DT <- as.data.table(last(deathw_xts[, "TX"]))
setnames(TX_deathlast_DT, c("index", "TX"), c("Latest_Day", "Deaths")) 
TX_L_Day_DT <- merge(TX_totallast_DT, TX_poslast_DT, by = "Latest_Day")
TX_Latest_Day_DT <- merge(TX_L_Day_DT, TX_deathlast_DT, by = "Latest_Day")
TX_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
TX_ptd_DT <- covid_base_DT[state == "TX", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
TX_pb_DT <- cbind(today, TX_ptd_DT)
setnames(TX_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
TX_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
TX_p_DT <- TX_pb_DT[states, on = .(State), nomatch = 0]
setnames(TX_p_DT, "Pop", "Population")
TX_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posTX_xts <- apply.monthly(posw_xts[, "TX"], sum) #month engine
totalTX_xts <- apply.monthly(totalw_xts[, "TX"], sum)
deathTX_xts <- apply.monthly(deathw_xts[, "TX"], sum)
days <- .indexmday(posTX_xts) #must use a month level table to get correct column length
TXmth <- cbind(totalTX_xts, posTX_xts, deathTX_xts, days)
TXmth_DT <- as.data.table(TXmth)
TXmth_DT <- TXmth_DT[, `:=` (State = "TX")]
setnames(TXmth_DT, c("index", "TX", "TX.1", "TX.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
TXmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
TXmth_DT<- TXmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(TXmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days", "Avg_Deaths_Day","Avg_Cases_Day"))  

posTXq_xts <- apply.quarterly(posw_xts[, "TX"], sum) #quarter engine
totalTXq_xts <- apply.quarterly(totalw_xts[, "TX"], sum)
deathTXq_xts <- apply.quarterly(deathw_xts[, "TX"], sum)
TXq <- cbind(totalTXq_xts, posTXq_xts, deathTXq_xts)
TXq_DT <- as.data.table(TXq)
TXq_DT <- TXq_DT[, `:=` (State = "TX")]
setnames(TXq_DT, c("index", "TX", "TX.1", "TX.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
TXq_DT <- TXq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(TXq_DT, "Pop", "Population")
setcolorder(TXq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Utah}
# UT State Chunk 

#Latest_Day

UT_totallast_DT <- as.data.table(last(totalw_xts[, "UT"]))
setnames(UT_totallast_DT, c("index", "UT"), c("Latest_Day", "Tests")) 
UT_poslast_DT <- as.data.table(last(posw_xts[, "UT"]))
setnames(UT_poslast_DT, c("index", "UT"), c("Latest_Day", "Cases")) 
UT_deathlast_DT <- as.data.table(last(deathw_xts[, "UT"]))
setnames(UT_deathlast_DT, c("index", "UT"), c("Latest_Day", "Deaths")) 
UT_L_Day_DT <- merge(UT_totallast_DT, UT_poslast_DT, by = "Latest_Day")
UT_Latest_Day_DT <- merge(UT_L_Day_DT, UT_deathlast_DT, by = "Latest_Day")
UT_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
UT_ptd_DT <- covid_base_DT[state == "UT", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
UT_pb_DT <- cbind(today, UT_ptd_DT)
setnames(UT_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
UT_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
UT_p_DT <- UT_pb_DT[states, on = .(State), nomatch = 0]
setnames(UT_p_DT, "Pop", "Population")
UT_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posUT_xts <- apply.monthly(posw_xts[, "UT"], sum) #month engine
totalUT_xts <- apply.monthly(totalw_xts[, "UT"], sum)
deathUT_xts <- apply.monthly(deathw_xts[, "UT"], sum)
days <- .indexmday(posUT_xts) #must use a month level table to get correct column length
UTmth <- cbind(totalUT_xts, posUT_xts, deathUT_xts, days)
UTmth_DT <- as.data.table(UTmth)
UTmth_DT <- UTmth_DT[, `:=` (State = "UT")]
setnames(UTmth_DT, c("index", "UT", "UT.1", "UT.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
UTmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
UTmth_DT<- UTmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(UTmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posUTq_xts <- apply.quarterly(posw_xts[, "UT"], sum) #quarter engine
totalUTq_xts <- apply.quarterly(totalw_xts[, "UT"], sum)
deathUTq_xts <- apply.quarterly(deathw_xts[, "UT"], sum)
UTq <- cbind(totalUTq_xts, posUTq_xts, deathUTq_xts)
UTq_DT <- as.data.table(UTq)
UTq_DT <- UTq_DT[, `:=` (State = "UT")]
setnames(UTq_DT, c("index", "UT", "UT.1", "UT.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
UTq_DT <- UTq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(UTq_DT, "Pop", "Population")
setcolorder(UTq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Vermont}
# VT State Chunk 

#Latest_Day 

VT_totallast_DT <- as.data.table(last(totalw_xts[, "VT"]))
setnames(VT_totallast_DT, c("index", "VT"), c("Latest_Day", "Tests")) 
VT_poslast_DT <- as.data.table(last(posw_xts[, "VT"]))
setnames(VT_poslast_DT, c("index", "VT"), c("Latest_Day", "Cases")) 
VT_deathlast_DT <- as.data.table(last(deathw_xts[, "VT"]))
setnames(VT_deathlast_DT, c("index", "VT"), c("Latest_Day", "Deaths")) 
VT_L_Day_DT <- merge(VT_totallast_DT, VT_poslast_DT, by = "Latest_Day")
VT_Latest_Day_DT <- merge(VT_L_Day_DT, VT_deathlast_DT, by = "Latest_Day")
VT_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
VT_ptd_DT <- covid_base_DT[state == "VT", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
VT_pb_DT <- cbind(today, VT_ptd_DT)
setnames(VT_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
VT_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
VT_p_DT <- VT_pb_DT[states, on = .(State), nomatch = 0]
setnames(VT_p_DT, "Pop", "Population")
VT_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posVT_xts <- apply.monthly(posw_xts[, "VT"], sum) #month engine
totalVT_xts <- apply.monthly(totalw_xts[, "VT"], sum)
deathVT_xts <- apply.monthly(deathw_xts[, "VT"], sum)
days <- .indexmday(posVT_xts) #must use a month level table to get correct column length
VTmth <- cbind(totalVT_xts, posVT_xts, deathVT_xts, days)
VTmth_DT <- as.data.table(VTmth)
VTmth_DT <- VTmth_DT[, `:=` (State = "VT")]
setnames(VTmth_DT, c("index", "VT", "VT.1", "VT.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
VTmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
VTmth_DT<- VTmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(VTmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posVTq_xts <- apply.quarterly(posw_xts[, "VT"], sum) #quarter engine
totalVTq_xts <- apply.quarterly(totalw_xts[, "VT"], sum)
deathVTq_xts <- apply.quarterly(deathw_xts[, "VT"], sum)
VTq <- cbind(totalVTq_xts, posVTq_xts, deathVTq_xts)
VTq_DT <- as.data.table(VTq)
VTq_DT <- VTq_DT[, `:=` (State = "VT")]
setnames(VTq_DT, c("index", "VT", "VT.1", "VT.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
VTq_DT <- VTq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(VTq_DT, "Pop", "Population")
setcolorder(VTq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Virginia}
# VA State Chunk 

#Latest_Day 

VA_totallast_DT <- as.data.table(last(totalw_xts[, "VA"]))
setnames(VA_totallast_DT, c("index", "VA"), c("Latest_Day", "Tests")) 
VA_poslast_DT <- as.data.table(last(posw_xts[, "VA"]))
setnames(VA_poslast_DT, c("index", "VA"), c("Latest_Day", "Cases")) 
VA_deathlast_DT <- as.data.table(last(deathw_xts[, "VA"]))
setnames(VA_deathlast_DT, c("index", "VA"), c("Latest_Day", "Deaths")) 
VA_L_Day_DT <- merge(VA_totallast_DT, VA_poslast_DT, by = "Latest_Day")
VA_Latest_Day_DT <- merge(VA_L_Day_DT, VA_deathlast_DT, by = "Latest_Day")
VA_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
VA_ptd_DT <- covid_base_DT[state == "VA", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
VA_pb_DT <- cbind(today, VA_ptd_DT)
setnames(VA_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
VA_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
VA_p_DT <- VA_pb_DT[states, on = .(State), nomatch = 0]
setnames(VA_p_DT, "Pop", "Population")
VA_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posVA_xts <- apply.monthly(posw_xts[, "VA"], sum) #month engine
totalVA_xts <- apply.monthly(totalw_xts[, "VA"], sum)
deathVA_xts <- apply.monthly(deathw_xts[, "VA"], sum)
days <- .indexmday(posVA_xts) #must use a month level table to get correct column length
VAmth <- cbind(totalVA_xts, posVA_xts, deathVA_xts, days)
VAmth_DT <- as.data.table(VAmth)
VAmth_DT <- VAmth_DT[, `:=` (State = "VA")]
setnames(VAmth_DT, c("index", "VA", "VA.1", "VA.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
VAmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
VAmth_DT<- VAmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(VAmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posVAq_xts <- apply.quarterly(posw_xts[, "VA"], sum) #quarter engine
totalVAq_xts <- apply.quarterly(totalw_xts[, "VA"], sum)
deathVAq_xts <- apply.quarterly(deathw_xts[, "VA"], sum)
VAq <- cbind(totalVAq_xts, posVAq_xts, deathVAq_xts)
VAq_DT <- as.data.table(VAq)
VAq_DT <- VAq_DT[, `:=` (State = "VA")]
setnames(VAq_DT, c("index", "VA", "VA.1", "VA.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
VAq_DT <- VAq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(VAq_DT, "Pop", "Population")
setcolorder(VAq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Virgin Islands}
# VI State Chunk 

#Latest_Day

VI_totallast_DT <- as.data.table(last(totalw_xts[, "VI"]))
setnames(VI_totallast_DT, c("index", "VI"), c("Latest_Day", "Tests")) 
VI_poslast_DT <- as.data.table(last(posw_xts[, "VI"]))
setnames(VI_poslast_DT, c("index", "VI"), c("Latest_Day", "Cases")) 
VI_deathlast_DT <- as.data.table(last(deathw_xts[, "VI"]))
setnames(VI_deathlast_DT, c("index", "VI"), c("Latest_Day", "Deaths")) 
VI_L_Day_DT <- merge(VI_totallast_DT, VI_poslast_DT, by = "Latest_Day")
VI_Latest_Day_DT <- merge(VI_L_Day_DT, VI_deathlast_DT, by = "Latest_Day")
VI_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
VI_ptd_DT <- covid_base_DT[state == "VI", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
VI_pb_DT <- cbind(today, VI_ptd_DT)
setnames(VI_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
VI_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
VI_p_DT <- VI_pb_DT[states, on = .(State), nomatch = 0]
setnames(VI_p_DT, "Pop", "Population")
VI_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posVI_xts <- apply.monthly(posw_xts[, "VI"], sum) #month engine
totalVI_xts <- apply.monthly(totalw_xts[, "VI"], sum)
deathVI_xts <- apply.monthly(deathw_xts[, "VI"], sum)
days <- .indexmday(posVI_xts) #must use a month level table to get correct column length
VImth <- cbind(totalVI_xts, posVI_xts, deathVI_xts, days)
VImth_DT <- as.data.table(VImth)
VImth_DT <- VImth_DT[, `:=` (State = "VI")]
setnames(VImth_DT, c("index", "VI", "VI.1", "VI.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
VImth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
VImth_DT<- VImth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(VImth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posVIq_xts <- apply.quarterly(posw_xts[, "VI"], sum) #quarter engine
totalVIq_xts <- apply.quarterly(totalw_xts[, "VI"], sum)
deathVIq_xts <- apply.quarterly(deathw_xts[, "VI"], sum)
VIq <- cbind(totalVIq_xts, posVIq_xts, deathVIq_xts)
VIq_DT <- as.data.table(VIq)
VIq_DT <- VIq_DT[, `:=` (State = "VI")]
setnames(VIq_DT, c("index", "VI", "VI.1", "VI.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
VIq_DT <- VIq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(VIq_DT, "Pop", "Population")
setcolorder(VIq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Washington}
# WA State Chunk 

#Latest_Day #53

WA_totallast_DT <- as.data.table(last(totalw_xts[, "WA"]))
setnames(WA_totallast_DT, c("index", "WA"), c("Latest_Day", "Tests")) 
WA_poslast_DT <- as.data.table(last(posw_xts[, "WA"]))
setnames(WA_poslast_DT, c("index", "WA"), c("Latest_Day", "Cases")) 
WA_deathlast_DT <- as.data.table(last(deathw_xts[, "WA"]))
setnames(WA_deathlast_DT, c("index", "WA"), c("Latest_Day", "Deaths")) 
WA_L_Day_DT <- merge(WA_totallast_DT, WA_poslast_DT, by = "Latest_Day")
WA_Latest_Day_DT <- merge(WA_L_Day_DT, WA_deathlast_DT, by = "Latest_Day")
WA_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
WA_ptd_DT <- covid_base_DT[state == "WA", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
WA_pb_DT <- cbind(today, WA_ptd_DT)
setnames(WA_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
WA_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
WA_p_DT <- WA_pb_DT[states, on = .(State), nomatch = 0]
setnames(WA_p_DT, "Pop", "Population")
WA_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posWA_xts <- apply.monthly(posw_xts[, "WA"], sum) #month engine
totalWA_xts <- apply.monthly(totalw_xts[, "WA"], sum)
deathWA_xts <- apply.monthly(deathw_xts[, "WA"], sum)
days <- .indexmday(posWA_xts) #must use a month level table to get correct column length
WAmth <- cbind(totalWA_xts, posWA_xts, deathWA_xts, days)
WAmth_DT <- as.data.table(WAmth)
WAmth_DT <- WAmth_DT[, `:=` (State = "WA")]
setnames(WAmth_DT, c("index", "WA", "WA.1", "WA.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
WAmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
WAmth_DT<- WAmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(WAmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posWAq_xts <- apply.quarterly(posw_xts[, "WA"], sum) #quarter engine
totalWAq_xts <- apply.quarterly(totalw_xts[, "WA"], sum)
deathWAq_xts <- apply.quarterly(deathw_xts[, "WA"], sum)
WAq <- cbind(totalWAq_xts, posWAq_xts, deathWAq_xts)
WAq_DT <- as.data.table(WAq)
WAq_DT <- WAq_DT[, `:=` (State = "WA")]
setnames(WAq_DT, c("index", "WA", "WA.1", "WA.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
WAq_DT <- WAq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(WAq_DT, "Pop", "Population")
setcolorder(WAq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Wisconsin}
# WI State Chunk 

#Latest_Day 

WI_totallast_DT <- as.data.table(last(totalw_xts[, "WI"]))
setnames(WI_totallast_DT, c("index", "WI"), c("Latest_Day", "Tests")) 
WI_poslast_DT <- as.data.table(last(posw_xts[, "WI"]))
setnames(WI_poslast_DT, c("index", "WI"), c("Latest_Day", "Cases")) 
WI_deathlast_DT <- as.data.table(last(deathw_xts[, "WI"]))
setnames(WI_deathlast_DT, c("index", "WI"), c("Latest_Day", "Deaths")) 
WI_L_Day_DT <- merge(WI_totallast_DT, WI_poslast_DT, by = "Latest_Day")
WI_Latest_Day_DT <- merge(WI_L_Day_DT, WI_deathlast_DT, by = "Latest_Day")
WI_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
WI_ptd_DT <- covid_base_DT[state == "WI", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
WI_pb_DT <- cbind(today, WI_ptd_DT)
setnames(WI_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
WI_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
WI_p_DT <- WI_pb_DT[states, on = .(State), nomatch = 0]
setnames(WI_p_DT, "Pop", "Population")
WI_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posWI_xts <- apply.monthly(posw_xts[, "WI"], sum) #month engine
totalWI_xts <- apply.monthly(totalw_xts[, "WI"], sum)
deathWI_xts <- apply.monthly(deathw_xts[, "WI"], sum)
days <- .indexmday(posWI_xts) #must use a month level table to get correct column length
WImth <- cbind(totalWI_xts, posWI_xts, deathWI_xts, days)
WImth_DT <- as.data.table(WImth)
WImth_DT <- WImth_DT[, `:=` (State = "WI")]
setnames(WImth_DT, c("index", "WI", "WI.1", "WI.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
WImth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
WImth_DT<- WImth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(WImth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posWIq_xts <- apply.quarterly(posw_xts[, "WI"], sum) #quarter engine
totalWIq_xts <- apply.quarterly(totalw_xts[, "WI"], sum)
deathWIq_xts <- apply.quarterly(deathw_xts[, "WI"], sum)
WIq <- cbind(totalWIq_xts, posWIq_xts, deathWIq_xts)
WIq_DT <- as.data.table(WIq)
WIq_DT <- WIq_DT[, `:=` (State = "WI")]
setnames(WIq_DT, c("index", "WI", "WI.1", "WI.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
WIq_DT <- WIq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(WIq_DT, "Pop", "Population")
setcolorder(WIq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r West Virginia}
# WV State Chunk 

#Latest_Day 

WV_totallast_DT <- as.data.table(last(totalw_xts[, "WV"]))
setnames(WV_totallast_DT, c("index", "WV"), c("Latest_Day", "Tests")) 
WV_poslast_DT <- as.data.table(last(posw_xts[, "WV"]))
setnames(WV_poslast_DT, c("index", "WV"), c("Latest_Day", "Cases")) 
WV_deathlast_DT <- as.data.table(last(deathw_xts[, "WV"]))
setnames(WV_deathlast_DT, c("index", "WV"), c("Latest_Day", "Deaths")) 
WV_L_Day_DT <- merge(WV_totallast_DT, WV_poslast_DT, by = "Latest_Day")
WV_Latest_Day_DT <- merge(WV_L_Day_DT, WV_deathlast_DT, by = "Latest_Day")
WV_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
WV_ptd_DT <- covid_base_DT[state == "WV", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
WV_pb_DT <- cbind(today, WV_ptd_DT)
setnames(WV_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
WV_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
WV_p_DT <- WV_pb_DT[states, on = .(State), nomatch = 0]
setnames(WV_p_DT, "Pop", "Population")
WV_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posWV_xts <- apply.monthly(posw_xts[, "WV"], sum) #month engine
totalWV_xts <- apply.monthly(totalw_xts[, "WV"], sum)
deathWV_xts <- apply.monthly(deathw_xts[, "WV"], sum)
days <- .indexmday(posWV_xts) #must use a month level table to get correct column length
WVmth <- cbind(totalWV_xts, posWV_xts, deathWV_xts, days)
WVmth_DT <- as.data.table(WVmth)
WVmth_DT <- WVmth_DT[, `:=` (State = "WV")]
setnames(WVmth_DT, c("index", "WV", "WV.1", "WV.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
WVmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
WVmth_DT<- WVmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(WVmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posWVq_xts <- apply.quarterly(posw_xts[, "WV"], sum) #quarter engine
totalWVq_xts <- apply.quarterly(totalw_xts[, "WV"], sum)
deathWVq_xts <- apply.quarterly(deathw_xts[, "WV"], sum)
WVq <- cbind(totalWVq_xts, posWVq_xts, deathWVq_xts)
WVq_DT <- as.data.table(WVq)
WVq_DT <- WVq_DT[, `:=` (State = "WV")]
setnames(WVq_DT, c("index", "WV", "WV.1", "WV.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
WVq_DT <- WVq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(WVq_DT, "Pop", "Population")
setcolorder(WVq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))

```
```{r Wyoming}
# WY State Chunk 

#Latest_Day 

WY_totallast_DT <- as.data.table(last(totalw_xts[, "WY"]))
setnames(WY_totallast_DT, c("index", "WY"), c("Latest_Day", "Tests")) 
WY_poslast_DT <- as.data.table(last(posw_xts[, "WY"]))
setnames(WY_poslast_DT, c("index", "WY"), c("Latest_Day", "Cases")) 
WY_deathlast_DT <- as.data.table(last(deathw_xts[, "WY"]))
setnames(WY_deathlast_DT, c("index", "WY"), c("Latest_Day", "Deaths")) 
WY_L_Day_DT <- merge(WY_totallast_DT, WY_poslast_DT, by = "Latest_Day")
WY_Latest_Day_DT <- merge(WY_L_Day_DT, WY_deathlast_DT, by = "Latest_Day")
WY_Latest_Day_DT[, Latest_Day := strftime(Latest_Day, "%b %d, %Y")]

# Pandemic to Date

covid_base_DT[is.na(covid_base_DT)] <- 0
WY_ptd_DT <- covid_base_DT[state == "WY", lapply(.SD, sum), by = state, .SDcols = c("total_day","pos_day","death_day")]
WY_pb_DT <- cbind(today, WY_ptd_DT)
setnames(WY_pb_DT, c("psxdate","state", "total_day","pos_day","death_day"), c("Latest_Day", "State", "Tests", "Cases", "Deaths"))
WY_pb_DT[, Latest_Day := strftime(Latest_Day, "%b %d %Y")]
WY_p_DT <- WY_pb_DT[states, on = .(State), nomatch = 0]
setnames(WY_p_DT, "Pop", "Population")
WY_p_DT[, `:=` (Deaths_10K_pop = round((Deaths / Population) * 10000, 2), Cases_10K_pop = round((Cases / Population) * 10000, 2), Tests_10K_pop = round((Tests / Population) * 10000, 2))]


# Month

posWY_xts <- apply.monthly(posw_xts[, "WY"], sum) #month engine
totalWY_xts <- apply.monthly(totalw_xts[, "WY"], sum)
deathWY_xts <- apply.monthly(deathw_xts[, "WY"], sum)
days <- .indexmday(posWY_xts) #must use a month level table to get correct column length
WYmth <- cbind(totalWY_xts, posWY_xts, deathWY_xts, days)
WYmth_DT <- as.data.table(WYmth)
WYmth_DT <- WYmth_DT[, `:=` (State = "WY")]
setnames(WYmth_DT, c("index", "WY", "WY.1", "WY.2", "days", "State"  ), c("Month_Ended", "Tests", "Cases", "Deaths", "Days", "State"))
WYmth_DT[, Month_Ended := strftime(Month_Ended, "%b %d, %Y")]
WYmth_DT<- WYmth_DT[, Avg_Cases_Day  :=  round((Cases / Days), 0)][, Avg_Deaths_Day := round((Deaths / Days), 0)]
setcolorder(WYmth_DT, c("Month_Ended", "State","Tests", "Cases", "Deaths", "Days","Avg_Deaths_Day", "Avg_Cases_Day"))  

# Quarter

posWYq_xts <- apply.quarterly(posw_xts[, "WY"], sum) #quarter engine
totalWYq_xts <- apply.quarterly(totalw_xts[, "WY"], sum)
deathWYq_xts <- apply.quarterly(deathw_xts[, "WY"], sum)
WYq <- cbind(totalWYq_xts, posWYq_xts, deathWYq_xts)
WYq_DT <- as.data.table(WYq)
WYq_DT <- WYq_DT[, `:=` (State = "WY")]
setnames(WYq_DT, c("index", "WY", "WY.1", "WY.2", "State"), c("Quarter_Ended", "Tests", "Cases", "Deaths", "State"))
WYq_DT <- WYq_DT[states, on = .(State), nomatch = 0][, `:=` (Deaths_10K_pop = round((Deaths / Pop) * 10000, 2), Cases_10K_pop = round((Cases / Pop) * 10000, 2), Tests_10K_pop = round((Tests / Pop) * 10000, 2), Positivity_pct = round((Cases / Tests) * 100, 2), Case_fatality_pct = round((Deaths / Cases) * 100, 2))]
setnames(WYq_DT, "Pop", "Population")
setcolorder(WYq_DT, c("Quarter_Ended", "State", "Tests", "Cases", "Deaths", "Population", "Deaths_10K_pop", "Cases_10K_pop", "Tests_10K_pop", "Positivity_pct", "Case_fatality_pct" ))


```
```{r Quarter_Setup}

qtr_DT <- rbind(AKq_DT, ALq_DT, ARq_DT, ASq_DT, AZq_DT, CAq_DT, COq_DT,  CTq_DT, DCq_DT, DEq_DT, FLq_DT, GAq_DT, GUq_DT, HIq_DT, IAq_DT, IDq_DT , ILq_DT, INq_DT, KSq_DT, KYq_DT, LAq_DT, MAq_DT, MDq_DT, MEq_DT, MIq_DT, MNq_DT, MOq_DT, MPq_DT, MSq_DT, MTq_DT, NCq_DT, NDq_DT, NEq_DT, NHq_DT, NJq_DT, NMq_DT, NVq_DT, NYq_DT, OHq_DT, OKq_DT, ORq_DT, PAq_DT, PRq_DT, RIq_DT, SCq_DT, SDq_DT, TNq_DT, TXq_DT, UTq_DT, VAq_DT, VIq_DT, VTq_DT, WAq_DT, WIq_DT, WVq_DT, WYq_DT, fill = TRUE)

q1_drank <- qtr_DT[Quarter_Ended < "2020-04-01"][order (-Deaths_10K_pop)]
q1_drank$index1 <- 1:nrow(q1_drank)
q1_crank <- q1_drank[order (-Cases_10K_pop)]
q1_crank$index2 <- 1:nrow(q1_crank)
q1_trank <- q1_crank[order (-Tests_10K_pop)]
q1_trank$index3 <- 1:nrow(q1_trank)
setnames(q1_trank, old = c("index1", "index2", "index3"), new = c("Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank"))
q1_trank[, `:=` (Positivity_pct = NULL)]
q1_trank[, `:=` (Case_fatality_pct = NULL)]


q2_drank <- qtr_DT[Quarter_Ended < "2020-07-01" & Quarter_Ended > "2020-03-31"][order (-Deaths_10K_pop)]
q2_drank$index1 <- 1:nrow(q2_drank)
q2_crank <- q2_drank[order (-Cases_10K_pop)]
q2_crank$index2 <- 1:nrow(q2_crank)
q2_trank <- q2_crank[order (-Tests_10K_pop)]
q2_trank$index3 <- 1:nrow(q2_trank)
setnames(q2_trank, old = c("index1", "index2", "index3"), new = c("Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank"))
q2_trank[, `:=` (Positivity_pct = NULL)]
q2_trank[, `:=` (Case_fatality_pct = NULL)]


q3_drank <- qtr_DT[Quarter_Ended < "2020-10-01" & Quarter_Ended > "2020-06-30"][order (-Deaths_10K_pop)]
q3_drank$index1 <- 1:nrow(q3_drank)
q3_crank <- q3_drank[order (-Cases_10K_pop)]
q3_crank$index2 <- 1:nrow(q3_crank)
q3_trank <- q3_crank[order (-Tests_10K_pop)]
q3_trank$index3 <- 1:nrow(q3_trank)
setnames(q3_trank, old = c("index1", "index2", "index3"), new = c("Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank"))
q3_trank[, `:=` (Positivity_pct = NULL)]
q3_trank[, `:=` (Case_fatality_pct = NULL)]


q4_drank <- qtr_DT[Quarter_Ended < "2021-01-01" & Quarter_Ended > "2020-09-30"][order (-Deaths_10K_pop)]
q4_drank$index1 <- 1:nrow(q4_drank)
q4_crank <- q4_drank[order (-Cases_10K_pop)]
q4_crank$index2 <- 1:nrow(q4_crank)
q4_trank <- q4_crank[order (-Tests_10K_pop)]
q4_trank$index3 <- 1:nrow(q4_trank)
setnames(q4_trank, old = c("index1", "index2", "index3"), new = c("Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank"))
q4_trank[, `:=` (Positivity_pct = NULL)]
q4_trank[, `:=` (Case_fatality_pct = NULL)]

q5_drank <- qtr_DT[Quarter_Ended < "2021-04-01" & Quarter_Ended > "2020-12-31"][order (-Deaths_10K_pop)]
q5_drank$index1 <- 1:nrow(q5_drank)
q5_crank <- q5_drank[order (-Cases_10K_pop)]
q5_crank$index2 <- 1:nrow(q5_crank)
q5_trank <- q5_crank[order (-Tests_10K_pop)]
q5_trank$index3 <- 1:nrow(q5_trank)
setnames(q5_trank, old = c("index1", "index2", "index3"), new = c("Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank"))
q5_trank[, `:=` (Positivity_pct = NULL)]
q5_trank[, `:=` (Case_fatality_pct = NULL)]

q6_drank <- qtr_DT[Quarter_Ended < "2021-07-01" & Quarter_Ended > "2021-3-31"][order (-Deaths_10K_pop)]
q6_drank$index1 <- 1:nrow(q6_drank)
q6_crank <- q6_drank[order (-Cases_10K_pop)]
q6_crank$index2 <- 1:nrow(q6_crank)
q6_trank <- q6_crank[order (-Tests_10K_pop)]
q6_trank$index3 <- 1:nrow(q6_trank)
setnames(q6_trank, old = c("index1", "index2", "index3"), new = c("Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank"))
q6_trank[, `:=` (Positivity_pct = NULL)]
q6_trank[, `:=` (Case_fatality_pct = NULL)]
```
# Introduction

### Data

The data are drawn from the Covid Tracking Project developed by The Atlantic magazine and are refreshed daily. 
The Covid Tracking Project can be found at https://covidtracking.com/ . 
It collects its data from all of the states and US territories and provides links to state websites allowing for easy drill down to actual state data if necessary, although all data used here is from the Covid Tracking Project itself.
The population data were pulled from Wikipedia, they are estimates as of July 2019.

### Tables & Charts by Day (for USA)

There is a section for the USA and for each of the states which all show the same format tables:-

1.	"Latest Day"
 Shows the number of tests, cases and deaths for the latest available day

2.	"Pandemic to Date" 
   Shows tests, cases, deaths, and the metrics Deaths_10K_pop (deaths per 10,000 people) and Cases_10K_pop (cases per 10,000 people). These metrics are used throughout to provide comparability between time periods and between the states. A summary table is provided in section 4 ranking all states on a Pandemic to Date Basis in terms of Deaths_10K_pop.

3.	"By Month"
  Shows tests, cases and deaths by month and includes two other metrics,  Avg_Deaths_Day and Avg_Cases_Day. These show the "trajectory" of infection and mortality for the USA as a whole and for each state.
  
There are three line charts in the USA section showing tests, cases and deaths by day.

4.	"By Quarter"

Fields are :- 

Tests; 

Cases; 

Deaths; 

Deaths_10K_pop; 

Cases_10K_pop; 

Tests_10K_pop; 

Positivity_pct - measuring of those tested, what percentage test positive.

Case_Fatality_pct - measuring “survivability” by showing in what percentage of those infected was the outcome fatal. 


### Charts - By Month (for all states )

The "By Month " section for each state includes 2 charts with the table. 

The information in the charts is a visual presentation of the information in the table. 

The first chart plots the average cases per day by month column (Avg_Cases_Day) shown in the table. It is a visualzation of the "trajectory" of the pandemic, a visual reiteration of the average daily values for cases and deaths shown in the table. The table and first chart show "where we've been" and suggest "where we're headed".  

The second chart is a visualization of the correlation in each state between the number of cases and the number of deaths. At a national level there have been `r us_p_DT[1, 6]` Deaths per 10,000 population - which is `r us_p_DT[1, 6] / 100`% of the population, whereas cases have been `r us_p_DT[1,7]` which is `r us_p_DT[1,7] / 100`% of the population. In other words cases have been `r us_p_DT[1,7] / us_p_DT[1,6]` times higher than deaths at the US level (there is considerable varation amongst the states which is best seen by looking at the table in section 4 - Pandemic to Date Ranking). Given this high multiple, the second chart uses a logarithmic 'y' axis scale rather than the linear y axis scale used in the first chart. The logarithmic scale enables the relationship between deaths and cases to be visualized. To clearly understand the underlying values refer to the table.`

There is a small analysis of correlations between cases, tests and deaths in section 6 the results of which drove the selection of these two charts.

### All States Pandemic to Date 

The Pandemic to Date table is intended as a quick reference summary of conditions in all states. It is sorted by Deaths_10K_pop in descending order.

There are significant differences in mortality and infection states between states. 

### All States Ranking by Quarter

There is a summary table of state rankings for each quarter for quick comparison.

### Correlations

See section for comments.
```{=latex}

\newpage

```
# USA

## Latest Day & Pandemic to Date

```{r USA qtr setup}

q1_usa <- q1_trank[State == "USA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_usa <- q2_trank[State == "USA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_usa <- q3_trank[State == "USA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_usa <- q4_trank[State == "USA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_usa <- q5_trank[State == "USA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_usa <- q6_trank[State == "USA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
qall_usa <- rbind(q1_usa, q2_usa, q3_usa, q4_usa, q5_usa, q6_usa,fill = TRUE)
```

```{r USA tables, message = FALSE}
options(tinytex.verbose = TRUE)

kable(usa_lst_DT,
      caption = "USA Latest Day")%>%
    kable_styling(font_size = 10, full_width = F)

kable(us_p_DT,
      caption = "USA Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```

## By Month

```{r US by month}
kable(usam_DT,
	caption = "USA by Month")%>%
	kable_styling(font_size = 10, full_width = F, fixed_thead = T)
```

### Charts by Day

```{r test chart, message = FALSE}

ggplot(us_by_day_DT[psxdate > "2020-02-25 16:00:00"], aes(x = psxdate, y = Tests)) + geom_line() + geom_smooth(se = FALSE) + theme_fivethirtyeight() + labs(title = "USA - Tests by day")
```

```{r chart cases, message = FALSE}
ggplot(us_by_day_DT[psxdate > "2020-02-25 16:00:00"], aes(x = psxdate, y = Cases)) + geom_line() + geom_smooth(se = FALSE) + theme_fivethirtyeight() + labs(title = "USA - Cases by day")
```

```{r chart deaths, message = FALSE}
ggplot(us_by_day_DT[psxdate > "2020-02-25 16:00:00"], aes(x = psxdate, y = Deaths)) + geom_line() + geom_smooth(se = FALSE) + theme_fivethirtyeight() + labs(title = "USA - Deaths by day")
```

## By Quarter

```{r usa table by quarter}

kable(usaq_DT,
	caption = "USA by Quarter")%>%
	kable_styling(font_size = 10, full_width = F, fixed_thead = T)

```

```{=latex}

\newpage

```

# State by State 

```{=latex}

\newpage
```

## Alabama

### Latest Day & Pandemic to Date

```{r AL qtr setup}

q1_AL <- q1_trank[State == "AL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_AL <- q2_trank[State == "AL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_AL <- q3_trank[State == "AL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_AL <- q4_trank[State == "AL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_AL <- q5_trank[State == "AL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_AL <- q6_trank[State == "AL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_AL <- rbind(q1_AL, q2_AL, q3_AL, q4_AL, q5_AL, q6_AL,  fill = TRUE)
qall_AL[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```

```{r AL tables}

kable(AL_Latest_Day_DT,
	caption = "AL Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(AL_p_DT,
      caption = "AL Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```

### By Month

```{r ALmth chart}
AL_c_DT <- ALmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
AL_c_DT[, `:=` (Month = anydate(Month_Ended))]
AL_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(AL_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "AL – Average Cases (per Day by Month)")

```
```{r Almth table} 
kable(ALmth_DT,
	caption = "AL by Month")%>%
	kable_styling(font_size = 10, full_width = F, fixed_thead = T)
```

```{r AL Avg Deaths to Cases, warning = FALSE}
AL_c_DT <- ALmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
AL_c_DT[, `:=` (Month = anydate(Month_Ended))]
AL_c_DT[, `:=` (Month_Ended = NULL)]
AL_lng_DT <- melt(AL_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(AL_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "AL – Average Deaths : Cases (per Day by Month)") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking 

```{r Alq tables}

ALq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(ALq_DT,
	caption = "AL by Quarter")%>%
	kable_styling(font_size = 10, full_width = F, fixed_thead = T)

kable(qall_AL,
	caption = "AL Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

```{=latex}

\newpage
```

## Alaska

### Latest Day & Pandemic to Date

```{r AK qtr setup}

q1_AK <- q1_trank[State == "AK", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_AK <- q2_trank[State == "AK", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_AK <- q3_trank[State == "AK", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_AK <- q4_trank[State == "AK", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_AK <- q5_trank[State == "AK", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_AK <- q6_trank[State == "AK", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_AK <- rbind(q1_AK, q2_AK, q3_AK, q4_AK, q5_AK, q6_AK, fill = TRUE)
qall_AK[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```

```{r AK tables}

kable(AK_Latest_Day_DT,
	caption = "AK Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(AK_p_DT,
      caption = "AK Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```

### By Month

```{r AK mth chart}
AK_c_DT <- AKmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
AK_c_DT[, `:=` (Month = anydate(Month_Ended))]
AK_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(AK_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "AK – Average Cases (per Day by Month)")
```
```{r AK mth table}
kable(AKmth_DT,
	caption = "AK by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r AK Avg Deaths to Cases, warning = FALSE}
AK_c_DT <- AKmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
AK_c_DT[, `:=` (Month = anydate(Month_Ended))]
AK_c_DT[, `:=` (Month_Ended = NULL)]
AK_lng_DT <- melt(AK_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(AK_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "AK – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking

```{r AKq tables }

AKq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(AKq_DT,
	caption = "AK by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_AK,
	caption = "AK Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

```{=latex}

\newpage

```

## American Samoa



```{r AS qtr setup}

q1_AS <- q1_trank[State == "AS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_AS <- q2_trank[State == "AS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_AS <- q3_trank[State == "AS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_AS <- q4_trank[State == "AS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_AS <- q5_trank[State == "AS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_AS <- q6_trank[State == "AS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_AS <- rbind(q1_AS, q2_AS, q3_AS, q4_AS, q5_AS, q6_AS, fill = TRUE)
qall_AS[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```

```{r AS tables}

kable(AS_Latest_Day_DT,
	caption = "AS Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(AS_p_DT,
      caption = "AS Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)


kable(ASmth_DT,
	caption = "AS by Month")%>%
	kable_styling(font_size = 10, full_width = F)

ASq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(ASq_DT,
	caption = "AS by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_AS,
	caption = "AS Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

```{=latex}

\newpage

```

## Arizona

### Latest Day & Pandemic to Date

```{r AZ qtr setup}

q1_AZ <- q1_trank[State == "AZ", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_AZ <- q2_trank[State == "AZ", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_AZ <- q3_trank[State == "AZ", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_AZ <- q4_trank[State == "AZ", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_AZ <- q5_trank[State == "AZ", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_AZ <- q6_trank[State == "AZ", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_AZ <- rbind(q1_AZ, q2_AZ, q3_AZ, q4_AZ, q5_AZ, q6_AZ, fill = TRUE)
qall_AZ[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```

```{r AZ tables}

kable(AZ_Latest_Day_DT,
	caption = "AZ Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(AZ_p_DT,
      caption = "AZ Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r AZ mth chart}

AZ_c_DT <- AZmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
AZ_c_DT[, `:=` (Month = anydate(Month_Ended))]
AZ_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(AZ_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "AZ – Average Cases (per Day by Month)")
```
```{r AZ mth table}

kable(AZmth_DT,
	caption = "AZ by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r AZ Avg Deaths to Cases, warning = FALSE}
AZ_c_DT <- AZmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
AZ_c_DT[, `:=` (Month = anydate(Month_Ended))]
AZ_c_DT[, `:=` (Month_Ended = NULL)]
AZ_lng_DT <- melt(AZ_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(AZ_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "AZ – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r AZq tables }

AZq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(AZq_DT,
	caption = "AZ by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_AZ,
	caption = "AZ Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Arkansas

```{r AR qtr setup}

q1_AR <- q1_trank[State == "AR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_AR <- q2_trank[State == "AR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_AR <- q3_trank[State == "AR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_AR <- q4_trank[State == "AR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_AR <- q5_trank[State == "AR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_AR <- q6_trank[State == "AR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_AR <- rbind(q1_AR, q2_AR, q3_AR, q4_AR, q5_AR, q6_AR, fill = TRUE)
qall_AR[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r AR tables}

kable(AR_Latest_Day_DT,
	caption = "AR Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(AR_p_DT,
      caption = "AR Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month

```{r AR mth chart}

AR_c_DT <- ARmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
AR_c_DT[, `:=` (Month = anydate(Month_Ended))]
AR_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(AR_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "AR – Average Cases (per Day by Month)")
```
```{r AR mth table}

kable(ARmth_DT,
	caption = "AR by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r AR Avg Deaths to Cases, warning = FALSE}
AR_c_DT <- ARmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
AR_c_DT[, `:=` (Month = anydate(Month_Ended))]
AR_c_DT[, `:=` (Month_Ended = NULL)]
AR_lng_DT <- melt(AR_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(AR_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "AR – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r ARq tables }

ARq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(ARq_DT,
	caption = "AR by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_AR,
	caption = "AR Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## California

```{r CA qtr setup}

q1_CA <- q1_trank[State == "CA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_CA <- q2_trank[State == "CA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_CA <- q3_trank[State == "CA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_CA <- q4_trank[State == "CA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_CA <- q5_trank[State == "CA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_CA <- q6_trank[State == "CA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_CA <- rbind(q1_CA, q2_CA, q3_CA, q4_CA, q5_CA, q6_CA, fill = TRUE)
qall_CA[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r CA tables}

kable(CA_Latest_Day_DT,
	caption = "CA Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(CA_p_DT,
      caption = "CA Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r CA mth chart}

CA_c_DT <- CAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
CA_c_DT[, `:=` (Month = anydate(Month_Ended))]
CA_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(CA_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "CA – Average Cases (per Day by Month)")
```
```{r CA mth table}
kable(CAmth_DT,
	caption = "CA by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r CA Avg Deaths to Cases, warning = FALSE}
CA_c_DT <- CAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
CA_c_DT[, `:=` (Month = anydate(Month_Ended))]
CA_c_DT[, `:=` (Month_Ended = NULL)]
CA_lng_DT <- melt(CA_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(CA_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "CA – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking

```{r CAq tables }

CAq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(CAq_DT,
	caption = "CA by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_CA,
	caption = "CA Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

## Colorado

```{r CO qtr setup}

q1_CO <- q1_trank[State == "CO", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_CO <- q2_trank[State == "CO", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_CO <- q3_trank[State == "CO", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_CO <- q4_trank[State == "CO", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_CO <- q5_trank[State == "CO", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_CO <- q6_trank[State == "CO", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_CO <- rbind(q1_CO, q2_CO, q3_CO, q4_CO, q5_CO, q6_CO, fill = TRUE)
qall_CO[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r CO tables}

kable(CO_Latest_Day_DT,
	caption = "CO Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(CO_p_DT,
      caption = "CO Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r CO mth chart}

CO_c_DT <- COmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
CO_c_DT[, `:=` (Month = anydate(Month_Ended))]
CO_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(CO_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "CO – Average Cases (per Day by Month)")
```
```{r CO mth table}
kable(COmth_DT,
	caption = "CO by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r CO Avg Deaths to Cases, warning = FALSE}
CO_c_DT <- COmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
CO_c_DT[, `:=` (Month = anydate(Month_Ended))]
CO_c_DT[, `:=` (Month_Ended = NULL)]
CO_lng_DT <- melt(CO_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(CO_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "CO – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r COq tables }

COq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(COq_DT,
	caption = "CO by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_CO,
	caption = "CO Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Connecticut

```{r CT qtr setup}

q1_CT <- q1_trank[State == "CT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_CT <- q2_trank[State == "CT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_CT <- q3_trank[State == "CT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_CT <- q4_trank[State == "CT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_CT <- q5_trank[State == "CT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_CT <- q6_trank[State == "CT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_CT <- rbind(q1_CT, q2_CT, q3_CT, q4_CT, q5_CT, q6_CT, fill = TRUE)
qall_CT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r CT tables}

kable(CT_Latest_Day_DT,
	caption = "CT Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(CT_p_DT,
      caption = "CT Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r CT mth chart}

CT_c_DT <- CTmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
CT_c_DT[, `:=` (Month = anydate(Month_Ended))]
CT_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(CT_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "CT – Average Cases (per Day by Month)")
```
```{r CT mth table}
kable(CTmth_DT,
	caption = "CT by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r CT Avg Deaths to Cases, warning = FALSE}
CT_c_DT <- CTmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
CT_c_DT[, `:=` (Month = anydate(Month_Ended))]
CT_c_DT[, `:=` (Month_Ended = NULL)]
CT_lng_DT <- melt(CT_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(CT_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "CT – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r CTq tables }

CTq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(CTq_DT,
	caption = "CT by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_CT,
	caption = "CT Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Washington DC

```{r DC qtr setup}

q1_DC <- q1_trank[State == "DC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_DC <- q2_trank[State == "DC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_DC <- q3_trank[State == "DC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_DC <- q4_trank[State == "DC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_DC <- q5_trank[State == "DC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_DC <- q6_trank[State == "DC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_DC <- rbind(q1_DC, q2_DC, q3_DC, q4_DC, q5_DC, q6_DC, fill = TRUE)
qall_DC[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r DC tables}

kable(DC_Latest_Day_DT,
	caption = "DC Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(DC_p_DT,
      caption = "DC Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r DC mth chart}

DC_c_DT <- DCmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
DC_c_DT[, `:=` (Month = anydate(Month_Ended))]
DC_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(DC_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "DC – Average Cases (per Day per Month)")
```
```{r DC mth table}
kable(DCmth_DT,
	caption = "DC by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r DC Avg Deaths to Cases, warning = FALSE}
DC_c_DT <- DCmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
DC_c_DT[, `:=` (Month = anydate(Month_Ended))]
DC_c_DT[, `:=` (Month_Ended = NULL)]
DC_lng_DT <- melt(DC_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(DC_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "DC – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```
### By Quarter & Quarterly Ranking
```{r DCq tables }

DCq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(DCq_DT,
	caption = "DC by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_DC,
	caption = "DC Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Delaware

```{r DE qtr setup}

q1_DE <- q1_trank[State == "DE", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_DE <- q2_trank[State == "DE", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_DE <- q3_trank[State == "DE", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_DE <- q4_trank[State == "DE", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_DE <- q5_trank[State == "DE", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_DE <- q6_trank[State == "DE", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_DE <- rbind(q1_DE, q2_DE, q3_DE, q4_DE, q5_DE, q6_DE, fill = TRUE)
qall_DE[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r DE tables}

kable(DE_Latest_Day_DT,
	caption = "DE Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(DE_p_DT,
      caption = "DE Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
```{r DE mth chart}

DE_c_DT <- DEmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
DE_c_DT[, `:=` (Month = anydate(Month_Ended))]
DE_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(DE_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "DE – Average Cases (per Day by Month)")
```
```{r DE mth table}
kable(DEmth_DT,
	caption = "DE by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r DE Avg Deaths to Cases, warning = FALSE}
DE_c_DT <- DEmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
DE_c_DT[, `:=` (Month = anydate(Month_Ended))]
DE_c_DT[, `:=` (Month_Ended = NULL)]
DE_lng_DT <- melt(DE_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(DE_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "DE – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r DEq tables }


DEq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
kable(DEq_DT,
	caption = "DE by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_DE,
	caption = "DE Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

## Florida

```{r FL qtr setup}

q1_FL <- q1_trank[State == "FL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_FL <- q2_trank[State == "FL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_FL <- q3_trank[State == "FL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_FL <- q4_trank[State == "FL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_FL <- q5_trank[State == "FL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_FL <- q6_trank[State == "FL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_FL <- rbind(q1_FL, q2_FL, q3_FL, q4_FL, q5_FL, q6_FL, fill = TRUE )
qall_FL[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r FL tables}

kable(FL_Latest_Day_DT,
	caption = "FL Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(FL_p_DT,
      caption = "FL Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r FL mth chart}

FL_c_DT <- FLmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
FL_c_DT[, `:=` (Month = anydate(Month_Ended))]
FL_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(FL_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "FL – Average Cases (per Day by Month)")
```
```{r FL mth table}
kable(FLmth_DT,
	caption = "FL by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r FL Avg Deaths to Cases, warning = FALSE}
FL_c_DT <- FLmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
FL_c_DT[, `:=` (Month = anydate(Month_Ended))]
FL_c_DT[, `:=` (Month_Ended = NULL)]
FL_lng_DT <- melt(FL_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(FL_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "FL – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking

```{r FLq tables }

FLq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(FLq_DT,
	caption = "FL by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_FL,
	caption = "FL Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Georgia

```{r GA qtr setup}

q1_GA <- q1_trank[State == "GA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_GA <- q2_trank[State == "GA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_GA <- q3_trank[State == "GA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_GA <- q4_trank[State == "GA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_GA <- q5_trank[State == "GA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_GA <- q6_trank[State == "GA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_GA <- rbind(q1_GA, q2_GA, q3_GA, q4_GA, q5_GA, q6_GA, fill = TRUE)
qall_GA[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r GA tables}

kable(GA_Latest_Day_DT,
	caption = "GA Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(GA_p_DT,
      caption = "GA Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r GA mth chart}

GA_c_DT <- GAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
GA_c_DT[, `:=` (Month = anydate(Month_Ended))]
GA_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(GA_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "GA – Average Cases (per Day by Month)")
```
```{r GA mth table}
kable(GAmth_DT,
	caption = "GA by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r GA Avg Deaths to Cases, warning = FALSE}
GA_c_DT <- GAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
GA_c_DT[, `:=` (Month = anydate(Month_Ended))]
GA_c_DT[, `:=` (Month_Ended = NULL)]
GA_lng_DT <- melt(GA_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(GA_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "GA – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r GAq tables }

GAq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(GAq_DT,
	caption = "GA by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_GA,
	caption = "GA Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Guam

```{r GU qtr setup}

q1_GU <- q1_trank[State == "GU", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_GU <- q2_trank[State == "GU", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_GU <- q3_trank[State == "GU", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_GU <- q4_trank[State == "GU", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_GU <- q5_trank[State == "GU", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_GU <- q6_trank[State == "GU", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_GU <- rbind(q1_GU, q2_GU, q3_GU, q4_GU, q5_GU, q6_GU, fill = TRUE)
qall_GU[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r GU tables}

kable(GU_Latest_Day_DT,
	caption = "GU Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(GU_p_DT,
      caption = "GU Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```

### By Month
```{r GU mth chart}

GU_c_DT <- GUmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
GU_c_DT[, `:=` (Month = anydate(Month_Ended))]
GU_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(GU_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "GU – Average Cases (per Day by Month)")
```
```{r GU mth table}
kable(GUmth_DT,
	caption = "GU by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r GU Avg Deaths to Cases, warning = FALSE}
GU_c_DT <- GUmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
GU_c_DT[, `:=` (Month = anydate(Month_Ended))]
GU_c_DT[, `:=` (Month_Ended = NULL)]
GU_lng_DT <- melt(GU_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(GU_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "GU – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r GUq tables }

GUq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(GUq_DT,
	caption = "GU by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_GU,
	caption = "GU Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Hawaii

```{r HI qtr setup}

q1_HI <- q1_trank[State == "HI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_HI <- q2_trank[State == "HI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_HI <- q3_trank[State == "HI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_HI <- q4_trank[State == "HI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_HI <- q5_trank[State == "HI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_HI <- q6_trank[State == "HI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_HI <- rbind(q1_HI, q2_HI, q3_HI, q4_HI, q5_HI, q6_HI, fill = TRUE)
qall_HI[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r HI tables}

kable(HI_Latest_Day_DT,
	caption = "HI Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(HI_p_DT,
      caption = "HI Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month

```{r HI mth chart}

HI_c_DT <- HImth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
HI_c_DT[, `:=` (Month = anydate(Month_Ended))]
HI_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(HI_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "HI – Average Cases (per Day by Month)")
```
```{r HI mth table}
kable(HImth_DT,
	caption = "HI by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r HI Avg Deaths to Cases, warning = FALSE}
HI_c_DT <- HImth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
HI_c_DT[, `:=` (Month = anydate(Month_Ended))]
HI_c_DT[, `:=` (Month_Ended = NULL)]
HI_lng_DT <- melt(HI_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(HI_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "HI – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r HIq tables }

HIq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(HIq_DT,
	caption = "HI by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_HI,
	caption = "HI Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Idaho

```{r ID qtr setup}

q1_ID <- q1_trank[State == "ID", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_ID <- q2_trank[State == "ID", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_ID <- q3_trank[State == "ID", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_ID <- q4_trank[State == "ID", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_ID <- q5_trank[State == "ID", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_ID <- q6_trank[State == "ID", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_ID <- rbind(q1_ID, q2_ID, q3_ID, q4_ID, q5_ID, q6_ID, fill = TRUE)
qall_ID[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r ID tables}

kable(ID_Latest_Day_DT,
	caption = "ID Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(ID_p_DT,
      caption = "ID Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r ID mth chart}

ID_c_DT <- IDmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
ID_c_DT[, `:=` (Month = anydate(Month_Ended))]
ID_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(ID_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "ID – Average Cases (per Day by Month)")
```
```{r ID mth table}
kable(IDmth_DT,
	caption = "ID by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r ID Avg Deaths to Cases, warning = FALSE}
ID_c_DT <- IDmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
ID_c_DT[, `:=` (Month = anydate(Month_Ended))]
ID_c_DT[, `:=` (Month_Ended = NULL)]
ID_lng_DT <- melt(ID_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(ID_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "ID – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r IDq tables }

IDq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(IDq_DT,
	caption = "ID by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_ID,
	caption = "ID Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Illinois

```{r IL qtr setup}

q1_IL <- q1_trank[State == "IL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_IL <- q2_trank[State == "IL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_IL <- q3_trank[State == "IL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_IL <- q4_trank[State == "IL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_IL <- q5_trank[State == "IL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_IL <- q6_trank[State == "IL", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_IL <- rbind(q1_IL, q2_IL, q3_IL, q4_IL, q5_IL, q6_IL, fill = TRUE)
qall_IL[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r IL tables}

kable(IL_Latest_Day_DT,
	caption = "IL Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(IL_p_DT,
      caption = "IL Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r IL mth chart}

IL_c_DT <- ILmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
IL_c_DT[, `:=` (Month = anydate(Month_Ended))]
IL_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(IL_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "IL – Average Cases (per Day by Month)")
```
```{r IL mth table}
kable(ILmth_DT,
	caption = "IL by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r IL Avg Deaths to Cases, warning = FALSE}
IL_c_DT <- ILmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
IL_c_DT[, `:=` (Month = anydate(Month_Ended))]
IL_c_DT[, `:=` (Month_Ended = NULL)]
IL_lng_DT <- melt(IL_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(IL_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "IL – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r ILq tables }

ILq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(ILq_DT,
	caption = "IL by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_IL,
	caption = "IL Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Indiana

```{r IN qtr setup}

q1_IN <- q1_trank[State == "IN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_IN <- q2_trank[State == "IN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_IN <- q3_trank[State == "IN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_IN <- q4_trank[State == "IN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_IN <- q5_trank[State == "IN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_IN <- q6_trank[State == "IN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_IN <- rbind(q1_IN, q2_IN, q3_IN, q4_IN, q5_IN, q6_IN, fill = TRUE)
qall_IN[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r IN tables}

kable(IN_Latest_Day_DT,
	caption = "IN Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(IN_p_DT,
      caption = "IN Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r IN mth chart}

IN_c_DT <- INmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
IN_c_DT[, `:=` (Month = anydate(Month_Ended))]
IN_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(IN_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "IN – Average Cases (per Day by Month)")
```
```{r IN mth table}
kable(INmth_DT,
	caption = "IN by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r IN Avg Deaths to Cases, warning = FALSE}
IN_c_DT <- INmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
IN_c_DT[, `:=` (Month = anydate(Month_Ended))]
IN_c_DT[, `:=` (Month_Ended = NULL)]
IN_lng_DT <- melt(IN_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(IN_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "IN – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r INq tables }

INq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(INq_DT,
	caption = "IN by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_IN,
	caption = "IN Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Iowa

```{r IA qtr setup}

q1_IA <- q1_trank[State == "IA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_IA <- q2_trank[State == "IA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_IA <- q3_trank[State == "IA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_IA <- q4_trank[State == "IA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_IA <- q5_trank[State == "IA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_IA <- q6_trank[State == "IA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_IA <- rbind(q1_IA, q2_IA, q3_IA, q4_IA, q5_IA, q6_IA, fill = TRUE)
qall_IA[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r IA tables}

kable(IA_Latest_Day_DT,
	caption = "IA Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(IA_p_DT,
      caption = "IA Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r IA mth chart}

IA_c_DT <- IAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
IA_c_DT[, `:=` (Month = anydate(Month_Ended))]
IA_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(IA_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "IA – Average Cases (per Day by Month")
```
```{r IA mth table}
kable(IAmth_DT,
	caption = "IA by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r IA Avg Deaths to Cases, warning = FALSE}
IA_c_DT <- IAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
IA_c_DT[, `:=` (Month = anydate(Month_Ended))]
IA_c_DT[, `:=` (Month_Ended = NULL)]
IA_lng_DT <- melt(IA_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(IA_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "IA – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r IAq tables }

IAq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(IAq_DT,
	caption = "IA by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_IA,
	caption = "IA Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Kansas

```{r KS qtr setup}

q1_KS <- q1_trank[State == "KS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_KS <- q2_trank[State == "KS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_KS <- q3_trank[State == "KS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_KS <- q4_trank[State == "KS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_KS <- q5_trank[State == "KS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_KS <- q6_trank[State == "KS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_KS <- rbind(q1_KS, q2_KS, q3_KS, q4_KS, q5_KS, q6_KS, fill = TRUE)
qall_KS[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```

### Latest Day & Pandemic to Date
```{r KS tables}

kable(KS_Latest_Day_DT,
	caption = "KS Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(KS_p_DT,
      caption = "KS Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r KS mth chart}

KS_c_DT <- KSmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
KS_c_DT[, `:=` (Month = anydate(Month_Ended))]
KS_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(KS_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "KS – Average Cases (per Day by Month)")
```
```{r KS mth table}
kable(KSmth_DT,
	caption = "KS by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r KS Avg Deaths to Cases, warning = FALSE}
KS_c_DT <- KSmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
KS_c_DT[, `:=` (Month = anydate(Month_Ended))]
KS_c_DT[, `:=` (Month_Ended = NULL)]
KS_lng_DT <- melt(KS_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(KS_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "KS – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking

```{r KSq tables}

KSq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(KSq_DT,
	caption = "KS by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_KS,
	caption = "KS Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

```


## Kentucky

```{r KY qtr setup}

q1_KY <- q1_trank[State == "KY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_KY <- q2_trank[State == "KY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_KY <- q3_trank[State == "KY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_KY <- q4_trank[State == "KY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_KY <- q5_trank[State == "KY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_KY <- q6_trank[State == "KY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_KY <- rbind(q1_KY, q2_KY, q3_KY, q4_KY, q5_KY, q6_KY, fill = TRUE)
qall_KY[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r KY tables}

kable(KY_Latest_Day_DT,
  caption = "KY Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(KY_p_DT,
      caption = "KY Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month

```{r KY mth chart}

KY_c_DT <- KYmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
KY_c_DT[, `:=` (Month = anydate(Month_Ended))]
KY_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(KY_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "KY – Average Cases (per Day by Month)")
```
```{r KY mth table}
kable(KYmth_DT,
	caption = "KY by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r KY Avg Deaths to Cases, warning = FALSE}
KY_c_DT <- KYmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
KY_c_DT[, `:=` (Month = anydate(Month_Ended))]
KY_c_DT[, `:=` (Month_Ended = NULL)]
KY_lng_DT <- melt(KY_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(KY_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "KY – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```


### By Quarter & Quarterly Ranking
```{r KYq tables }

KYq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(KYq_DT,
	caption = "KY by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_KY,
	caption = "KY Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Louisiana

```{r LA qtr setup}

q1_LA <- q1_trank[State == "LA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_LA <- q2_trank[State == "LA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_LA <- q3_trank[State == "LA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_LA <- q4_trank[State == "LA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_LA <- q5_trank[State == "LA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_LA <- q6_trank[State == "LA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_LA <- rbind(q1_LA, q2_LA, q3_LA, q4_LA, q5_LA, q6_LA, fill = TRUE)
qall_LA[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r LA tables}

kable(LA_Latest_Day_DT,
	caption = "LA Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(LA_p_DT,
      caption = "LA Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r LAmth chart}

LA_c_DT <- LAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
LA_c_DT[, `:=` (Month = anydate(Month_Ended))]
LA_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(LA_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "LA – Average Cases (per Day by Month)")
```
```{r LA mth table}
kable(LAmth_DT,
	caption = "LA by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r LA Avg Deaths to Cases, warning = FALSE}
LA_c_DT <- LAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
LA_c_DT[, `:=` (Month = anydate(Month_Ended))]
LA_c_DT[, `:=` (Month_Ended = NULL)]
LA_lng_DT <- melt(LA_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(LA_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "LA – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r LAq tables }

LAq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(LAq_DT,
	caption = "LA by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_LA,
	caption = "LA Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Maine

```{r ME qtr setup}

q1_ME <- q1_trank[State == "ME", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_ME <- q2_trank[State == "ME", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_ME <- q3_trank[State == "ME", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_ME <- q4_trank[State == "ME", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_ME <- q5_trank[State == "ME", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_ME <- q6_trank[State == "ME", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_ME <- rbind(q1_ME, q2_ME, q3_ME, q4_ME, q5_ME, q6_ME, fill = TRUE)
qall_ME[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Month & Pandemic to Date
```{r ME tables}

kable(ME_Latest_Day_DT,
	caption = "ME Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(ME_p_DT,
      caption = "ME Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r MEmth chart}

ME_c_DT <- MEmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
ME_c_DT[, `:=` (Month = anydate(Month_Ended))]
ME_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(ME_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "ME – Average Cases (per Day by Month)")
```
```{r ME mth table}
kable(MEmth_DT,
	caption = "ME by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r ME Avg Deaths to Cases, warning = FALSE}
ME_c_DT <- MEmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
ME_c_DT[, `:=` (Month = anydate(Month_Ended))]
ME_c_DT[, `:=` (Month_Ended = NULL)]
ME_lng_DT <- melt(ME_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(ME_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "ME – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r MEq tables }

MEq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(MEq_DT,
	caption = "ME by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_ME,
	caption = "ME Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Maryland

```{r MD qtr setup}

q1_MD <- q1_trank[State == "MD", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_MD <- q2_trank[State == "MD", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_MD <- q3_trank[State == "MD", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_MD <- q4_trank[State == "MD", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_MD <- q5_trank[State == "MD", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_MD <- q6_trank[State == "MD", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_MD <- rbind(q1_MD, q2_MD, q3_MD, q4_MD, q5_MD, q6_MD, fill = TRUE)
qall_MD[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r MD tables}

kable(MD_Latest_Day_DT,
	caption = "MD Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(MD_p_DT,
      caption = "MD Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r MDmth chart}

MD_c_DT <- MDmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
MD_c_DT[, `:=` (Month = anydate(Month_Ended))]
MD_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(MD_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "MD – Average Cases (per Day by Month)")
```
```{r MD mth table}
kable(MDmth_DT,
	caption = "MD by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r MD Avg Deaths to Cases, warning = FALSE}
MD_c_DT <- MDmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
MD_c_DT[, `:=` (Month = anydate(Month_Ended))]
MD_c_DT[, `:=` (Month_Ended = NULL)]
MD_lng_DT <- melt(MD_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(MD_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "MD – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking

```{r MDq tables }

MDq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(MDq_DT,
	caption = "MD by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_MD,
	caption = "MD Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

## North Mariana Islands

```{r MP qtr setup}

q1_MP <- q1_trank[State == "MP", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_MP <- q2_trank[State == "MP", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_MP <- q3_trank[State == "MP", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_MP <- q4_trank[State == "MP", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_MP <- q5_trank[State == "MP", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_MP <- q6_trank[State == "MP", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_MP <- rbind(q1_MP, q2_MP, q3_MP, q4_MP, q5_MP, q6_MP, fill = TRUE)
qall_MP[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r MP tables}

kable(MP_Latest_Day_DT,
	caption = "MP Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(MP_p_DT,
      caption = "MP Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month

```{r MP mth table}
kable(MPmth_DT,
	caption = "MP by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```

### By Quarter & Quarterly Ranking

```{r MP by qtr}

MPq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(MPq_DT,
	caption = "MP by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_MP,
	caption = "MP Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
	
```

## Massachussetts

```{r MA qtr setup}

q1_MA <- q1_trank[State == "MA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_MA <- q2_trank[State == "MA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_MA <- q3_trank[State == "MA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_MA <- q4_trank[State == "MA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_MA <- q5_trank[State == "MA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_MA <- q6_trank[State == "MA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_MA <- rbind(q1_MA, q2_MA, q3_MA, q4_MA, q5_MA, q6_MA, fill = TRUE)
qall_MA[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r MA tables}

kable(MA_Latest_Day_DT,
	caption = "MA Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(MA_p_DT,
      caption = "MA Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r MAmth chart}

MA_c_DT <- MAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
MA_c_DT[, `:=` (Month = anydate(Month_Ended))]
MA_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(MA_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "MA – Average Cases (per Day by Month)")
```
```{r MA mth table}
kable(MAmth_DT,
	caption = "MA by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r MA Avg Deaths to Cases, warning = FALSE}
MA_c_DT <- MAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
MA_c_DT[, `:=` (Month = anydate(Month_Ended))]
MA_c_DT[, `:=` (Month_Ended = NULL)]
MA_lng_DT <- melt(MA_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(MA_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "MA – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r MAq tables }

MAq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(MAq_DT,
	caption = "MA by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_MA,
	caption = "MA Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Michigan

```{r MI qtr setup}

q1_MI <- q1_trank[State == "MI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_MI <- q2_trank[State == "MI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_MI <- q3_trank[State == "MI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_MI <- q4_trank[State == "MI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_MI <- q5_trank[State == "MI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_MI <- q6_trank[State == "MI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_MI <- rbind(q1_MI, q2_MI, q3_MI, q4_MI, q5_MI, q6_MI, fill = TRUE)
qall_MI[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r MI tables}

kable(MI_Latest_Day_DT,
	caption = "MI Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(MI_p_DT,
      caption = "MI Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r MImth chart}

MI_c_DT <- MImth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
MI_c_DT[, `:=` (Month = anydate(Month_Ended))]
MI_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(MI_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "MI – Average Cases (per Day by Month)")
```
```{r MI mth table}
kable(MImth_DT,
	caption = "MI by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r MI Avg Deaths to Cases, warning = FALSE}
MI_c_DT <- MImth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
MI_c_DT[, `:=` (Month = anydate(Month_Ended))]
MI_c_DT[, `:=` (Month_Ended = NULL)]
MI_lng_DT <- melt(MI_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(MI_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "MI – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r MIq tables }

MIq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(MIq_DT,
	caption = "MI by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_MI,
	caption = "MI Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Minnesota

```{r MN qtr setup}

q1_MN <- q1_trank[State == "MN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_MN <- q2_trank[State == "MN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_MN <- q3_trank[State == "MN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_MN <- q4_trank[State == "MN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_MN <- q5_trank[State == "MN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_MN <- q6_trank[State == "MN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_MN <- rbind(q1_MN, q2_MN, q3_MN, q4_MN, q5_MN, q6_MN, fill = TRUE)
qall_MN[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r MN tables}

kable(MN_Latest_Day_DT,
	caption = "MN Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(MN_p_DT,
      caption = "MN Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r MN mth chart}

MN_c_DT <- MNmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
MN_c_DT[, `:=` (Month = anydate(Month_Ended))]
MN_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(MN_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "MN – Average Cases (per Day by Month)")
```
```{r MN mth table}
kable(MNmth_DT,
	caption = "MN by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r MN Avg Deaths to Cases, warning = FALSE}
MN_c_DT <- MNmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
MN_c_DT[, `:=` (Month = anydate(Month_Ended))]
MN_c_DT[, `:=` (Month_Ended = NULL)]
MN_lng_DT <- melt(MN_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(MN_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "MN – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking

```{r MNq tables }

MNq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(MNq_DT,
	caption = "MN by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_MN,
	caption = "MN Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Mississippi

```{r MS qtr setup}

q1_MS <- q1_trank[State == "MS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_MS <- q2_trank[State == "MS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_MS <- q3_trank[State == "MS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_MS <- q4_trank[State == "MS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_MS <- q5_trank[State == "MS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_MS <- q6_trank[State == "MS", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_MS <- rbind(q1_MS, q2_MS, q3_MS, q4_MS, q5_MS, q6_MS, fill = TRUE)
qall_MS[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r MS tables}

kable(MS_Latest_Day_DT,
	caption = "MS Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(MS_p_DT,
      caption = "MS Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month

```{r MSmth chart}

MS_c_DT <- MSmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
MS_c_DT[, `:=` (Month = anydate(Month_Ended))]
MS_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(MS_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "MS – Average Cases (per Day by Month)")
```
```{r MS mth table}
kable(MSmth_DT,
	caption = "MS by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r MS Avg Deaths to Cases, warning = FALSE}
MS_c_DT <- MSmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
MS_c_DT[, `:=` (Month = anydate(Month_Ended))]
MS_c_DT[, `:=` (Month_Ended = NULL)]
MS_lng_DT <- melt(MS_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(MS_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "MS – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking 

```{r MSq tables }

MSq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(MSq_DT,
	caption = "MS by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_MS,
	caption = "MS Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Missouri

```{r MO qtr setup}

q1_MO <- q1_trank[State == "MO", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_MO <- q2_trank[State == "MO", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_MO <- q3_trank[State == "MO", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_MO <- q4_trank[State == "MO", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_MO <- q5_trank[State == "MO", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_MO <- q6_trank[State == "MO", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_MO <- rbind(q1_MO, q2_MO, q3_MO, q4_MO, q5_MO, q6_MO, fill = TRUE)
qall_MO[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r MO tables}

kable(MO_Latest_Day_DT,
	caption = "MO Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(MO_p_DT,
      caption = "MO Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r MO mth chart}

MO_c_DT <- MOmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
MO_c_DT[, `:=` (Month = anydate(Month_Ended))]
MO_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(MO_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "MO – Average Cases (per Day by Month)")
```
```{r MO mth table}
kable(MOmth_DT,
	caption = "MO by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r MO Avg Deaths to Cases, warning = FALSE}
MO_c_DT <- MOmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
MO_c_DT[, `:=` (Month = anydate(Month_Ended))]
MO_c_DT[, `:=` (Month_Ended = NULL)]
MO_lng_DT <- melt(MO_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(MO_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "MO – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r MOq tables }

MOq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(MOq_DT,
	caption = "MO by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_MO,
	caption = "MO Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Montana

```{r MT qtr setup}

q1_MT <- q1_trank[State == "MT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_MT <- q2_trank[State == "MT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_MT <- q3_trank[State == "MT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_MT <- q4_trank[State == "MT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_MT <- q5_trank[State == "MT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_MT <- q6_trank[State == "MT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_MT <- rbind(q1_MT, q2_MT, q3_MT, q4_MT, q5_MT, q6_MT, fill = TRUE)
qall_MT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r MT tables}

kable(MT_Latest_Day_DT,
	caption = "MT Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(MT_p_DT,
      caption = "MT Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r MTmth chart}

MT_c_DT <- MTmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
MT_c_DT[, `:=` (Month = anydate(Month_Ended))]
MT_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(MT_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "MT – Average Cases (per Day by Month)")
```
```{r MT mth table}
kable(MTmth_DT,
	caption = "MT by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r MT Avg Deaths to Cases, warning = FALSE}
MT_c_DT <- MTmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
MT_c_DT[, `:=` (Month = anydate(Month_Ended))]
MT_c_DT[, `:=` (Month_Ended = NULL)]
MT_lng_DT <- melt(MT_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(MT_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "MT – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking

```{r MTq tables }

MTq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(MTq_DT,
	caption = "MT by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_MT,
	caption = "MT Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Nebraska

```{r NE qtr setup}

q1_NE <- q1_trank[State == "NE", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_NE <- q2_trank[State == "NE", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_NE <- q3_trank[State == "NE", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_NE <- q4_trank[State == "NE", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_NE <- q5_trank[State == "NE", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_NE <- q6_trank[State == "NE", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_NE <- rbind(q1_NE, q2_NE, q3_NE, q4_NE, q5_NE, q6_NE, fill = TRUE)
qall_NE[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```

### Latest Day & Pandemic to Date
```{r NE tables}

kable(NE_Latest_Day_DT,
	caption = "NE Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(NE_p_DT,
      caption = "NE Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```

### By Month
```{r NEmth chart}

NE_c_DT <- NEmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
NE_c_DT[, `:=` (Month = anydate(Month_Ended))]
NE_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(NE_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "NE – Average Cases (per Day by Month)")
```
```{r NE mth table}
kable(NEmth_DT,
	caption = "NE by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r NE Avg Deaths to Cases, warning = FALSE}
NE_c_DT <- NEmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
NE_c_DT[, `:=` (Month = anydate(Month_Ended))]
NE_c_DT[, `:=` (Month_Ended = NULL)]
NE_lng_DT <- melt(NE_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(NE_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "NE – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking

```{r NEq tables }

NEq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(NEq_DT,
	caption = "NE by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_NE,
	caption = "NE Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Nevada

```{r NV qtr setup}

q1_NV <- q1_trank[State == "NV", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_NV <- q2_trank[State == "NV", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_NV <- q3_trank[State == "NV", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_NV <- q4_trank[State == "NV", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_NV <- q5_trank[State == "NV", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_NV <- q6_trank[State == "NV", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_NV <- rbind(q1_NV, q2_NV, q3_NV, q4_NV, q5_NV, q6_NV, fill = TRUE)
qall_NV[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date

```{r NV tables}

kable(NV_Latest_Day_DT,
	caption = "NV Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(NV_p_DT,
      caption = "NV Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month

```{r NVmth chart}

NV_c_DT <- NVmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
NV_c_DT[, `:=` (Month = anydate(Month_Ended))]
NV_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(NV_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "NV – Average Cases (per Day by Month)")
```
```{r NV mth table}
kable(NVmth_DT,
	caption = "NV by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r NV Avg Deaths to Cases, warning = FALSE}
NV_c_DT <- NVmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
NV_c_DT[, `:=` (Month = anydate(Month_Ended))]
NV_c_DT[, `:=` (Month_Ended = NULL)]
NV_lng_DT <- melt(NV_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(NV_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "NV – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking

```{r NVq tables }

NVq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(NVq_DT,
	caption = "NV by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_NV,
	caption = "NV Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## New Hampshire

```{r NH qtr setup}

q1_NH <- q1_trank[State == "NH", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_NH <- q2_trank[State == "NH", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_NH <- q3_trank[State == "NH", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_NH <- q4_trank[State == "NH", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_NH <- q5_trank[State == "NH", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_NH <- q6_trank[State == "NH", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_NH <- rbind(q1_NH, q2_NH, q3_NH, q4_NH, q5_NH, q6_NH, fill = TRUE)
qall_NH[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date

```{r NH tables}

kable(NH_Latest_Day_DT,
	caption = "NH Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(NH_p_DT,
      caption = "NH Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r NHmth chart}

NH_c_DT <- NHmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
NH_c_DT[, `:=` (Month = anydate(Month_Ended))]
NH_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(NH_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "NH – Average Cases (per Day by Month")
```
```{r NH mth table}

kable(NHmth_DT,
	caption = "NH by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r NH Avg Deaths to Cases, warning = FALSE}
NH_c_DT <- NHmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
NH_c_DT[, `:=` (Month = anydate(Month_Ended))]
NH_c_DT[, `:=` (Month_Ended = NULL)]
NH_lng_DT <- melt(NH_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(NH_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "NH – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking

```{r NHq tables }

NHq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(NHq_DT,
	caption = "NH by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_NH,
	caption = "NH Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## New Jersey

```{r NJ qtr setup}

q1_NJ <- q1_trank[State == "NJ", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_NJ <- q2_trank[State == "NJ", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_NJ <- q3_trank[State == "NJ", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_NJ <- q4_trank[State == "NJ", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_NJ <- q5_trank[State == "NJ", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_NJ <- q6_trank[State == "NJ", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_NJ <- rbind(q1_NJ, q2_NJ, q3_NJ, q4_NJ, q5_NJ, q6_NJ, fill = TRUE)
qall_NJ[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date

```{r NJ tables}

kable(NJ_Latest_Day_DT,
	caption = "NJ Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(NJ_p_DT,
      caption = "NJ Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r NJmth chart}

NJ_c_DT <- NJmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
NJ_c_DT[, `:=` (Month = anydate(Month_Ended))]
NJ_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(NJ_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "NJ – Average Cases (per Day by Month)")
```
```{r NJ mth table}
kable(NJmth_DT,
	caption = "NJ by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r NJ Avg Deaths to Cases, warning = FALSE}
NJ_c_DT <- NJmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
NJ_c_DT[, `:=` (Month = anydate(Month_Ended))]
NJ_c_DT[, `:=` (Month_Ended = NULL)]
NJ_lng_DT <- melt(NJ_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(NJ_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "NJ – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking

```{r NJq tables }

NJq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]


kable(NJq_DT,
	caption = "NJ by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_NJ,
	caption = "NJ Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## New Mexico

```{r NM qtr setup}

q1_NM <- q1_trank[State == "NM", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_NM <- q2_trank[State == "NM", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_NM <- q3_trank[State == "NM", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_NM <- q4_trank[State == "NM", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_NM <- q5_trank[State == "NM", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_NM <- q6_trank[State == "NM", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_NM <- rbind(q1_NM, q2_NM, q3_NM, q4_NM, q5_NM, q6_NM, fill = TRUE)
qall_NM[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r NM tables}

kable(NM_Latest_Day_DT,
	caption = "NM Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(NM_p_DT,
      caption = "NM Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r NMmth chart}

NM_c_DT <- NMmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
NM_c_DT[, `:=` (Month = anydate(Month_Ended))]
NM_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(NM_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "NM – Average Cases (per Day by Month)")
```
```{r NM mth table}
kable(NMmth_DT,
	caption = "NM by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r NM Avg Deaths to Cases, warning = FALSE}
NM_c_DT <- NMmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
NM_c_DT[, `:=` (Month = anydate(Month_Ended))]
NM_c_DT[, `:=` (Month_Ended = NULL)]
NM_lng_DT <- melt(NM_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(NM_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "NM – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarter Ranking
```{r NMq tables }

NMq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(NMq_DT,
	caption = "NM by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_NM,
	caption = "NM Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## New York

```{r NY qtr setup}

q1_NY <- q1_trank[State == "NY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_NY <- q2_trank[State == "NY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_NY <- q3_trank[State == "NY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_NY <- q4_trank[State == "NY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_NY <- q5_trank[State == "NY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_NY <- q6_trank[State == "NY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_NY <- rbind(q1_NY, q2_NY, q3_NY, q4_NY, q5_NY, q6_NY, fill = TRUE)
qall_NY[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r NY tables}

kable(NY_Latest_Day_DT,
	caption = "NY Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(NY_p_DT,
      caption = "NY Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r NYmth chart}

NY_c_DT <- NYmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
NY_c_DT[, `:=` (Month = anydate(Month_Ended))]
NY_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(NY_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "NY – Average Cases (per Day by Month)")
```
```{r NY mth table}
kable(NYmth_DT,
	caption = "NY by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r NY Avg Deaths to Cases, warning = FALSE}
NY_c_DT <- NYmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
NY_c_DT[, `:=` (Month = anydate(Month_Ended))]
NY_c_DT[, `:=` (Month_Ended = NULL)]
NY_lng_DT <- melt(NY_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(NY_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "NY – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r NYq tables }

NYq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
kable(NYq_DT,
	caption = "NY by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_NY,
	caption = "NY Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## North Carolina

```{r NC qtr setup}

q1_NC <- q1_trank[State == "NC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_NC <- q2_trank[State == "NC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_NC <- q3_trank[State == "NC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_NC <- q4_trank[State == "NC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_NC <- q5_trank[State == "NC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_NC <- q6_trank[State == "NC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_NC <- rbind(q1_NC, q2_NC, q3_NC, q4_NC, q5_NC, q6_NC, fill = TRUE )
qall_NC[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r NC tables}

kable(NC_Latest_Day_DT,
	caption = "NC Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(NC_p_DT,
      caption = "NC Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month

```{r NCmth chart}

NC_c_DT <- NCmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
NC_c_DT[, `:=` (Month = anydate(Month_Ended))]
NC_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(NC_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "NC – Average Cases (per Day by Month)")
```
```{r NC mth table}
kable(NCmth_DT,
	caption = "NC by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r NC Avg Deaths to Cases, warning = FALSE}
NC_c_DT <- NCmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
NC_c_DT[, `:=` (Month = anydate(Month_Ended))]
NC_c_DT[, `:=` (Month_Ended = NULL)]
NC_lng_DT <- melt(NC_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(NC_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "NC – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r NCq tables }

NCq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(NCq_DT,
	caption = "NC by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_NC,
	caption = "NC Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## North Dakota

```{r ND qtr setup}

q1_ND <- q1_trank[State == "ND", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_ND <- q2_trank[State == "ND", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_ND <- q3_trank[State == "ND", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_ND <- q4_trank[State == "ND", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_ND <- q5_trank[State == "ND", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_ND <- q6_trank[State == "ND", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_ND <- rbind(q1_ND, q2_ND, q3_ND, q4_ND, q5_ND, q6_ND,fill = TRUE)
qall_ND[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r ND tables}

kable(ND_Latest_Day_DT,
	caption = "ND Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(ND_p_DT,
      caption = "ND Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r NDmth chart}

ND_c_DT <- NDmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
ND_c_DT[, `:=` (Month = anydate(Month_Ended))]
ND_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(ND_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "ND – Average Cases (per Day by Month)")
```
```{r ND mth table}
kable(NDmth_DT,
	caption = "ND by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r ND Avg Deaths to Cases, warning = FALSE}
ND_c_DT <- NDmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
ND_c_DT[, `:=` (Month = anydate(Month_Ended))]
ND_c_DT[, `:=` (Month_Ended = NULL)]
ND_lng_DT <- melt(ND_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(ND_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "ND – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r NDq tables }

NDq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(NDq_DT,
	caption = "ND by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_ND,
	caption = "ND Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Ohio

```{r OH qtr setup}

q1_OH <- q1_trank[State == "OH", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_OH <- q2_trank[State == "OH", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_OH <- q3_trank[State == "OH", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_OH <- q4_trank[State == "OH", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_OH <- q5_trank[State == "OH", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_OH <- q6_trank[State == "OH", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_OH <- rbind(q1_OH, q2_OH, q3_OH, q4_OH, q5_OH, q6_OH, fill = TRUE)
qall_OH[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r OH tables}

kable(OH_Latest_Day_DT,
	caption = "OH Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(OH_p_DT,
      caption = "OH Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r OHmth chart}

OH_c_DT <- OHmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
OH_c_DT[, `:=` (Month = anydate(Month_Ended))]
OH_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(OH_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "OH – Average Cases (per Day by Month)")
```
```{r OH mth table}
kable(OHmth_DT,
	caption = "OH by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r OH Avg Deaths to Cases, warning = FALSE}
OH_c_DT <- OHmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
OH_c_DT[, `:=` (Month = anydate(Month_Ended))]
OH_c_DT[, `:=` (Month_Ended = NULL)]
OH_lng_DT <- melt(OH_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(OH_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "OH – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r OHq tables }

OHq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(OHq_DT,
	caption = "OH by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_OH,
	caption = "OH Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Oklahoma

```{r OK qtr setup}

q1_OK <- q1_trank[State == "OK", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_OK <- q2_trank[State == "OK", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_OK <- q3_trank[State == "OK", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_OK <- q4_trank[State == "OK", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_OK <- q5_trank[State == "OK", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_OK <- q6_trank[State == "OK", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_OK <- rbind(q1_OK, q2_OK, q3_OK, q4_OK, q5_OK, q6_OK,fill = TRUE)
qall_OK[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r OK tables}

kable(OK_Latest_Day_DT,
	caption = "OK Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(OK_p_DT,
      caption = "OK Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r OKmth chart}

OK_c_DT <- OKmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
OK_c_DT[, `:=` (Month = anydate(Month_Ended))]
OK_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(OK_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "OK – Average Cases (per Day by Month)")
```
```{r OK mth table}
kable(OKmth_DT,
	caption = "OK by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r OK Avg Deaths to Cases, warning = FALSE}
OK_c_DT <- OKmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
OK_c_DT[, `:=` (Month = anydate(Month_Ended))]
OK_c_DT[, `:=` (Month_Ended = NULL)]
OK_lng_DT <- melt(OK_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(OK_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "OK – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r OKq tables }

OKq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(OKq_DT,
	caption = "OK by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_OK,
	caption = "OK Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Oregon

```{r OR qtr setup}

q1_OR <- q1_trank[State == "OR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_OR <- q2_trank[State == "OR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_OR <- q3_trank[State == "OR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_OR <- q4_trank[State == "OR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_OR <- q5_trank[State == "OR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_OR <- q6_trank[State == "OR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_OR <- rbind(q1_OR, q2_OR, q3_OR, q4_OR, q5_OR, q6_OR, fill = TRUE)
qall_OR[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r OR tables}

kable(OR_Latest_Day_DT,
	caption = "OR Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(OR_p_DT,
      caption = "OR Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r ORmth chart}

OR_c_DT <- ORmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
OR_c_DT[, `:=` (Month = anydate(Month_Ended))]
OR_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(OR_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "OR – Average Cases (per Day by Month)")
```
```{r OR mth table}
kable(ORmth_DT,
	caption = "OR by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r OR Avg Deaths to Cases, warning = FALSE}
OR_c_DT <- ORmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
OR_c_DT[, `:=` (Month = anydate(Month_Ended))]
OR_c_DT[, `:=` (Month_Ended = NULL)]
OR_lng_DT <- melt(OR_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(OR_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "OR – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r ORq tables }

ORq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(ORq_DT,
	caption = "OR by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_OR,
	caption = "OR Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Pennsylvania

```{r PA qtr setup}

q1_PA <- q1_trank[State == "PA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_PA <- q2_trank[State == "PA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_PA <- q3_trank[State == "PA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_PA <- q4_trank[State == "PA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_PA <- q5_trank[State == "PA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_PA <- q6_trank[State == "PA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_PA <- rbind(q1_PA, q2_PA, q3_PA, q4_PA, q5_PA, q6_PA, fill = TRUE)
qall_PA[,Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r PA tables}

kable(PA_Latest_Day_DT,
	caption = "PA Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(PA_p_DT,
      caption = "PA Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r PAmth chart}

PA_c_DT <- PAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
PA_c_DT[, `:=` (Month = anydate(Month_Ended))]
PA_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(PA_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "PA – Average Cases (per Day by Month)")
```
```{r PA mth table}
kable(PAmth_DT,
	caption = "PA by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r PA Avg Deaths to Cases, warning = FALSE}
PA_c_DT <- PAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
PA_c_DT[, `:=` (Month = anydate(Month_Ended))]
PA_c_DT[, `:=` (Month_Ended = NULL)]
PA_lng_DT <- melt(PA_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(PA_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "PA – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### by Quarter & Quarterly Ranking
```{r PAq tables }

PAq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
kable(PAq_DT,
	caption = "PA by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_PA,
	caption = "PA Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

## Puerto Rico

```{r PR qtr setup}

q1_PR <- q1_trank[State == "PR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_PR <- q2_trank[State == "PR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_PR <- q3_trank[State == "PR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_PR <- q4_trank[State == "PR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_PR <- q5_trank[State == "PR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_PR <- q6_trank[State == "PR", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_PR <- rbind(q1_PR, q2_PR, q3_PR, q4_PR, q5_PR, q6_PR, fill = TRUE)
qall_PR[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```

### Latest Day & Pandemic to Date
```{r PR tables}

kable(PR_Latest_Day_DT,
	caption = "PR Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(PR_p_DT,
      caption = "PR Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month

```{r PRmth chart}

PR_c_DT <- PRmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
PR_c_DT[, `:=` (Month = anydate(Month_Ended))]
PR_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(PR_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "PR – Average Cases (per Day by Month)")
```
```{r PR mth table}
kable(PRmth_DT,
	caption = "PR by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r PR Avg Deaths to Cases, warning = FALSE}
PR_c_DT <- PRmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
PR_c_DT[, `:=` (Month = anydate(Month_Ended))]
PR_c_DT[, `:=` (Month_Ended = NULL)]
PR_lng_DT <- melt(PR_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(PR_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "PR – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r PRq tables }

PRq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(PRq_DT,
	caption = "PR by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_PR,
	caption = "PR Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Rhode Island

```{r RI qtr setup}

q1_RI <- q1_trank[State == "RI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_RI <- q2_trank[State == "RI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_RI <- q3_trank[State == "RI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_RI <- q4_trank[State == "RI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_RI <- q5_trank[State == "RI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_RI <- q6_trank[State == "RI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_RI <- rbind(q1_RI, q2_RI, q3_RI, q4_RI, q5_RI, q6_RI, fill = TRUE)
qall_RI[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r RI tables}

kable(RI_Latest_Day_DT,
	caption = "RI Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(RI_p_DT,
      caption = "RI Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r RImth chart}

RI_c_DT <- RImth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
RI_c_DT[, `:=` (Month = anydate(Month_Ended))]
RI_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(RI_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "RI – Average Cases (per Day by Month)")
```
```{r RI mth table}
kable(RImth_DT,
	caption = "RI by Month")%>%
kable_styling(font_size = 10, full_width = F)
```
```{r RI Avg Deaths to Cases, warning = FALSE}
RI_c_DT <- RImth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
RI_c_DT[, `:=` (Month = anydate(Month_Ended))]
RI_c_DT[, `:=` (Month_Ended = NULL)]
RI_lng_DT <- melt(RI_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(RI_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "RI – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r RIq tables }

RIq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(RIq_DT,
	caption = "RI by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_RI,
	caption = "RI Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## South Carolina

```{r SC qtr setup}

q1_SC <- q1_trank[State == "SC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_SC <- q2_trank[State == "SC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_SC <- q3_trank[State == "SC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_SC <- q4_trank[State == "SC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_SC <- q5_trank[State == "SC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_SC <- q6_trank[State == "SC", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_SC <- rbind(q1_SC, q2_SC, q3_SC, q4_SC, q5_SC, q6_SC, fill = TRUE)
qall_SC[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r SC tables}

kable(SC_Latest_Day_DT,
	caption = "SC Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(SC_p_DT,
      caption = "SC Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r SCmth chart}

SC_c_DT <- SCmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
SC_c_DT[, `:=` (Month = anydate(Month_Ended))]
SC_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(SC_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "SC – Average Cases (per Day by Month)")
```
```{r SC mth table}
kable(SCmth_DT,
	caption = "SC by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r SC Avg Deaths to Cases, warning = FALSE}
SC_c_DT <- SCmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
SC_c_DT[, `:=` (Month = anydate(Month_Ended))]
SC_c_DT[, `:=` (Month_Ended = NULL)]
SC_lng_DT <- melt(SC_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(SC_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "SC – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r SCq tables }

SCq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(SCq_DT,
	caption = "SC by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_SC,
	caption = "SC Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## South Dakota

```{r SD qtr setup}

q1_SD <- q1_trank[State == "SD", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_SD <- q2_trank[State == "SD", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_SD <- q3_trank[State == "SD", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_SD <- q4_trank[State == "SD", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_SD <- q5_trank[State == "SD", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_SD <- q6_trank[State == "SD", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_SD <- rbind(q1_SD, q2_SD, q3_SD, q4_SD, q5_SD, q6_SD, fill = TRUE)
qall_SD[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r SD tables}

kable(SD_Latest_Day_DT,
	caption = "SD Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(SD_p_DT,
      caption = "SD Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month

```{r SDmth chart}

SD_c_DT <- SDmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
SD_c_DT[, `:=` (Month = anydate(Month_Ended))]
SD_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(SD_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "SD – Average Cases (per Day by Month)")
```
```{r SD mth table}
kable(SDmth_DT,
	caption = "SD by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r SD Avg Deaths to Cases, warning = FALSE}
SD_c_DT <- SDmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
SD_c_DT[, `:=` (Month = anydate(Month_Ended))]
SD_c_DT[, `:=` (Month_Ended = NULL)]
SD_lng_DT <- melt(SD_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(SD_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "SD – Average Cases & Deaths per Day by Month)") + theme(legend.title = element_blank())
```


### By Quarter & Quarterly Ranking
```{r SDq tables }

SDq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]


kable(SDq_DT,
	caption = "SD by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_SD,
	caption = "SD Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Tennessee

```{r TN qtr setup}

q1_TN <- q1_trank[State == "TN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_TN <- q2_trank[State == "TN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_TN <- q3_trank[State == "TN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_TN <- q4_trank[State == "TN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_TN <- q5_trank[State == "TN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_TN <- q6_trank[State == "TN", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_TN <- rbind(q1_TN, q2_TN, q3_TN, q4_TN, q5_TN, q6_TN, fill = TRUE)
qall_TN[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r TN tables}

kable(TN_Latest_Day_DT,
	caption = "TN Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(TN_p_DT,
      caption = "TN Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r TNmth chart}

TN_c_DT <- TNmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
TN_c_DT[, `:=` (Month = anydate(Month_Ended))]
TN_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(TN_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "TN – Average Cases (per Day by Month)")
```
```{r TN mth table}
kable(TNmth_DT,
	caption = "TN by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r TN Avg Deaths to Cases, warning = FALSE}
TN_c_DT <- TNmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
TN_c_DT[, `:=` (Month = anydate(Month_Ended))]
TN_c_DT[, `:=` (Month_Ended = NULL)]
TN_lng_DT <- melt(TN_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(TN_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "TN – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r TNq tables }

TNq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]


kable(TNq_DT,
	caption = "TN by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_TN,
	caption = "TN Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Texas

```{r TX qtr setup}

q1_TX <- q1_trank[State == "TX", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_TX <- q2_trank[State == "TX", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_TX <- q3_trank[State == "TX", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_TX <- q4_trank[State == "TX", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_TX <- q5_trank[State == "TX", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_TX <- q6_trank[State == "TX", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_TX <- rbind(q1_TX, q2_TX, q3_TX, q4_TX, q5_TX, q6_TX, fill = TRUE)
qall_TX[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r TX tables}

kable(TX_Latest_Day_DT,
	caption = "TX Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(TX_p_DT,
      caption = "TX Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r txmth chart}

TX_c_DT <- TXmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
TX_c_DT[, `:=` (Month = anydate(Month_Ended))]
TX_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(TX_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "TX – Average Cases (per Day by Month)")
```
```{r TX mth table}
kable(TXmth_DT,
	caption = "TX by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r TX Avg Deaths to Cases, warning = FALSE}
TX_c_DT <- TXmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
TX_c_DT[, `:=` (Month = anydate(Month_Ended))]
TX_c_DT[, `:=` (Month_Ended = NULL)]
TX_lng_DT <- melt(TX_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(TX_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "TX – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r TXq tables }

TXq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(TXq_DT,
	caption = "TX by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_TX,
	caption = "TX Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```


## Utah

```{r UT qtr setup}

q1_UT <- q1_trank[State == "UT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_UT <- q2_trank[State == "UT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_UT <- q3_trank[State == "UT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_UT <- q4_trank[State == "UT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_UT <- q5_trank[State == "UT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_UT <- q6_trank[State == "UT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_UT <- rbind(q1_UT, q2_UT, q3_UT, q4_UT, q5_UT, q6_UT,fill = TRUE)
qall_UT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```

### Latest Day & Pandemic to Date
```{r UT tables}

kable(UT_Latest_Day_DT,
	caption = "UT Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(UT_p_DT,
      caption = "UT Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r utmth-chart}

UT_c_DT <- UTmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
UT_c_DT[, `:=` (Month = anydate(Month_Ended))]
UT_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(UT_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "UT – Average Cases (per Day by Month)")
```
```{r UT mth table}
kable(UTmth_DT,
	caption = "UT by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r UT Avg Deaths to Cases, warning = FALSE}
UT_c_DT <- UTmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
UT_c_DT[, `:=` (Month = anydate(Month_Ended))]
UT_c_DT[, `:=` (Month_Ended = NULL)]
UT_lng_DT <- melt(UT_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(UT_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "UT – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r UTq tables }

UTq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(UTq_DT,
	caption = "UT by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_UT,
	caption = "UT Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

## Vermont

```{r VT qtr setup}

q1_VT <- q1_trank[State == "VT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_VT <- q2_trank[State == "VT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_VT <- q3_trank[State == "VT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_VT <- q4_trank[State == "VT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_VT <- q5_trank[State == "VT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_VT <- q6_trank[State == "VT", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_VT <- rbind(q1_VT, q2_VT, q3_VT, q4_VT,q5_VT, q6_VT, fill = TRUE)
qall_VT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r VT tables}

kable(VT_Latest_Day_DT,
	caption = "VT Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(VT_p_DT,
      caption = "VT Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r vt-mth-chart}

VT_c_DT <- VTmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
VT_c_DT[, `:=` (Month = anydate(Month_Ended))]
VT_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(VT_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "VT – Average Cases (per Day by Month)")
```
```{r VT mth table}
kable(VTmth_DT,
	caption = "VT by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r VT Avg Deaths to Cases, warning = FALSE}
VT_c_DT <- VTmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
VT_c_DT[, `:=` (Month = anydate(Month_Ended))]
VT_c_DT[, `:=` (Month_Ended = NULL)]
VT_lng_DT <- melt(VT_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(VT_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "VT – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r VTq tables }

VTq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(VTq_DT,
	caption = "VT by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_VT,
	caption = "VT Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

## Virginia

```{r VA qtr setup}

q1_VA <- q1_trank[State == "VA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_VA <- q2_trank[State == "VA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_VA <- q3_trank[State == "VA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_VA <- q4_trank[State == "VA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_VA <- q5_trank[State == "VA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_VA <- q6_trank[State == "VA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_VA <- rbind(q1_VA, q2_VA, q3_VA, q4_VA, q5_VA, q6_VA, fill = TRUE)
qall_VA[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r VA tables}

kable(VA_Latest_Day_DT,
	caption = "VA Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(VA_p_DT,
      caption = "VA Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r vamth setup}

VA_c_DT <- VAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
VA_c_DT[, `:=` (Month = anydate(Month_Ended))]
VA_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(VA_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "VA – Average Cases (per Day by Month)")
```
```{r VA mth table}
kable(VAmth_DT,
	caption = "VA by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r VA Avg Deaths to Cases, warning = FALSE}
VA_c_DT <- VAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
VA_c_DT[, `:=` (Month = anydate(Month_Ended))]
VA_c_DT[, `:=` (Month_Ended = NULL)]
VA_lng_DT <- melt(VA_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(VA_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "VA – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r VAq tables }

VAq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(VAq_DT,
	caption = "VA by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_VA,
	caption = "VA Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

## Virgin Islands

```{r VI qtr setup}

q1_VI <- q1_trank[State == "VI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_VI <- q2_trank[State == "VI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_VI <- q3_trank[State == "VI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_VI <- q4_trank[State == "VI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_VI <- q5_trank[State == "VI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_VI <- q6_trank[State == "VI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_VI <- rbind(q1_VI, q2_VI, q3_VI, q4_VI, q5_VI, q6_VI, fill = TRUE)
qall_VI[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```

### Latest Day & Pandemic to Date
```{r VI tables}

kable(VI_Latest_Day_DT,
	caption = "VI Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(VI_p_DT,
      caption = "VI Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r VImth setup}

VI_c_DT <- VImth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
VI_c_DT[, `:=` (Month = anydate(Month_Ended))]
VI_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(VI_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "VI – Average Cases (per Day by Month)")
```
```{r VI mth table}
kable(VImth_DT,
	caption = "VI by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r VI Avg Deaths to Cases, warning = FALSE}
VI_c_DT <- VImth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
VI_c_DT[, `:=` (Month = anydate(Month_Ended))]
VI_c_DT[, `:=` (Month_Ended = NULL)]
VI_lng_DT <- melt(VI_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(VI_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "VI – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r VIq tables }

VIq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(VIq_DT,
	caption = "VI by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_VI,
	caption = "VI Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

## Washington

```{r WA qtr setup}

q1_WA <- q1_trank[State == "WA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_WA <- q2_trank[State == "WA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_WA <- q3_trank[State == "WA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_WA <- q4_trank[State == "WA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_WA <- q5_trank[State == "WA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_WA <- q6_trank[State == "WA", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_WA <- rbind(q1_WA, q2_WA, q3_WA, q4_WA, q5_WA, q6_WA, fill = TRUE)
qall_WA[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]
```
### Latest Day & Pandemic to Date
```{r WA tables}

kable(WA_Latest_Day_DT,
	caption = "WA Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(WA_p_DT,
      caption = "WA Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r wamth setup}

WA_c_DT <- WAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
WA_c_DT[, `:=` (Month = anydate(Month_Ended))]
WA_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(WA_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "WA – Average Cases (per Day by Month)")
```
```{r WA mth table}
kable(WAmth_DT,
	caption = "WA by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r WA Avg Deaths to Cases, warning = FALSE}
WA_c_DT <- WAmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
WA_c_DT[, `:=` (Month = anydate(Month_Ended))]
WA_c_DT[, `:=` (Month_Ended = NULL)]
WA_lng_DT <- melt(WA_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(WA_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "WA – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r WAq tables }

WAq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(WAq_DT,
	caption = "WA by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_WA,
	caption = "WA Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

## Wisconsin

```{r WI qtr setup}

q1_WI <- q1_trank[State == "WI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_WI <- q2_trank[State == "WI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_WI <- q3_trank[State == "WI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_WI <- q4_trank[State == "WI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_WI <- q5_trank[State == "WI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_WI <- q6_trank[State == "WI", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_WI <- rbind(q1_WI, q2_WI, q3_WI, q4_WI, q5_WI, q6_WI,  fill = TRUE )
qall_WI[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

```
### Latest Day & Pandemic to Date
```{r WI tables}

kable(WI_Latest_Day_DT,
	caption = "WI Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(WI_p_DT,
      caption = "WI Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r wimth setup}

WI_c_DT <- WImth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
WI_c_DT[, `:=` (Month = anydate(Month_Ended))]
WI_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(WI_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "WI – Average Cases (per Day by Month)")
```
```{r WI mth table}
kable(WImth_DT,
	caption = "WI by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r WI Avg Deaths to Cases, warning = FALSE}
WI_c_DT <- WImth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
WI_c_DT[, `:=` (Month = anydate(Month_Ended))]
WI_c_DT[, `:=` (Month_Ended = NULL)]
WI_lng_DT <- melt(WI_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(WI_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "WI – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```


### By Quarter & Quarterly Ranking
```{r WIq tables }

WIq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(WIq_DT,
	caption = "WI by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_WI,
	caption = "WI Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

## West Virginia

```{r WV qtr setup}



q1_WV <- q1_trank[State == "WV", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_WV <- q2_trank[State == "WV", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_WV <- q3_trank[State == "WV", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_WV <- q4_trank[State == "WV", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_WV <- q5_trank[State == "WV", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_WV <- q6_trank[State == "WV", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_WV <- rbind(q1_WV, q2_WV, q3_WV, q4_WV, q5_WV, q6_WV,fill = TRUE)
qall_WV[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

```

### Latest Day & Pandemic to Date
```{r WV tables}

kable(WV_Latest_Day_DT,
	caption = "WV Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(WV_p_DT,
      caption = "WV Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r WVmth setup}

WV_c_DT <- WVmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
WV_c_DT[, `:=` (Month = anydate(Month_Ended))]
WV_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(WV_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "WV – Average Cases (per Day by Month)")
```
```{r WV mth table}
kable(WVmth_DT,
	caption = "WV by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r WV Avg Deaths to Cases, warning = FALSE}
WV_c_DT <- WVmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
WV_c_DT[, `:=` (Month = anydate(Month_Ended))]
WV_c_DT[, `:=` (Month_Ended = NULL)]
WV_lng_DT <- melt(WV_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(WV_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "WV – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```


### By Quarter & Quarterly Ranking
```{r WVq tables }

WVq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(WVq_DT,
	caption = "WV by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_WV,
	caption = "WV Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

## Wyoming

```{r WY qtr setup}

q1_WY <- q1_trank[State == "WY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q2_WY <- q2_trank[State == "WY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q3_WY <- q3_trank[State == "WY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q4_WY <- q4_trank[State == "WY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q5_WY <- q5_trank[State == "WY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]
q6_WY <- q6_trank[State == "WY", .SD, .SDcols = c("Quarter_Ended","State", "Deaths_10K Rank", "Cases_10K_Rank", "Tests_10K_Rank")]

qall_WY <- rbind(q1_WY, q2_WY, q3_WY, q4_WY, q5_WY, q6_WY, fill = TRUE)
qall_WY[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

```
### Latest Day & Pandemic to Date
```{r WY tables}

kable(WY_Latest_Day_DT,
	caption = "WY Latest Day")%>%
	kable_styling(font_size = 10, full_width = F)

kable(WY_p_DT,
      caption = "WY Pandemic to Date")%>%
  kable_styling(font_size = 10, full_width = F)
```
### By Month
```{r WYmth chart}

WY_c_DT <- WYmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Cases_Day")]
WY_c_DT[, `:=` (Month = anydate(Month_Ended))]
WY_c_DT[, `:=` (Month_Ended = NULL)]
ggplot(WY_c_DT, aes(x = Month, y = Avg_Cases_Day)) + geom_line(size = 1, color = "red") + labs(title = "WY – Average Cases (per Day by Month)")
```
```{r WY mth table}
kable(WYmth_DT,
	caption = "WY by Month")%>%
	kable_styling(font_size = 10, full_width = F)
```
```{r WY Avg Deaths to Cases, warning = FALSE}
WY_c_DT <- WYmth_DT[, .SD, .SDcols = c("Month_Ended", "Avg_Deaths_Day", "Avg_Cases_Day")]
WY_c_DT[, `:=` (Month = anydate(Month_Ended))]
WY_c_DT[, `:=` (Month_Ended = NULL)]
WY_lng_DT <- melt(WY_c_DT, measure.vars = c("Avg_Deaths_Day", "Avg_Cases_Day"))
ggplot(WY_lng_DT, aes(x = Month, y = value, col = variable)) + geom_line(size = 1) + scale_y_log10() + ylab("Average Cases & Deaths - Logarithmic Scale") +  labs(title = "WY – Average Cases & Deaths per Day by Month") + theme(legend.title = element_blank())
```

### By Quarter & Quarterly Ranking
```{r WYq tables }

WYq_DT[, Quarter_Ended := strftime(Quarter_Ended, "%b %d, %Y")]

kable(WYq_DT,
	caption = "WY by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)

kable(qall_WY,
	caption = "WY Ranking by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```

# Pandemic to Date Ranking

```{r Pandemic to Date Ranking}
x <- seq(56)

ptd1_DT <- rbind (AK_p_DT, AL_p_DT, AR_p_DT, AS_p_DT, AZ_p_DT, CA_p_DT, CO_p_DT,  CT_p_DT, DC_p_DT, DE_p_DT, FL_p_DT, GA_p_DT, GU_p_DT, HI_p_DT, IA_p_DT, ID_p_DT , IL_p_DT, IN_p_DT, KS_p_DT, KY_p_DT, LA_p_DT, MA_p_DT, MD_p_DT, ME_p_DT, MI_p_DT, MN_p_DT, MO_p_DT, MP_p_DT, MS_p_DT, MT_p_DT, NC_p_DT, ND_p_DT, NE_p_DT, NH_p_DT, NJ_p_DT, NM_p_DT, NV_p_DT, NY_p_DT, OH_p_DT, OK_p_DT, OR_p_DT, PA_p_DT, PR_p_DT, RI_p_DT, SC_p_DT, SD_p_DT, TN_p_DT, TX_p_DT, UT_p_DT, VA_p_DT, VI_p_DT, VT_p_DT, WA_p_DT, WI_p_DT, WV_p_DT, WY_p_DT, fill = TRUE)
ptd2_DT <- ptd1_DT[order(-Deaths_10K_pop)] 
ptd_DT <- cbind(x, ptd2_DT)
```
```{r ptd table}

kable(ptd_DT,
      caption = "Pandemic to Date - States Ranked by Mortality")%>%
  kable_styling(font_size = 10, full_width = F, fixed_thead = T)

```

# State Rankings by Quarter

The tables below are the basis the quarterly ranking tables shown within each group of state tables.

## Q1

```{r Q1 tables}
kable(q1_trank[order(State)],
      caption = "Q1 State Ranking")%>%
  kable_styling(font_size = 10, full_width = F, fixed_thead = T)
```

## Q2

```{r Q2 table}
kable(q2_trank[order(State)],
      caption = "Q2 State Ranking")%>%
  kable_styling(font_size = 10, full_width = F, fixed_thead = T)
```
## Q3

```{r Q3 table}
kable(q3_trank[order(State)],
      caption = "Q3 State Ranking")%>%
  kable_styling(font_size = 10, full_width = F, fixed_thead = T)
```
## Q4

```{r Q4 table}
kable(q4_trank[order(State)],
      caption = "Q4 State Ranking")%>%
  kable_styling(font_size = 10, full_width = F, fixed_thead = T)
```
## Q5

```{r Q5 table}
kable(q5_trank[order(State)],
      caption = "Q5 State Ranking")%>%
  kable_styling(font_size = 10, full_width = F, fixed_thead = T)
```
## Q6

```{r Q6 table}
kable(q6_trank[order(State)],
      caption = "Q6 State Ranking")%>%
  kable_styling(font_size = 10, full_width = F, fixed_thead = T)
```


```{r correlations}

cor_q1_case <- q1_trank[, cor(Cases_10K_pop, Deaths_10K_pop)] 
cor_q1_test <- q1_trank[State != "PR", cor(Tests_10K_pop, Cases_10K_pop)]
cor_q1_death <- q1_trank[State != "PR", cor(Tests_10K_pop, Deaths_10K_pop)]
q1_stats <- c(round(cor_q1_case, 3), round(cor_q1_test, 3), round(cor_q1_death, 3))

cor_q2_case <- q2_trank[, cor(Cases_10K_pop, Deaths_10K_pop)]
cor_q2_test <- q2_trank[State != "PR", cor(Tests_10K_pop, Cases_10K_pop)]
cor_q2_death <- q2_trank[State != "PR", cor(Tests_10K_pop, Deaths_10K_pop)]
q2_stats <- c(round(cor_q2_case, 3), round(cor_q2_test, 3), round(cor_q2_death, 3))

# q3

cor_q3_case <- q3_trank[, cor(Cases_10K_pop, Deaths_10K_pop)] 
cor_q3_test <- q3_trank[State != "PR", cor(Tests_10K_pop, Cases_10K_pop)]
cor_q3_death <- q3_trank[State != "PR", cor(Tests_10K_pop, Deaths_10K_pop)]
q3_stats <- c(round(cor_q3_case, 3), round(cor_q3_test, 3), round(cor_q3_death, 3))

# q4

cor_q4_case <- q4_trank[, cor(Cases_10K_pop, Deaths_10K_pop)] 
cor_q4_test <- q4_trank[State != "PR", cor(Tests_10K_pop, Cases_10K_pop)]
cor_q4_death <- q4_trank[State != "PR", cor(Tests_10K_pop, Deaths_10K_pop)]
q4_stats <- c(round(cor_q4_case, 3), round(cor_q4_test, 3), round(cor_q4_death, 3))

#Q5

cor_q5_case <- q5_trank[, cor(Cases_10K_pop, Deaths_10K_pop)] 
cor_q5_test <- q5_trank[State != "PR", cor(Tests_10K_pop, Cases_10K_pop)]
cor_q5_death <- q5_trank[State != "PR", cor(Tests_10K_pop, Deaths_10K_pop)]
q5_stats <- c(round(cor_q5_case, 3), round(cor_q5_test, 3), round(cor_q5_death, 3))

# q stats table

q1_stats_names <- c("Cases_10K_pop : Deaths_10K_pop (Infection : Mortality)", "Tests_10K_pop : Cases_10K_pop", "Tests_10K_pop : Deaths_10K_pop")
q1_stats_DT <- data.table(Correlation = c(q1_stats_names), Q1 = c(q1_stats), Q2 = c(q2_stats), Q3 = c(q3_stats), Q4 = c(q4_stats), Q5 = c(q5_stats))
```

# Correlations

```{r cor table}
kable(q1_stats_DT,
	caption = "Correlations by Quarter")%>%
	kable_styling(font_size = 10, full_width = F)
```
This table looks at the strength of correlations of Cases : Deaths, Tests : Cases, Tests : Deaths between states. 

The consistently strong correlation between Cases : Deaths drove the selection of the charts used within each state's "By Month" section.

In Q1 and Q2 there is an apparent correlation between 

Tests : Cases and 

Tests : Deaths 

But the correlation seems to vanish in Q3 and Q4. 

The poor correlation between Testing and Mortality was counter intuitive for me and so I looked a little deeper and found the correlation I expected in some states, but not in others. I also found a growing number of states which only report positive tests as tests.

 Group 1 - Low per capita testing and higher per capita mortality (what I expected) - Iowa & North Dakota, 
 
 Group 2 - High per capita testing and lower per capita mortality (what I expected) - New York and Alaska. 
 
However there were however some states with not what I expected: 

 3 -  High per capita testing and high per capita mortality - Illinois, or 
 
 4 -  Low per capita testing and low per capita mortality - Vermont. 
 
 There are examples from Q4 in the table below.

```{r tests – deaths}

Tests_10K_pop  <- c(IAq_DT[4,9], NDq_DT[4,9], NYq_DT[4,9], AKq_DT[4,9], ILq_DT[4,9], VTq_DT[4,9])
Deaths_10K_pop <- c(IAq_DT[4,7], NDq_DT[4,7], NYq_DT[4,7], AKq_DT[4,7], ILq_DT[4,7], VTq_DT[4,7])
tbl <- rbind(Tests_10K_pop, Deaths_10K_pop)
colnames(tbl) <- c("IA", "ND", "NY", "AK","IL", "VT")
```
```{r t d table}

kable(tbl,
	caption = "Q4 Per Capita Testing v Deaths in various states")%>%
	kable_styling(font_size = 10, full_width = F, fixed_thead = T)%>%
  add_header_above(c("Category" = 1, "Group 1" = 2, "Group 2" = 2, "3" = 1, "4" = 1))
  
```

